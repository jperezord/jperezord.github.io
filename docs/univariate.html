<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.345">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PEC3 - COVID-19 Outbreak prediction - 7&nbsp; Univariate prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<link href="./multivariate.html" rel="next">
<link href="./stl.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Univariate prediction</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PEC3 - COVID-19 Outbreak prediction</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jperezord/jperezord.github.io.git" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./data.html" class="sidebar-item-text sidebar-link">Task 1: Data acquisition and exploration</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cne_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">CNE data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./google_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">GOOGLE data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ine_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">INE data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aemet_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">AEMET data</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./combination.html" class="sidebar-item-text sidebar-link">Task 2: Datasets combination</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visual.html" class="sidebar-item-text sidebar-link">Task 3: Visual analysis</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./arima.html" class="sidebar-item-text sidebar-link">Task 4: ARIMA</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acf.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ACF and PACF plots</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stl.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">STL decomposition / Transformations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Univariate prediction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multivariate data</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-sixth-epidemiological-period" id="toc-before-sixth-epidemiological-period" class="nav-link active" data-scroll-target="#before-sixth-epidemiological-period"> <span class="header-section-number">8</span> Before sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias" id="toc-asturias" class="nav-link" data-scroll-target="#asturias"> <span class="header-section-number">8.1</span> Asturias</a>
  <ul class="collapse">
  <li><a href="#days" id="toc-days" class="nav-link" data-scroll-target="#days"> <span class="header-section-number">8.1.1</span> 7 days</a></li>
  <li><a href="#days-1" id="toc-days-1" class="nav-link" data-scroll-target="#days-1"> <span class="header-section-number">8.1.2</span> 14 days</a></li>
  <li><a href="#days-2" id="toc-days-2" class="nav-link" data-scroll-target="#days-2"> <span class="header-section-number">8.1.3</span> 21 days</a></li>
  <li><a href="#days-3" id="toc-days-3" class="nav-link" data-scroll-target="#days-3"> <span class="header-section-number">8.1.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#barcelona" id="toc-barcelona" class="nav-link" data-scroll-target="#barcelona"> <span class="header-section-number">8.2</span> Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-4" id="toc-days-4" class="nav-link" data-scroll-target="#days-4"> <span class="header-section-number">8.2.1</span> 7 days</a></li>
  <li><a href="#days-5" id="toc-days-5" class="nav-link" data-scroll-target="#days-5"> <span class="header-section-number">8.2.2</span> 14 days</a></li>
  <li><a href="#days-6" id="toc-days-6" class="nav-link" data-scroll-target="#days-6"> <span class="header-section-number">8.2.3</span> 21 days</a></li>
  <li><a href="#days-7" id="toc-days-7" class="nav-link" data-scroll-target="#days-7"> <span class="header-section-number">8.2.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#madrid" id="toc-madrid" class="nav-link" data-scroll-target="#madrid"> <span class="header-section-number">8.3</span> Madrid</a>
  <ul class="collapse">
  <li><a href="#days-8" id="toc-days-8" class="nav-link" data-scroll-target="#days-8"> <span class="header-section-number">8.3.1</span> 7 days</a></li>
  <li><a href="#days-9" id="toc-days-9" class="nav-link" data-scroll-target="#days-9"> <span class="header-section-number">8.3.2</span> 14 days</a></li>
  <li><a href="#days-10" id="toc-days-10" class="nav-link" data-scroll-target="#days-10"> <span class="header-section-number">8.3.3</span> 21 days</a></li>
  <li><a href="#days-11" id="toc-days-11" class="nav-link" data-scroll-target="#days-11"> <span class="header-section-number">8.3.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#málaga" id="toc-málaga" class="nav-link" data-scroll-target="#málaga"> <span class="header-section-number">8.4</span> Málaga</a>
  <ul class="collapse">
  <li><a href="#days-12" id="toc-days-12" class="nav-link" data-scroll-target="#days-12"> <span class="header-section-number">8.4.1</span> 7 days</a></li>
  <li><a href="#days-13" id="toc-days-13" class="nav-link" data-scroll-target="#days-13"> <span class="header-section-number">8.4.2</span> 14 days</a></li>
  <li><a href="#days-14" id="toc-days-14" class="nav-link" data-scroll-target="#days-14"> <span class="header-section-number">8.4.3</span> 21 days</a></li>
  <li><a href="#days-15" id="toc-days-15" class="nav-link" data-scroll-target="#days-15"> <span class="header-section-number">8.4.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#sevilla" id="toc-sevilla" class="nav-link" data-scroll-target="#sevilla"> <span class="header-section-number">8.5</span> Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-16" id="toc-days-16" class="nav-link" data-scroll-target="#days-16"> <span class="header-section-number">8.5.1</span> 7 days</a></li>
  <li><a href="#days-17" id="toc-days-17" class="nav-link" data-scroll-target="#days-17"> <span class="header-section-number">8.5.2</span> 14 days</a></li>
  <li><a href="#days-18" id="toc-days-18" class="nav-link" data-scroll-target="#days-18"> <span class="header-section-number">8.5.3</span> 21 days</a></li>
  <li><a href="#days-19" id="toc-days-19" class="nav-link" data-scroll-target="#days-19"> <span class="header-section-number">8.5.4</span> 90 days</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#end-of-sixth-epidemiological-period" id="toc-end-of-sixth-epidemiological-period" class="nav-link" data-scroll-target="#end-of-sixth-epidemiological-period"> <span class="header-section-number">9</span> End of sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias-1" id="toc-asturias-1" class="nav-link" data-scroll-target="#asturias-1"> <span class="header-section-number">9.1</span> Asturias</a>
  <ul class="collapse">
  <li><a href="#days-20" id="toc-days-20" class="nav-link" data-scroll-target="#days-20"> <span class="header-section-number">9.1.1</span> 7 days</a></li>
  <li><a href="#days-21" id="toc-days-21" class="nav-link" data-scroll-target="#days-21"> <span class="header-section-number">9.1.2</span> 14 days</a></li>
  <li><a href="#days-22" id="toc-days-22" class="nav-link" data-scroll-target="#days-22"> <span class="header-section-number">9.1.3</span> 21 days</a></li>
  <li><a href="#days-23" id="toc-days-23" class="nav-link" data-scroll-target="#days-23"> <span class="header-section-number">9.1.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#barcelona-1" id="toc-barcelona-1" class="nav-link" data-scroll-target="#barcelona-1"> <span class="header-section-number">9.2</span> Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-24" id="toc-days-24" class="nav-link" data-scroll-target="#days-24"> <span class="header-section-number">9.2.1</span> 7 days</a></li>
  <li><a href="#days-25" id="toc-days-25" class="nav-link" data-scroll-target="#days-25"> <span class="header-section-number">9.2.2</span> 14 days</a></li>
  <li><a href="#days-26" id="toc-days-26" class="nav-link" data-scroll-target="#days-26"> <span class="header-section-number">9.2.3</span> 21 days</a></li>
  <li><a href="#days-27" id="toc-days-27" class="nav-link" data-scroll-target="#days-27"> <span class="header-section-number">9.2.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#madrid-1" id="toc-madrid-1" class="nav-link" data-scroll-target="#madrid-1"> <span class="header-section-number">9.3</span> Madrid</a>
  <ul class="collapse">
  <li><a href="#days-28" id="toc-days-28" class="nav-link" data-scroll-target="#days-28"> <span class="header-section-number">9.3.1</span> 7 days</a></li>
  <li><a href="#days-29" id="toc-days-29" class="nav-link" data-scroll-target="#days-29"> <span class="header-section-number">9.3.2</span> 14 days</a></li>
  <li><a href="#days-30" id="toc-days-30" class="nav-link" data-scroll-target="#days-30"> <span class="header-section-number">9.3.3</span> 21 days</a></li>
  <li><a href="#days-31" id="toc-days-31" class="nav-link" data-scroll-target="#days-31"> <span class="header-section-number">9.3.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#málaga-1" id="toc-málaga-1" class="nav-link" data-scroll-target="#málaga-1"> <span class="header-section-number">9.4</span> Málaga</a>
  <ul class="collapse">
  <li><a href="#days-32" id="toc-days-32" class="nav-link" data-scroll-target="#days-32"> <span class="header-section-number">9.4.1</span> 7 days</a></li>
  <li><a href="#days-33" id="toc-days-33" class="nav-link" data-scroll-target="#days-33"> <span class="header-section-number">9.4.2</span> 14 days</a></li>
  <li><a href="#days-34" id="toc-days-34" class="nav-link" data-scroll-target="#days-34"> <span class="header-section-number">9.4.3</span> 21 days</a></li>
  <li><a href="#days-35" id="toc-days-35" class="nav-link" data-scroll-target="#days-35"> <span class="header-section-number">9.4.4</span> 90 days</a></li>
  </ul></li>
  <li><a href="#sevilla-1" id="toc-sevilla-1" class="nav-link" data-scroll-target="#sevilla-1"> <span class="header-section-number">9.5</span> Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-36" id="toc-days-36" class="nav-link" data-scroll-target="#days-36"> <span class="header-section-number">9.5.1</span> 7 days</a></li>
  <li><a href="#days-37" id="toc-days-37" class="nav-link" data-scroll-target="#days-37"> <span class="header-section-number">9.5.2</span> 14 days</a></li>
  <li><a href="#days-38" id="toc-days-38" class="nav-link" data-scroll-target="#days-38"> <span class="header-section-number">9.5.3</span> 21 days</a></li>
  <li><a href="#days-39" id="toc-days-39" class="nav-link" data-scroll-target="#days-39"> <span class="header-section-number">9.5.4</span> 90 days</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-univariate" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Univariate prediction</span></span></h1>
</div>





<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Load packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>      here,      <span class="co"># file locator</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      tidyverse, <span class="co"># data management and ggplot2 graphics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      skimr,     <span class="co"># get overview of data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      janitor,   <span class="co"># produce and adorn tabulations and cross-tabulations</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      tsibble,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      fable,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      feasts,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      fabletools,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      lubridate</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>covid_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"clean"</span>, <span class="st">"final_covid_data.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="before-sixth-epidemiological-period" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Before sixth epidemiological period</h1>
<p>On one hand, we are going to train the model with data previous the start of the sixth wave of coronavirus (14 oct 2021).</p>
<p>On the other hand, we are going to train the model with data as of June 14th which is considered the beginning of the second epidemiological period in Spain. There are two reasons,</p>
<section id="asturias" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="asturias"><span class="header-section-number">8.1</span> Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0        0  16                   -6          39
 2 Asturias  2020-06-16         1        0  15.6                 -6           7
 3 Asturias  2020-06-17         0        0  15.6                 -7          20
 4 Asturias  2020-06-18         0        0  15.1                 -4          68
 5 Asturias  2020-06-19         0        0  14.8                 -4          52
 6 Asturias  2020-06-20         0        0  16.8                -10          71
 7 Asturias  2020-06-21         0        0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0        0  18.2                 -1          99
 9 Asturias  2020-06-23         0        0  20                   -2         129
10 Asturias  2020-06-24         0        0  18.2                 -9          63
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias)),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1      arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;        &lt;model&gt;  &lt;model&gt;
1 Asturias  &lt;ARIMA(3,1,1)(2,0,0)[7]&gt; &lt;ARIMA(2,1,4)&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.944   -673. 1360. 1360. 1390. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Asturias  arima_at2  0.910   -664. 1343. 1343. 1372. &lt;cpl [2]&gt;  &lt;cpl [4]&gt;
3 Asturias  Snaive     2.32      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at2           &lt;ARIMA(2,1,4)&gt;  0.910   -664. 1343. 1343. 1372.
2 arima_at1 &lt;ARIMA(3,1,1)(2,0,0)[7]&gt;  0.944   -673. 1360. 1360. 1390.
3 Snaive                    &lt;SNAIVE&gt;  2.32      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1   10.6      0.158
2 Asturias  arima_at2    8.11     0.323
3 Asturias  Snaive     629.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    33.1   0.00282
2 Asturias  arima_at2    23.6   0.0508 
3 Asturias  Snaive      892.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    49.3  0.000460
2 Asturias  arima_at2    33.3  0.0433  
3 Asturias  Snaive      927.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1   118.     0.0242
2 Asturias  arima_at2    86.5    0.584 
3 Asturias  Snaive     1195.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="days"><span class="header-section-number">8.1.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   5.64 10.3   7.00  15.7  28.4 0.141 0.126 0.214  
2 arima_at2 Asturias  Test   6.06  9.97  7.28  18.4  30.5 0.147 0.121 0.385  
3 Snaive    Asturias  Test   2.41 14.0   9.98 -10.1  49.0 0.201 0.171 0.00766</code></pre>
</div>
</div>
</section>
<section id="days-1" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="days-1"><span class="header-section-number">8.1.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Asturias  Test  10.5   14.3  11.1 29.6   35.9 0.224 0.174  0.172
2 arima_at2 Asturias  Test  10.9   14.2  11.5 32.1   38.1 0.232 0.173  0.303
3 Snaive    Asturias  Test   6.69  16.0  11.4  8.17  41.5 0.229 0.195 -0.156</code></pre>
</div>
</div>
</section>
<section id="days-2" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="days-2"><span class="header-section-number">8.1.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   9.79  13.5  10.5 27.5   32.9 0.211 0.164  0.0331
2 arima_at2 Asturias  Test  10.6   13.7  11.0 31.0   35.1 0.222 0.167  0.126 
3 Snaive    Asturias  Test   5.77  15.6  11.5  6.52  40.8 0.232 0.190 -0.223 </code></pre>
</div>
</div>
</section>
<section id="days-3" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="days-3"><span class="header-section-number">8.1.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   704. 1211.  704.  67.5  70.0  14.2  14.8 0.925
2 arima_at2 Asturias  Test   713. 1221.  714.  71.1  72.9  14.4  14.9 0.926
3 Snaive    Asturias  Test   702. 1213.  704.  60.0  71.7  14.2  14.8 0.925</code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="barcelona"><span class="header-section-number">8.2</span> Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>data_barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>data_barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62        3  21.2                   -9        17
 2 Barcelona 2020-06-16        66        3  20.8                  -10       -16
 3 Barcelona 2020-06-17        70        4  20.3                   -4        14
 4 Barcelona 2020-06-18        68        4  18.8                   -8        -6
 5 Barcelona 2020-06-19        65        4  20.4                   -5        10
 6 Barcelona 2020-06-20        53        4  21.8                  -12        15
 7 Barcelona 2020-06-21        38        1  22.8                  -18        18
 8 Barcelona 2020-06-22        69        5  23.8                    5        24
 9 Barcelona 2020-06-23        95        3  23.4                   19        28
10 Barcelona 2020-06-24        44        4  23.6                  -71        28
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>data_barcelona_train <span class="ot">&lt;-</span> data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>data_barcelona_test <span class="ot">&lt;-</span> data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona <span class="ot">&lt;-</span> data_barcelona <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona)),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona))</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Barcelona &lt;ARIMA(0,1,3)(0,1,2)[7]&gt; &lt;ARIMA(1,1,2)(0,1,2)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    
1 Barcelona arima_at1  0.196   -293.  597.  598.  622. &lt;cpl [0]&gt; &lt;cpl [17]&gt;
2 Barcelona arima_at2  0.188   -283.  579.  579.  604. &lt;cpl [1]&gt; &lt;cpl [16]&gt;
3 Barcelona Snaive     0.964     NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at2 &lt;ARIMA(1,1,2)(0,1,2)[7]&gt;  0.188   -283.  579.  579.  604.
2 arima_at1 &lt;ARIMA(0,1,3)(0,1,2)[7]&gt;  0.196   -293.  597.  598.  622.
3 Snaive                    &lt;SNAIVE&gt;  0.964     NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1   11.7      0.110
2 Barcelona arima_at2    2.55     0.923
3 Barcelona Snaive    1610.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1   27.0     0.0191
2 Barcelona arima_at2    8.86    0.840 
3 Barcelona Snaive    2198.      0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1    30.7    0.0788
2 Barcelona arima_at2    13.4    0.892 
3 Barcelona Snaive     2259.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1   131.    0.00328
2 Barcelona arima_at2    88.9   0.513  
3 Barcelona Snaive     3453.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-4" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="days-4"><span class="header-section-number">8.2.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE  RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test   18.9  64.7  54.8   1.87  28.9 0.146 0.0976 0.273
2 arima_at2 Barcelona Test   23.0  68.1  55.2   3.74  28.5 0.147 0.103  0.160
3 Snaive    Barcelona Test  -21.0  79.0  67.8 -15.5   40.3 0.180 0.119  0.184</code></pre>
</div>
</div>
</section>
<section id="days-5" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="days-5"><span class="header-section-number">8.2.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test   35.3  73.8  57.1  10.1  26.0 0.152 0.111 0.279 
2 arima_at2 Barcelona Test   38.4  76.8  58.4  11.4  26.3 0.155 0.116 0.216 
3 Snaive    Barcelona Test  -15.3  87.1  76.0 -12.2  40.4 0.202 0.131 0.0610</code></pre>
</div>
</div>
</section>
<section id="days-6" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="days-6"><span class="header-section-number">8.2.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test  58.9   107.  75.5  15.8  28.6 0.201 0.161  0.191
2 arima_at2 Barcelona Test  56.9   103.  73.6  15.2  28.1 0.196 0.156  0.104
3 Snaive    Barcelona Test  -2.10  119.  90.4 -10.9  41.3 0.240 0.179 -0.239</code></pre>
</div>
</div>
</section>
<section id="days-7" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4" class="anchored" data-anchor-id="days-7"><span class="header-section-number">8.2.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  5068. 9027. 5072.  71.8  74.8  13.5  13.6 0.868
2 arima_at2 Barcelona Test  4960. 8907. 4964.  67.8  70.8  13.2  13.4 0.868
3 Snaive    Barcelona Test  4916. 8890. 4939.  58.7  71.4  13.1  13.4 0.870</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="madrid"><span class="header-section-number">8.3</span> Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>data_madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>data_madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153       10  20.7                   -8        34
 2 Madrid    2020-06-16        91       16  21                     -8        21
 3 Madrid    2020-06-17        93       14  20.2                   -5        34
 4 Madrid    2020-06-18        85       17  21.9                   -7        30
 5 Madrid    2020-06-19        78       20  22.6                   -9        22
 6 Madrid    2020-06-20        67       20  23.4                  -12        25
 7 Madrid    2020-06-21        42        3  25                    -13        14
 8 Madrid    2020-06-22        60       16  27.3                   -8        29
 9 Madrid    2020-06-23        68       11  28.4                   -9        23
10 Madrid    2020-06-24        49       15  28                     -7        22
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>data_madrid_train <span class="ot">&lt;-</span> data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>data_madrid_test <span class="ot">&lt;-</span> data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid <span class="ot">&lt;-</span> data_madrid <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid)),</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid),</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid))</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Madrid    &lt;ARIMA(2,1,1)(1,1,1)[7]&gt; &lt;ARIMA(2,1,1)(1,1,1)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
1 Madrid    arima_at1 0.0667   -33.4  78.8  79.0  104. &lt;cpl [9]&gt; &lt;cpl [8]&gt;
2 Madrid    arima_at2 0.0667   -33.4  78.8  79.0  104. &lt;cpl [9]&gt; &lt;cpl [8]&gt;
3 Madrid    Snaive    0.291     NA    NA    NA     NA  &lt;NULL&gt;    &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 &lt;ARIMA(2,1,1)(1,1,1)[7]&gt; 0.0667   -33.4  78.8  79.0  104.
2 arima_at2 &lt;ARIMA(2,1,1)(1,1,1)[7]&gt; 0.0667   -33.4  78.8  79.0  104.
3 Snaive                    &lt;SNAIVE&gt; 0.291     NA    NA    NA     NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    10.9     0.143
2 Madrid    arima_at2    10.9     0.143
3 Madrid    Snaive     1678.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    39.6  0.000292
2 Madrid    arima_at2    39.6  0.000292
3 Madrid    Snaive     2594.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    48.0  0.000679
2 Madrid    arima_at2    48.0  0.000679
3 Madrid    Snaive     2854.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    105.     0.130
2 Madrid    arima_at2    105.     0.130
3 Madrid    Snaive      3856.     0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-8" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="days-8"><span class="header-section-number">8.3.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Madrid    Test  135.   163.  144. 39.5   47.6 0.339 0.243 -0.0355
2 arima_at2 Madrid    Test  135.   163.  144. 39.5   47.6 0.339 0.243 -0.0355
3 Snaive    Madrid    Test   32.1  124.  105. -7.03  48.2 0.247 0.185 -0.109 </code></pre>
</div>
</div>
</section>
<section id="days-9" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="days-9"><span class="header-section-number">8.3.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Madrid    Test  150.   178.  155. 45.1   49.4 0.364 0.265  0.0892
2 arima_at2 Madrid    Test  150.   178.  155. 45.1   49.4 0.364 0.265  0.0892
3 Snaive    Madrid    Test   26.3  126.  105. -8.58  46.6 0.246 0.188 -0.0472</code></pre>
</div>
</div>
</section>
<section id="days-10" class="level3" data-number="8.3.3">
<h3 data-number="8.3.3" class="anchored" data-anchor-id="days-10"><span class="header-section-number">8.3.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  174.   210.  177. 50.0   52.8 0.418 0.313 0.287
2 arima_at2 Madrid    Test  174.   210.  177. 50.0   52.8 0.418 0.313 0.287
3 Snaive    Madrid    Test   34.8  140.  117. -8.01  48.6 0.275 0.209 0.131</code></pre>
</div>
</div>
</section>
<section id="days-11" class="level3" data-number="8.3.4">
<h3 data-number="8.3.4" class="anchored" data-anchor-id="days-11"><span class="header-section-number">8.3.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  5007. 8744. 5008.  81.7  82.4  11.8  13.0 0.840
2 arima_at2 Madrid    Test  5007. 8744. 5008.  81.7  82.4  11.8  13.0 0.840
3 Snaive    Madrid    Test  4763. 8564. 4792.  51.8  68.9  11.3  12.7 0.840</code></pre>
</div>
</div>
</section>
</section>
<section id="málaga" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="málaga"><span class="header-section-number">8.4</span> Málaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>data_malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>data_malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1        0  27.2                  -16        -9
 2 Málaga    2020-06-16         1        0  27.8                  -13        -4
 3 Málaga    2020-06-17         2        0  26.9                  -13         1
 4 Málaga    2020-06-18         2        1  21.6                  -12         3
 5 Málaga    2020-06-19         1        0  24.7                  -12         2
 6 Málaga    2020-06-20         4        0  22.6                  -14         8
 7 Málaga    2020-06-21         4        0  22.7                  -16        -3
 8 Málaga    2020-06-22         6        0  25                    -13         1
 9 Málaga    2020-06-23         8        0  25.6                  -10        18
10 Málaga    2020-06-24        65        2  24.5                  -13        12
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>data_malaga_train <span class="ot">&lt;-</span> data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>data_malaga_test <span class="ot">&lt;-</span> data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga <span class="ot">&lt;-</span> data_malaga <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga)),</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga),</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga))</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Málaga    &lt;ARIMA(4,1,0)(1,1,1)[7]&gt; &lt;ARIMA(1,1,3)(0,1,1)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
1 Málaga    arima_at1  0.518   -525. 1063. 1064. 1093. &lt;cpl [11]&gt; &lt;cpl [7]&gt; 
2 Málaga    arima_at2  0.504   -518. 1049. 1049. 1074. &lt;cpl [1]&gt;  &lt;cpl [10]&gt;
3 Málaga    Snaive     2.15      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at2 &lt;ARIMA(1,1,3)(0,1,1)[7]&gt;  0.504   -518. 1049. 1049. 1074.
2 arima_at1 &lt;ARIMA(4,1,0)(1,1,1)[7]&gt;  0.518   -525. 1063. 1064. 1093.
3 Snaive                    &lt;SNAIVE&gt;  2.15      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1   12.3     0.0912
2 Málaga    arima_at2    8.13    0.321 
3 Málaga    Snaive    1361.      0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    30.5   0.00654
2 Málaga    arima_at2    18.3   0.195  
3 Málaga    Snaive     1956.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    35.2    0.0270
2 Málaga    arima_at2    24.2    0.282 
3 Málaga    Snaive     2100.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1   130.    0.00387
2 Málaga    arima_at2    85.1   0.627  
3 Málaga    Snaive     3195.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-12" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="days-12"><span class="header-section-number">8.4.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test  15.6   22.6  21.8  18.9  46.0 0.221 0.134 -0.133 
2 arima_at2 Málaga    Test  15.4   22.9  22.3  18.1  47.8 0.226 0.135 -0.0302
3 Snaive    Málaga    Test  -4.00  22.9  19.8 -27.0  52.2 0.201 0.135  0.0123</code></pre>
</div>
</div>
</section>
<section id="days-13" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="days-13"><span class="header-section-number">8.4.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test  20.1   27.7  24.0  26.8  42.4 0.243 0.163  0.199 
2 arima_at2 Málaga    Test  21.4   29.0  25.2  28.8  44.9 0.256 0.172  0.261 
3 Snaive    Málaga    Test  -3.86  22.7  18.7 -22.4  43.6 0.190 0.134 -0.0973</code></pre>
</div>
</div>
</section>
<section id="days-14" class="level3" data-number="8.4.3">
<h3 data-number="8.4.3" class="anchored" data-anchor-id="days-14"><span class="header-section-number">8.4.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test  26.7    33.3  29.2  35.0  45.4 0.297 0.197 0.270 
2 arima_at2 Málaga    Test  28.1    34.8  30.7  37.2  47.9 0.311 0.205 0.303 
3 Snaive    Málaga    Test  -0.951  22.0  18.6 -14.8  37.9 0.188 0.130 0.0886</code></pre>
</div>
</div>
</section>
<section id="days-15" class="level3" data-number="8.4.4">
<h3 data-number="8.4.4" class="anchored" data-anchor-id="days-15"><span class="header-section-number">8.4.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   680. 1100.  680.  73.4  75.9  6.91  6.50 0.934
2 arima_at2 Málaga    Test   676. 1099.  677.  72.2  74.7  6.87  6.49 0.935
3 Snaive    Málaga    Test   620. 1049.  628.  44.9  62.3  6.37  6.20 0.929</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="sevilla"><span class="header-section-number">8.5</span> Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>data_sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>data_sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2        1  23.1                  -14       -13
 2 Sevilla   2020-06-16         1        0  24.0                  -10        -4
 3 Sevilla   2020-06-17         0        0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0        0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0        0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0        0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0        0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1        0  29.3                  -17       -19
 9 Sevilla   2020-06-23         0        0  30.2                  -12       -13
10 Sevilla   2020-06-24         1        0  29.4                  -12       -12
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>data_sevilla_train <span class="ot">&lt;-</span> data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>data_sevilla_test <span class="ot">&lt;-</span> data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla <span class="ot">&lt;-</span> data_sevilla <span class="sc">%&gt;%</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla)),</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla),</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla))</span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Sevilla   &lt;ARIMA(3,1,1)(2,0,0)[7]&gt; &lt;ARIMA(4,1,0)(2,0,0)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Sevilla   arima_at1  0.924   -670. 1353. 1354. 1383. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Sevilla   arima_at2  0.922   -669. 1353. 1353. 1382. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
3 Sevilla   Snaive     2.02      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at2 &lt;ARIMA(4,1,0)(2,0,0)[7]&gt;  0.922   -669. 1353. 1353. 1382.
2 arima_at1 &lt;ARIMA(3,1,1)(2,0,0)[7]&gt;  0.924   -670. 1353. 1354. 1383.
3 Snaive                    &lt;SNAIVE&gt;  2.02      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    8.72     0.274
2 Sevilla   arima_at2    7.65     0.365
3 Sevilla   Snaive     757.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    24.5    0.0402
2 Sevilla   arima_at2    23.6    0.0511
3 Sevilla   Snaive     1110.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    37.4    0.0151
2 Sevilla   arima_at2    36.6    0.0189
3 Sevilla   Snaive     1235.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    103.     0.161
2 Sevilla   arima_at2    102.     0.179
3 Sevilla   Snaive      1692.     0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-16" class="level3" data-number="8.5.1">
<h3 data-number="8.5.1" class="anchored" data-anchor-id="days-16"><span class="header-section-number">8.5.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-120-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-121-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Sevilla   Test   7.30  11.4  8.80  19.1  24.7 0.0870 0.0721 -0.0998
2 arima_at2 Sevilla   Test   7.38  11.4  8.93  19.3  25.1 0.0883 0.0725 -0.0852
3 Snaive    Sevilla   Test  -5.85  16.0 13.7  -22.0  40.6 0.135  0.102   0.0310</code></pre>
</div>
</div>
</section>
<section id="days-17" class="level3" data-number="8.5.2">
<h3 data-number="8.5.2" class="anchored" data-anchor-id="days-17"><span class="header-section-number">8.5.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-123-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-124-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model   provincia .type     ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_a… Sevilla   Test    4.45  9.82  7.83   6.10  27.4 0.0774 0.0623 -0.0579
2 arima_a… Sevilla   Test    4.58  9.88  7.91   6.63  27.5 0.0782 0.0626 -0.0509
3 Snaive   Sevilla   Test  -12.5  19.3  16.4  -57.6   66.9 0.162  0.122   0.275 </code></pre>
</div>
</div>
</section>
<section id="days-18" class="level3" data-number="8.5.3">
<h3 data-number="8.5.3" class="anchored" data-anchor-id="days-18"><span class="header-section-number">8.5.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-126-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-127-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test    5.70  11.3  8.54   8.79  26.3 0.0844 0.0716 0.183
2 arima_at2 Sevilla   Test    5.84  11.4  8.61   9.32  26.3 0.0850 0.0720 0.187
3 Snaive    Sevilla   Test  -13.9   22.1 19.1  -60.8   72.0 0.189  0.140  0.327</code></pre>
</div>
</div>
</section>
<section id="days-19" class="level3" data-number="8.5.4">
<h3 data-number="8.5.4" class="anchored" data-anchor-id="days-19"><span class="header-section-number">8.5.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-129-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-130-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   681. 1161.  682.  59.5  64.8  6.74  7.36 0.891
2 arima_at2 Sevilla   Test   681. 1161.  682.  59.7  64.8  6.74  7.36 0.891
3 Snaive    Sevilla   Test   665. 1161.  677.  31.7  74.6  6.69  7.36 0.892</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="end-of-sixth-epidemiological-period" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> End of sixth epidemiological period</h1>
<p>We are going to keep train the model with data as of June 14th which is considered the beginning of the second epidemiological period in Spain. There are two reasons.</p>
<p>But, instead of predict the last wave, we are going to predict the deleration of infections as to 31 jan 2022.</p>
<section id="asturias-1" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="asturias-1"><span class="header-section-number">9.1</span> Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0        0  16                   -6          39
 2 Asturias  2020-06-16         1        0  15.6                 -6           7
 3 Asturias  2020-06-17         0        0  15.6                 -7          20
 4 Asturias  2020-06-18         0        0  15.1                 -4          68
 5 Asturias  2020-06-19         0        0  14.8                 -4          52
 6 Asturias  2020-06-20         0        0  16.8                -10          71
 7 Asturias  2020-06-21         0        0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0        0  18.2                 -1          99
 9 Asturias  2020-06-23         0        0  20                   -2         129
10 Asturias  2020-06-24         0        0  18.2                 -9          63
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias)),</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias),</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias))</span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Asturias  &lt;ARIMA(3,1,1)(2,0,0)[7]&gt; &lt;ARIMA(0,1,1)(1,0,1)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.917   -816. 1646. 1646. 1677. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Asturias  arima_at2  0.894   -811. 1629. 1629. 1647. &lt;cpl [7]&gt;  &lt;cpl [8]&gt;
3 Asturias  Snaive     2.53      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at2 &lt;ARIMA(0,1,1)(1,0,1)[7]&gt;  0.894   -811. 1629. 1629. 1647.
2 arima_at1 &lt;ARIMA(3,1,1)(2,0,0)[7]&gt;  0.917   -816. 1646. 1646. 1677.
3 Snaive                    &lt;SNAIVE&gt;  2.53      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-138-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-139-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-140-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    13.8    0.0551
2 Asturias  arima_at2    12.9    0.0743
3 Asturias  Snaive      981.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    38.9  0.000378
2 Asturias  arima_at2    35.2  0.00137 
3 Asturias  Snaive     1393.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    60.0 0.0000128
2 Asturias  arima_at2    49.0 0.000509 
3 Asturias  Snaive     1470.  0        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    138.  0.000873
2 Asturias  arima_at2    108.  0.0963  
3 Asturias  Snaive      1624.  0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-20" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="days-20"><span class="header-section-number">9.1.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-146-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-147-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Asturias  Test  -173.  272.  251. -25.1  30.1  2.60  1.24  0.192
2 arima_at2 Asturias  Test  -254.  334.  317. -33.7  37.7  3.27  1.52  0.162
3 Snaive    Asturias  Test  -570.  586.  570. -62.8  62.8  5.89  2.66 -0.550</code></pre>
</div>
</div>
</section>
<section id="days-21" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2" class="anchored" data-anchor-id="days-21"><span class="header-section-number">9.1.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-149-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-150-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test  -271.  332.  310.  -44.0  46.5  3.20  1.51 0.372
2 arima_at2 Asturias  Test  -393.  447.  424.  -60.8  62.8  4.38  2.03 0.444
3 Snaive    Asturias  Test  -769.  812.  769. -107.  107.   7.94  3.69 0.299</code></pre>
</div>
</div>
</section>
<section id="days-22" class="level3" data-number="9.1.3">
<h3 data-number="9.1.3" class="anchored" data-anchor-id="days-22"><span class="header-section-number">9.1.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-152-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-153-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test  -355.  411.  381.  -74.5  76.1  3.94  1.87 0.532
2 arima_at2 Asturias  Test  -493.  543.  514.  -98.0  99.3  5.31  2.47 0.597
3 Snaive    Asturias  Test  -920.  980.  920. -168.  168.   9.50  4.46 0.437</code></pre>
</div>
</div>
</section>
<section id="days-23" class="level3" data-number="9.1.4">
<h3 data-number="9.1.4" class="anchored" data-anchor-id="days-23"><span class="header-section-number">9.1.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-155-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-156-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The future dataset is incomplete, incomplete out-of-sample data will be treated as missing. 
33 observations are missing between 2022-03-30 and 2022-05-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   -579.  631.  589.  -Inf   Inf  6.09  2.87 0.719
2 arima_at2 Asturias  Test   -694.  735.  702.  -Inf   Inf  7.25  3.34 0.714
3 Snaive    Asturias  Test  -1282. 1359. 1282.  -Inf   Inf 13.3   6.18 0.471</code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona-1" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="barcelona-1"><span class="header-section-number">9.2</span> Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>data_barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>data_barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62        3  21.2                   -9        17
 2 Barcelona 2020-06-16        66        3  20.8                  -10       -16
 3 Barcelona 2020-06-17        70        4  20.3                   -4        14
 4 Barcelona 2020-06-18        68        4  18.8                   -8        -6
 5 Barcelona 2020-06-19        65        4  20.4                   -5        10
 6 Barcelona 2020-06-20        53        4  21.8                  -12        15
 7 Barcelona 2020-06-21        38        1  22.8                  -18        18
 8 Barcelona 2020-06-22        69        5  23.8                    5        24
 9 Barcelona 2020-06-23        95        3  23.4                   19        28
10 Barcelona 2020-06-24        44        4  23.6                  -71        28
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>data_barcelona_train <span class="ot">&lt;-</span> data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>data_barcelona_test <span class="ot">&lt;-</span> data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona <span class="ot">&lt;-</span> data_barcelona <span class="sc">%&gt;%</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona)),</span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona),</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona))</span>
<span id="cb267-11"><a href="#cb267-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb267-12"><a href="#cb267-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-13"><a href="#cb267-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb267-14"><a href="#cb267-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Barcelona &lt;ARIMA(1,0,2)(0,1,1)[7]&gt; &lt;ARIMA(1,0,4)(0,1,1)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    
1 Barcelona arima_at1  0.344   -523. 1055. 1055. 1077. &lt;cpl [1]&gt; &lt;cpl [9]&gt; 
2 Barcelona arima_at2  0.341   -520. 1053. 1053. 1084. &lt;cpl [1]&gt; &lt;cpl [11]&gt;
3 Barcelona Snaive     1.26      NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at2 &lt;ARIMA(1,0,4)(0,1,1)[7]&gt;  0.341   -520. 1053. 1053. 1084.
2 arima_at1 &lt;ARIMA(1,0,2)(0,1,1)[7]&gt;  0.344   -523. 1055. 1055. 1077.
3 Snaive                    &lt;SNAIVE&gt;  1.26      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-164-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-165-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-166-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1    33.4 0.0000220
2 Barcelona arima_at2    26.1 0.000480 
3 Barcelona Snaive     1654.  0        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat  lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1 Barcelona arima_at1    51.3 0.00000363
2 Barcelona arima_at2    43.2 0.0000793 
3 Barcelona Snaive     2253.  0         </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1    57.6 0.0000289
2 Barcelona arima_at2    49.3 0.000455 
3 Barcelona Snaive     2362.  0        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat    lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 Barcelona arima_at1    185. 0.0000000136
2 Barcelona arima_at2    176. 0.000000165 
3 Barcelona Snaive      2694. 0           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-24" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="days-24"><span class="header-section-number">9.2.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-172-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-173-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Barcelona Test  -4569. 4824. 4569. -62.2  62.2  5.74  2.46 -0.0331
2 arima_at2 Barcelona Test  -4145. 4383. 4145. -56.2  56.2  5.21  2.24 -0.0435
3 Snaive    Barcelona Test  -7870. 8139. 7870. -99.0  99.0  9.88  4.16  0.551 </code></pre>
</div>
</div>
</section>
<section id="days-25" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="days-25"><span class="header-section-number">9.2.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-175-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-176-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME   RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  -6582.  7100. 6582. -132.  132.  8.27  3.63 0.471
2 arima_at2 Barcelona Test  -6038.  6534. 6038. -122.  122.  7.58  3.34 0.471
3 Snaive    Barcelona Test  -9985. 10606. 9985. -188.  188. 12.5   5.42 0.548</code></pre>
</div>
</div>
</section>
<section id="days-26" class="level3" data-number="9.2.3">
<h3 data-number="9.2.3" class="anchored" data-anchor-id="days-26"><span class="header-section-number">9.2.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-178-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-179-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME   RMSE    MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test   -7823.  8400.  7823. -199.  199.  9.83  4.29 0.573
2 arima_at2 Barcelona Test   -7199.  7750.  7199. -184.  184.  9.04  3.96 0.575
3 Snaive    Barcelona Test  -11275. 12018. 11275. -272.  272. 14.2   6.14 0.602</code></pre>
</div>
</div>
</section>
<section id="days-27" class="level3" data-number="9.2.4">
<h3 data-number="9.2.4" class="anchored" data-anchor-id="days-27"><span class="header-section-number">9.2.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>            data_barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-181-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>            data_barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-182-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The future dataset is incomplete, incomplete out-of-sample data will be treated as missing. 
33 observations are missing between 2022-03-30 and 2022-05-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME   RMSE    MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  -11642. 12454. 11642.  -Inf   Inf  14.6  6.36 0.695
2 arima_at2 Barcelona Test  -10693. 11449. 10693.  -Inf   Inf  13.4  5.85 0.691
3 Snaive    Barcelona Test  -14809. 15796. 14809.  -Inf   Inf  18.6  8.06 0.592</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid-1" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="madrid-1"><span class="header-section-number">9.3</span> Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>data_madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>data_madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153       10  20.7                   -8        34
 2 Madrid    2020-06-16        91       16  21                     -8        21
 3 Madrid    2020-06-17        93       14  20.2                   -5        34
 4 Madrid    2020-06-18        85       17  21.9                   -7        30
 5 Madrid    2020-06-19        78       20  22.6                   -9        22
 6 Madrid    2020-06-20        67       20  23.4                  -12        25
 7 Madrid    2020-06-21        42        3  25                    -13        14
 8 Madrid    2020-06-22        60       16  27.3                   -8        29
 9 Madrid    2020-06-23        68       11  28.4                   -9        23
10 Madrid    2020-06-24        49       15  28                     -7        22
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>data_madrid_train <span class="ot">&lt;-</span> data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>data_madrid_test <span class="ot">&lt;-</span> data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid <span class="ot">&lt;-</span> data_madrid <span class="sc">%&gt;%</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid)),</span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid),</span>
<span id="cb311-9"><a href="#cb311-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb311-10"><a href="#cb311-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid))</span>
<span id="cb311-11"><a href="#cb311-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb311-12"><a href="#cb311-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-13"><a href="#cb311-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb311-14"><a href="#cb311-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Madrid    &lt;ARIMA(2,0,2)(0,1,2)[7]&gt; &lt;ARIMA(2,0,2)(0,1,2)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    
1 Madrid    arima_at1  0.132   -240.  494.  495.  525. &lt;cpl [2]&gt; &lt;cpl [16]&gt;
2 Madrid    arima_at2  0.132   -240.  494.  495.  525. &lt;cpl [2]&gt; &lt;cpl [16]&gt;
3 Madrid    Snaive     0.412     NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 &lt;ARIMA(2,0,2)(0,1,2)[7]&gt;  0.132   -240.  494.  495.  525.
2 arima_at2 &lt;ARIMA(2,0,2)(0,1,2)[7]&gt;  0.132   -240.  494.  495.  525.
3 Snaive                    &lt;SNAIVE&gt;  0.412     NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-190-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-191-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-192-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    24.8  0.000838
2 Madrid    arima_at2    24.8  0.000838
3 Madrid    Snaive     1617.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    38.5  0.000443
2 Madrid    arima_at2    38.5  0.000443
3 Madrid    Snaive     2282.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    47.9  0.000718
2 Madrid    arima_at2    47.9  0.000718
3 Madrid    Snaive     2422.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat  lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1 Madrid    arima_at1    166. 0.00000213
2 Madrid    arima_at2    166. 0.00000213
3 Madrid    Snaive      3192. 0         </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb331-10"><a href="#cb331-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-28" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="days-28"><span class="header-section-number">9.3.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-198-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-199-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Madrid    Test    471.  788.  629.   8.70  11.7 0.843 0.441 0.0572
2 arima_at2 Madrid    Test    471.  788.  629.   8.70  11.7 0.843 0.441 0.0572
3 Snaive    Madrid    Test  -1836. 2070. 1836. -36.2   36.2 2.46  1.16  0.541 </code></pre>
</div>
</div>
</section>
<section id="days-29" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="days-29"><span class="header-section-number">9.3.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-201-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-202-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test    174.  612.  467.   2.98  10.9 0.625 0.343 0.215
2 arima_at2 Madrid    Test    174.  612.  467.   2.98  10.9 0.625 0.343 0.215
3 Snaive    Madrid    Test  -2914. 3386. 2914. -77.1   77.1 3.90  1.90  0.466</code></pre>
</div>
</div>
</section>
<section id="days-30" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3" class="anchored" data-anchor-id="days-30"><span class="header-section-number">9.3.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb340-5"><a href="#cb340-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb340-6"><a href="#cb340-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb340-7"><a href="#cb340-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-204-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-205-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test   -228.  851.  664.  -16.7  26.5 0.888 0.477 0.512
2 arima_at2 Madrid    Test   -228.  851.  664.  -16.7  26.5 0.888 0.477 0.512
3 Snaive    Madrid    Test  -3903. 4584. 3903. -158.  158.  5.23  2.57  0.574</code></pre>
</div>
</div>
</section>
<section id="days-31" class="level3" data-number="9.3.4">
<h3 data-number="9.3.4" class="anchored" data-anchor-id="days-31"><span class="header-section-number">9.3.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>            data_madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-207-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>            data_madrid <span class="sc">%&gt;%</span> </span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-208-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The future dataset is incomplete, incomplete out-of-sample data will be treated as missing. 
33 observations are missing between 2022-03-30 and 2022-05-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  -1540. 2217. 1701. -2124. 2127.  2.28  1.24 0.699
2 arima_at2 Madrid    Test  -1540. 2217. 1701. -2124. 2127.  2.28  1.24 0.699
3 Snaive    Madrid    Test  -6507. 7446. 6507. -4965. 4965.  8.71  4.17 0.627</code></pre>
</div>
</div>
</section>
</section>
<section id="málaga-1" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="málaga-1"><span class="header-section-number">9.4</span> Málaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>data_malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb349-7"><a href="#cb349-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb349-8"><a href="#cb349-8" aria-hidden="true" tabindex="-1"></a>data_malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1        0  27.2                  -16        -9
 2 Málaga    2020-06-16         1        0  27.8                  -13        -4
 3 Málaga    2020-06-17         2        0  26.9                  -13         1
 4 Málaga    2020-06-18         2        1  21.6                  -12         3
 5 Málaga    2020-06-19         1        0  24.7                  -12         2
 6 Málaga    2020-06-20         4        0  22.6                  -14         8
 7 Málaga    2020-06-21         4        0  22.7                  -16        -3
 8 Málaga    2020-06-22         6        0  25                    -13         1
 9 Málaga    2020-06-23         8        0  25.6                  -10        18
10 Málaga    2020-06-24        65        2  24.5                  -13        12
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>data_malaga_train <span class="ot">&lt;-</span> data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>data_malaga_test <span class="ot">&lt;-</span> data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga <span class="ot">&lt;-</span> data_malaga <span class="sc">%&gt;%</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga)),</span>
<span id="cb355-8"><a href="#cb355-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga),</span>
<span id="cb355-9"><a href="#cb355-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb355-10"><a href="#cb355-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga))</span>
<span id="cb355-11"><a href="#cb355-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb355-12"><a href="#cb355-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-13"><a href="#cb355-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb355-14"><a href="#cb355-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Málaga    &lt;ARIMA(2,0,3)(0,1,1)[7]&gt; &lt;ARIMA(2,0,3)(0,1,1)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    
1 Málaga    arima_at1  0.584   -679. 1372. 1372. 1402. &lt;cpl [2]&gt; &lt;cpl [10]&gt;
2 Málaga    arima_at2  0.584   -679. 1372. 1372. 1402. &lt;cpl [2]&gt; &lt;cpl [10]&gt;
3 Málaga    Snaive     2.41      NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 &lt;ARIMA(2,0,3)(0,1,1)[7]&gt;  0.584   -679. 1372. 1372. 1402.
2 arima_at2 &lt;ARIMA(2,0,3)(0,1,1)[7]&gt;  0.584   -679. 1372. 1372. 1402.
3 Snaive                    &lt;SNAIVE&gt;  2.41      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-216-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-217-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-218-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    3.28     0.858
2 Málaga    arima_at2    3.28     0.858
3 Málaga    Snaive    1621.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    15.4     0.350
2 Málaga    arima_at2    15.4     0.350
3 Málaga    Snaive     2376.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    29.2     0.109
2 Málaga    arima_at2    29.2     0.109
3 Málaga    Snaive     2555.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    78.5     0.801
2 Málaga    arima_at2    78.5     0.801
3 Málaga    Snaive     3460.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb375-6"><a href="#cb375-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb375-7"><a href="#cb375-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb375-8"><a href="#cb375-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb375-9"><a href="#cb375-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb375-10"><a href="#cb375-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-32" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="days-32"><span class="header-section-number">9.4.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-224-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb377-6"><a href="#cb377-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb377-7"><a href="#cb377-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-225-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test    74.3  190.  152.   3.78  24.3  1.15 0.769 0.249
2 arima_at2 Málaga    Test    74.3  190.  152.   3.78  24.3  1.15 0.769 0.249
3 Snaive    Málaga    Test  -170.   240.  191. -33.7   35.9  1.45 0.968 0.246</code></pre>
</div>
</div>
</section>
<section id="days-33" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="days-33"><span class="header-section-number">9.4.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-227-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb381-6"><a href="#cb381-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb381-7"><a href="#cb381-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-228-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test   185.  290.  229.  17.9  29.6  1.73 1.17  0.340 
2 arima_at2 Málaga    Test   185.  290.  229.  17.9  29.6  1.73 1.17  0.340 
3 Snaive    Málaga    Test  -141.  223.  170. -28.9  31.8  1.28 0.899 0.0239</code></pre>
</div>
</div>
</section>
<section id="days-34" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3" class="anchored" data-anchor-id="days-34"><span class="header-section-number">9.4.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb384-5"><a href="#cb384-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb384-6"><a href="#cb384-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb384-7"><a href="#cb384-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-230-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb385-6"><a href="#cb385-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb385-7"><a href="#cb385-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-231-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   173.  267.  203.  19.1  26.9  1.53  1.08 0.422
2 arima_at2 Málaga    Test   173.  267.  203.  19.1  26.9  1.53  1.08 0.422
3 Snaive    Málaga    Test  -208.  279.  227. -41.4  43.4  1.72  1.13 0.172</code></pre>
</div>
</div>
</section>
<section id="days-35" class="level3" data-number="9.4.4">
<h3 data-number="9.4.4" class="anchored" data-anchor-id="days-35"><span class="header-section-number">9.4.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>            data_malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-233-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a>            data_malaga <span class="sc">%&gt;%</span> </span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb389-7"><a href="#cb389-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-234-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The future dataset is incomplete, incomplete out-of-sample data will be treated as missing. 
33 observations are missing between 2022-03-30 and 2022-05-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test    -6.39  278.  190.  -Inf   Inf  1.44  1.12 0.656
2 arima_at2 Málaga    Test    -6.39  278.  190.  -Inf   Inf  1.44  1.12 0.656
3 Snaive    Málaga    Test  -436.    525.  443.  -Inf   Inf  3.35  2.12 0.513</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla-1" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="sevilla-1"><span class="header-section-number">9.5</span> Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a>data_sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, num_hosp, tmed,mob_grocery_pharmacy, mob_parks,</span>
<span id="cb393-5"><a href="#cb393-5" aria-hidden="true" tabindex="-1"></a>             mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces, mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb393-6"><a href="#cb393-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>(<span class="sc">-</span>mob_flujo) <span class="sc">%&gt;%</span> </span>
<span id="cb393-7"><a href="#cb393-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb393-8"><a href="#cb393-8" aria-hidden="true" tabindex="-1"></a>data_sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 12 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos num_hosp  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2        1  23.1                  -14       -13
 2 Sevilla   2020-06-16         1        0  24.0                  -10        -4
 3 Sevilla   2020-06-17         0        0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0        0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0        0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0        0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0        0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1        0  29.3                  -17       -19
 9 Sevilla   2020-06-23         0        0  30.2                  -12       -13
10 Sevilla   2020-06-24         1        0  29.4                  -12       -12
# … with 643 more rows, and 5 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;, mob_flujo &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>data_sevilla_train <span class="ot">&lt;-</span> data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a>data_sevilla_test <span class="ot">&lt;-</span> data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla <span class="ot">&lt;-</span> data_sevilla <span class="sc">%&gt;%</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla)),</span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla),</span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb399-10"><a href="#cb399-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla))</span>
<span id="cb399-11"><a href="#cb399-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb399-12"><a href="#cb399-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-13"><a href="#cb399-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb399-14"><a href="#cb399-14" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                arima_at1                arima_at2   Snaive
  &lt;chr&gt;                      &lt;model&gt;                  &lt;model&gt;  &lt;model&gt;
1 Sevilla   &lt;ARIMA(3,1,1)(2,0,0)[7]&gt; &lt;ARIMA(4,1,0)(2,0,0)[7]&gt; &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Sevilla   arima_at1  0.962   -832. 1679. 1679. 1709. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Sevilla   arima_at2  0.962   -832. 1678. 1679. 1709. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
3 Sevilla   Snaive     2.23      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                      orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                      &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at2 &lt;ARIMA(4,1,0)(2,0,0)[7]&gt;  0.962   -832. 1678. 1679. 1709.
2 arima_at1 &lt;ARIMA(3,1,1)(2,0,0)[7]&gt;  0.962   -832. 1679. 1679. 1709.
3 Snaive                    &lt;SNAIVE&gt;  2.23      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-242-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-243-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-244-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb411"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    7.13     0.416
2 Sevilla   arima_at2    6.24     0.512
3 Sevilla   Snaive     965.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    27.9    0.0146
2 Sevilla   arima_at2    27.1    0.0185
3 Sevilla   Snaive     1403.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    38.6    0.0108
2 Sevilla   arima_at2    37.9    0.0132
3 Sevilla   Snaive     1510.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    102.     0.182
2 Sevilla   arima_at2    101.     0.202
3 Sevilla   Snaive      1863.     0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb419-7"><a href="#cb419-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">7</span>)</span>
<span id="cb419-8"><a href="#cb419-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb419-9"><a href="#cb419-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">21</span>)</span>
<span id="cb419-10"><a href="#cb419-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">h =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-36" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="days-36"><span class="header-section-number">9.5.1</span> 7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb420"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb420-3"><a href="#cb420-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb420-4"><a href="#cb420-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb420-5"><a href="#cb420-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb420-6"><a href="#cb420-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb420-7"><a href="#cb420-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-250-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb421-6"><a href="#cb421-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb421-7"><a href="#cb421-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-251-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb422"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test    27.5  78.6  56.6   3.30 10.0  0.396 0.288 0.143
2 arima_at2 Sevilla   Test    29.1  78.8  55.9   3.60  9.91 0.391 0.289 0.142
3 Snaive    Sevilla   Test  -305.  368.  311.  -48.0  49.4  2.17  1.35  0.523</code></pre>
</div>
</div>
</section>
<section id="days-37" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="days-37"><span class="header-section-number">9.5.2</span> 14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb424"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb424-7"><a href="#cb424-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-253-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-254-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb426"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   131.  223.  156.  13.5  21.5  1.09 0.817 0.433
2 arima_at2 Sevilla   Test   133.  224.  157.  13.9  21.4  1.09 0.822 0.432
3 Snaive    Sevilla   Test  -297.  338.  299. -50.4  51.1  2.09 1.24  0.411</code></pre>
</div>
</div>
</section>
<section id="days-38" class="level3" data-number="9.5.3">
<h3 data-number="9.5.3" class="anchored" data-anchor-id="days-38"><span class="header-section-number">9.5.3</span> 21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb428"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb428-5"><a href="#cb428-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb428-6"><a href="#cb428-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb428-7"><a href="#cb428-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-256-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-257-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb430"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   118.  208.  154.   9.96  26.1  1.08 0.762 0.499
2 arima_at2 Sevilla   Test   121.  209.  155.  10.4   26.0  1.08 0.767 0.498
3 Snaive    Sevilla   Test  -380.  430.  381. -76.5   77.0  2.67 1.58  0.507</code></pre>
</div>
</div>
</section>
<section id="days-39" class="level3" data-number="9.5.4">
<h3 data-number="9.5.4" class="anchored" data-anchor-id="days-39"><span class="header-section-number">9.5.4</span> 90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb432"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a>            data_sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>))</span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb432-7"><a href="#cb432-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-259-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>            data_sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">92</span>) <span class="sc">&amp;</span></span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="univariate_files/figure-html/unnamed-chunk-260-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The future dataset is incomplete, incomplete out-of-sample data will be treated as missing. 
33 observations are missing between 2022-03-30 and 2022-05-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   -49.7  208.  157.  -Inf   Inf  1.10 0.761 0.718
2 arima_at2 Sevilla   Test   -47.4  207.  156.  -Inf   Inf  1.09 0.759 0.717
3 Snaive    Sevilla   Test  -737.   850.  738.  -Inf   Inf  5.16 3.11  0.642</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./stl.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">STL decomposition / Transformations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./multivariate.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multivariate data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>