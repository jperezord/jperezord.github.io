<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.345">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PEC3 - COVID-19 Outbreak prediction - Multivariate (Google mobility + temp) prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<link href="./lstm.html" rel="next">
<link href="./multivariate.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Multivariate (Google mobility + temp) prediction</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PEC3 - COVID-19 Outbreak prediction</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jperezord/jperezord.github.io.git" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./data.html" class="sidebar-item-text sidebar-link">Task 1: Data acquisition and exploration</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cne_data.html" class="sidebar-item-text sidebar-link">CNE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ine_data.html" class="sidebar-item-text sidebar-link">INE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./google_data.html" class="sidebar-item-text sidebar-link">GOOGLE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aemet_data.html" class="sidebar-item-text sidebar-link">AEMET data</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./combination.html" class="sidebar-item-text sidebar-link">Task 2: Datasets combination</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visual.html" class="sidebar-item-text sidebar-link">Task 3: Visual analysis</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./arima.html" class="sidebar-item-text sidebar-link">Task 4: ARIMA</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acf.html" class="sidebar-item-text sidebar-link">ACF and PACF plots</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stl.html" class="sidebar-item-text sidebar-link">STL decomposition / Transformations</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate.html" class="sidebar-item-text sidebar-link">Univariate prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate_temp.html" class="sidebar-item-text sidebar-link">Multivariate (temperature) prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate.html" class="sidebar-item-text sidebar-link">Multivariate (INE mobility + temp) prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate_google.html" class="sidebar-item-text sidebar-link active">Multivariate (Google mobility + temp) prediction</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lstm.html" class="sidebar-item-text sidebar-link">Task 5: LSTM</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-sixth-epidemiological-period" id="toc-before-sixth-epidemiological-period" class="nav-link active" data-scroll-target="#before-sixth-epidemiological-period">Before sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias" id="toc-asturias" class="nav-link" data-scroll-target="#asturias">Asturias</a>
  <ul class="collapse">
  <li><a href="#days" id="toc-days" class="nav-link" data-scroll-target="#days">7 days</a></li>
  <li><a href="#days-1" id="toc-days-1" class="nav-link" data-scroll-target="#days-1">14 days</a></li>
  <li><a href="#days-2" id="toc-days-2" class="nav-link" data-scroll-target="#days-2">21 days</a></li>
  <li><a href="#days-3" id="toc-days-3" class="nav-link" data-scroll-target="#days-3">90 days</a></li>
  </ul></li>
  <li><a href="#barcelona" id="toc-barcelona" class="nav-link" data-scroll-target="#barcelona">Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-4" id="toc-days-4" class="nav-link" data-scroll-target="#days-4">7 days</a></li>
  <li><a href="#days-5" id="toc-days-5" class="nav-link" data-scroll-target="#days-5">14 days</a></li>
  <li><a href="#days-6" id="toc-days-6" class="nav-link" data-scroll-target="#days-6">21 days</a></li>
  <li><a href="#days-7" id="toc-days-7" class="nav-link" data-scroll-target="#days-7">90 days</a></li>
  </ul></li>
  <li><a href="#madrid" id="toc-madrid" class="nav-link" data-scroll-target="#madrid">Madrid</a>
  <ul class="collapse">
  <li><a href="#days-8" id="toc-days-8" class="nav-link" data-scroll-target="#days-8">7 days</a></li>
  <li><a href="#days-9" id="toc-days-9" class="nav-link" data-scroll-target="#days-9">14 days</a></li>
  <li><a href="#days-10" id="toc-days-10" class="nav-link" data-scroll-target="#days-10">21 days</a></li>
  <li><a href="#days-11" id="toc-days-11" class="nav-link" data-scroll-target="#days-11">90 days</a></li>
  </ul></li>
  <li><a href="#malaga" id="toc-malaga" class="nav-link" data-scroll-target="#malaga">Malaga</a>
  <ul class="collapse">
  <li><a href="#days-12" id="toc-days-12" class="nav-link" data-scroll-target="#days-12">7 days</a></li>
  <li><a href="#days-13" id="toc-days-13" class="nav-link" data-scroll-target="#days-13">14 days</a></li>
  <li><a href="#days-14" id="toc-days-14" class="nav-link" data-scroll-target="#days-14">21 days</a></li>
  <li><a href="#days-15" id="toc-days-15" class="nav-link" data-scroll-target="#days-15">90 days</a></li>
  </ul></li>
  <li><a href="#sevilla" id="toc-sevilla" class="nav-link" data-scroll-target="#sevilla">Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-16" id="toc-days-16" class="nav-link" data-scroll-target="#days-16">7 days</a></li>
  <li><a href="#days-17" id="toc-days-17" class="nav-link" data-scroll-target="#days-17">14 days</a></li>
  <li><a href="#days-18" id="toc-days-18" class="nav-link" data-scroll-target="#days-18">21 days</a></li>
  <li><a href="#days-19" id="toc-days-19" class="nav-link" data-scroll-target="#days-19">90 days</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#middel-of-sixth-epidemiological-period" id="toc-middel-of-sixth-epidemiological-period" class="nav-link" data-scroll-target="#middel-of-sixth-epidemiological-period">Middel of sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias-1" id="toc-asturias-1" class="nav-link" data-scroll-target="#asturias-1">Asturias</a>
  <ul class="collapse">
  <li><a href="#days-20" id="toc-days-20" class="nav-link" data-scroll-target="#days-20">7 days</a></li>
  <li><a href="#days-21" id="toc-days-21" class="nav-link" data-scroll-target="#days-21">14 days</a></li>
  <li><a href="#days-22" id="toc-days-22" class="nav-link" data-scroll-target="#days-22">21 days</a></li>
  <li><a href="#days-23" id="toc-days-23" class="nav-link" data-scroll-target="#days-23">57 days</a></li>
  </ul></li>
  <li><a href="#barcelona-1" id="toc-barcelona-1" class="nav-link" data-scroll-target="#barcelona-1">Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-24" id="toc-days-24" class="nav-link" data-scroll-target="#days-24">7 days</a></li>
  <li><a href="#days-25" id="toc-days-25" class="nav-link" data-scroll-target="#days-25">14 days</a></li>
  <li><a href="#days-26" id="toc-days-26" class="nav-link" data-scroll-target="#days-26">21 days</a></li>
  <li><a href="#days-27" id="toc-days-27" class="nav-link" data-scroll-target="#days-27">57 days</a></li>
  </ul></li>
  <li><a href="#madrid-1" id="toc-madrid-1" class="nav-link" data-scroll-target="#madrid-1">Madrid</a>
  <ul class="collapse">
  <li><a href="#days-28" id="toc-days-28" class="nav-link" data-scroll-target="#days-28">7 days</a></li>
  <li><a href="#days-29" id="toc-days-29" class="nav-link" data-scroll-target="#days-29">14 days</a></li>
  <li><a href="#days-30" id="toc-days-30" class="nav-link" data-scroll-target="#days-30">21 days</a></li>
  <li><a href="#days-31" id="toc-days-31" class="nav-link" data-scroll-target="#days-31">57 days</a></li>
  </ul></li>
  <li><a href="#malaga-1" id="toc-malaga-1" class="nav-link" data-scroll-target="#malaga-1">Malaga</a>
  <ul class="collapse">
  <li><a href="#days-32" id="toc-days-32" class="nav-link" data-scroll-target="#days-32">7 days</a></li>
  <li><a href="#days-33" id="toc-days-33" class="nav-link" data-scroll-target="#days-33">14 days</a></li>
  <li><a href="#days-34" id="toc-days-34" class="nav-link" data-scroll-target="#days-34">21 days</a></li>
  <li><a href="#days-35" id="toc-days-35" class="nav-link" data-scroll-target="#days-35">57 days</a></li>
  </ul></li>
  <li><a href="#sevilla-1" id="toc-sevilla-1" class="nav-link" data-scroll-target="#sevilla-1">Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-36" id="toc-days-36" class="nav-link" data-scroll-target="#days-36">7 days</a></li>
  <li><a href="#days-37" id="toc-days-37" class="nav-link" data-scroll-target="#days-37">14 days</a></li>
  <li><a href="#days-38" id="toc-days-38" class="nav-link" data-scroll-target="#days-38">21 days</a></li>
  <li><a href="#days-39" id="toc-days-39" class="nav-link" data-scroll-target="#days-39">57 days</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Multivariate (Google mobility + temp) prediction</h1>
</div>





<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Load packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>      here,      <span class="co"># file locator</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      tidyverse, <span class="co"># data management and ggplot2 graphics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      skimr,     <span class="co"># get overview of data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      janitor,   <span class="co"># produce and adorn tabulations and cross-tabulations</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      tsibble,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      fable,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      feasts,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      fabletools,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      lubridate</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>covid_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"clean"</span>, <span class="st">"final_covid_data.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The temporal limits of our prediction will be:</p>
<ul>
<li>Data as of June 14th 2020 which is considered the beginning of the second epidemiological period in Spain</li>
<li>In the first case scenario, data previous the start of the sixth wave of covid-19 (14 oct 2021).</li>
<li>In the second case scenario, all the available data (limited by mobility information 29 dec 2021)</li>
</ul>
<section id="before-sixth-epidemiological-period" class="level1">
<h1>Before sixth epidemiological period</h1>
<section id="asturias" class="level2">
<h2 class="anchored" data-anchor-id="asturias">Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0  16                   -6          39
 2 Asturias  2020-06-16         1  15.6                 -6           7
 3 Asturias  2020-06-17         0  15.6                 -7          20
 4 Asturias  2020-06-18         0  15.1                 -4          68
 5 Asturias  2020-06-19         0  14.8                 -4          52
 6 Asturias  2020-06-20         0  16.8                -10          71
 7 Asturias  2020-06-21         0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0  18.2                 -1          99
 9 Asturias  2020-06-23         0  20                   -2         129
10 Asturias  2020-06-24         0  18.2                 -9          63
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work),</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos))</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(best$var.coef)): Se han producido NaNs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Asturias  &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.955   -675. 1380. 1381. 1443. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
2 Asturias  arima_at2  0.922   -668. 1363. 1364. 1417. &lt;cpl [9]&gt;  &lt;cpl [8]&gt;
3 Asturias  Snaive     2.32      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,0,1)(1,0,1)[7] errors&gt;  0.922   -668. 1363. 1364. 1417.
2 arima_… &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;  0.955   -675. 1380. 1381. 1443.
3 Snaive                               &lt;SNAIVE&gt;  2.32      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    17.1    0.0165
2 Asturias  arima_at2    12.1    0.0972
3 Asturias  Snaive      629.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    35.5   0.00125
2 Asturias  arima_at2    28.9   0.0108 
3 Asturias  Snaive      892.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    52.1  0.000185
2 Asturias  arima_at2    38.2  0.0121  
3 Asturias  Snaive      927.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1   128.    0.00526
2 Asturias  arima_at2    99.4   0.233  
3 Asturias  Snaive     1195.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days" class="level3">
<h3 class="anchored" data-anchor-id="days">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   3.68  9.00  5.65   6.27  23.7 0.114 0.110 0.0968 
2 arima_at2 Asturias  Test   5.62  9.84  6.95  15.8   29.0 0.140 0.120 0.318  
3 Snaive    Asturias  Test   2.41 14.0   9.98 -10.1   49.0 0.201 0.171 0.00766</code></pre>
</div>
</div>
</section>
<section id="days-1" class="level3">
<h3 class="anchored" data-anchor-id="days-1">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   7.39  11.7  8.37 18.2   26.9 0.168 0.142  0.0327
2 arima_at2 Asturias  Test  11.4   15.0 12.1  33.0   39.6 0.243 0.183  0.304 
3 Snaive    Asturias  Test   6.69  16.0 11.4   8.17  41.5 0.229 0.195 -0.156 </code></pre>
</div>
</div>
</section>
<section id="days-2" class="level3">
<h3 class="anchored" data-anchor-id="days-2">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE     ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 arima_at1 Asturias  Test   4.99  10.5  7.85  9.97  26.3 0.158 0.128 -0.00881
2 arima_at2 Asturias  Test  11.7   14.8 12.1  34.3   38.7 0.243 0.180  0.155  
3 Snaive    Asturias  Test   5.77  15.6 11.5   6.52  40.8 0.232 0.190 -0.223  </code></pre>
</div>
</div>
</section>
<section id="days-3" class="level3">
<h3 class="anchored" data-anchor-id="days-3">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   689. 1200.  691.  56.5  64.2  13.9  14.6 0.925
2 arima_at2 Asturias  Test   721. 1229.  721.  74.4  75.9  14.5  15.0 0.926
3 Snaive    Asturias  Test   702. 1213.  704.  60.0  71.7  14.2  14.8 0.925</code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona" class="level2">
<h2 class="anchored" data-anchor-id="barcelona">Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>data_Barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62  21.2                   -9        17
 2 Barcelona 2020-06-16        66  20.8                  -10       -16
 3 Barcelona 2020-06-17        70  20.3                   -4        14
 4 Barcelona 2020-06-18        68  18.8                   -8        -6
 5 Barcelona 2020-06-19        65  20.4                   -5        10
 6 Barcelona 2020-06-20        53  21.8                  -12        15
 7 Barcelona 2020-06-21        38  22.8                  -18        18
 8 Barcelona 2020-06-22        69  23.8                    5        24
 9 Barcelona 2020-06-23        95  23.4                   19        28
10 Barcelona 2020-06-24        44  23.6                  -71        28
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_train <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_test <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work),</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos))</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Barcelona &lt;LM w/ ARIMA(1,0,2)(1,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
1 Barcelona arima_at1  0.501   -525. 1076. 1077. 1131. &lt;cpl [8]&gt; &lt;cpl [2]&gt;
2 Barcelona arima_at2  0.492   -520. 1068. 1069. 1127. &lt;cpl [9]&gt; &lt;cpl [2]&gt;
3 Barcelona Snaive     3.23      NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,0,2)(1,0,0)[7] errors&gt;  0.492   -520. 1068. 1069. 1127.
2 arima_… &lt;LM w/ ARIMA(1,0,2)(1,0,0)[7] errors&gt;  0.501   -525. 1076. 1077. 1131.
3 Snaive                               &lt;SNAIVE&gt;  3.23      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    49.8 0.0000000156 
2 Barcelona arima_at2    52.9 0.00000000385
3 Barcelona Snaive     1648.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    68.6 0.00000000350
2 Barcelona arima_at2    69.2 0.00000000268
3 Barcelona Snaive     2222.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat    lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 Barcelona arima_at1    77.6 0.0000000204
2 Barcelona arima_at2    78.4 0.0000000147
3 Barcelona Snaive     2272.  0           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat    lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 Barcelona arima_at1    182. 0.0000000314
2 Barcelona arima_at2    176. 0.000000148 
3 Barcelona Snaive      3575. 0           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-4" class="level3">
<h3 class="anchored" data-anchor-id="days-4">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  -29.5  75.9  67.0 -20.3  40.8 0.178 0.114 0.551
2 arima_at2 Barcelona Test  -45.0  88.5  79.0 -28.7  47.2 0.210 0.134 0.598
3 Snaive    Barcelona Test  -25.0  80.0  67.1 -17.8  40.2 0.178 0.121 0.187</code></pre>
</div>
</div>
</section>
<section id="days-5" class="level3">
<h3 class="anchored" data-anchor-id="days-5">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test  -17.3  72.1  63.5 -12.7  34.8 0.169 0.109 0.462 
2 arima_at2 Barcelona Test  -47.5  91.4  80.9 -27.0  43.8 0.215 0.138 0.505 
3 Snaive    Barcelona Test  -21.3  88.0  75.0 -15.3  40.3 0.199 0.133 0.0630</code></pre>
</div>
</div>
</section>
<section id="days-6" class="level3">
<h3 class="anchored" data-anchor-id="days-6">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test    2.67  82.2  67.8  -7.70  33.2 0.180 0.124  0.389
2 arima_at2 Barcelona Test  -46.5   91.9  83.2 -28.8   43.5 0.221 0.139  0.321
3 Snaive    Barcelona Test  -10.1  119.   90.1 -14.8   41.9 0.239 0.179 -0.242</code></pre>
</div>
</div>
</section>
<section id="days-7" class="level3">
<h3 class="anchored" data-anchor-id="days-7">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  4772. 8726. 4788.  55.3  65.0  12.7  13.2 0.867
2 arima_at2 Barcelona Test  4698. 8750. 4736.  42.6  61.9  12.6  13.2 0.869
3 Snaive    Barcelona Test  4888. 8865. 4913.  56.6  70.5  13.1  13.4 0.870</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid" class="level2">
<h2 class="anchored" data-anchor-id="madrid">Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>data_Madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>data_Madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153  20.7                   -8        34
 2 Madrid    2020-06-16        91  21                     -8        21
 3 Madrid    2020-06-17        93  20.2                   -5        34
 4 Madrid    2020-06-18        85  21.9                   -7        30
 5 Madrid    2020-06-19        78  22.6                   -9        22
 6 Madrid    2020-06-20        67  23.4                  -12        25
 7 Madrid    2020-06-21        42  25                    -13        14
 8 Madrid    2020-06-22        60  27.3                   -8        29
 9 Madrid    2020-06-23        68  28.4                   -9        23
10 Madrid    2020-06-24        49  28                     -7        22
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_train <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_test <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work)</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work),</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos))</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Madrid    &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Madrid    arima_at1  0.494   -519. 1066. 1067. 1125. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
2 Madrid    arima_at2  0.494   -519. 1066. 1067. 1125. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
3 Madrid    Snaive     3.02      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;  0.494   -519. 1066. 1067. 1125.
2 arima_… &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;  0.494   -519. 1066. 1067. 1125.
3 Snaive                               &lt;SNAIVE&gt;  3.02      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    8.14     0.320
2 Madrid    arima_at2    8.14     0.320
3 Madrid    Snaive    1553.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    19.6     0.144
2 Madrid    arima_at2    19.6     0.144
3 Madrid    Snaive     2371.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    29.2     0.109
2 Madrid    arima_at2    29.2     0.109
3 Madrid    Snaive     2571.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    119.    0.0225
2 Madrid    arima_at2    119.    0.0225
3 Madrid    Snaive      3699.    0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-8" class="level3">
<h3 class="anchored" data-anchor-id="days-8">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Madrid    Test   66.6  114.  98.7 10.6   38.9 0.233 0.170 -0.142
2 arima_at2 Madrid    Test   66.6  114.  98.7 10.6   38.9 0.233 0.170 -0.142
3 Snaive    Madrid    Test   25.6  123. 102.  -9.85  47.5 0.240 0.183 -0.107</code></pre>
</div>
</div>
</section>
<section id="days-9" class="level3">
<h3 class="anchored" data-anchor-id="days-9">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Madrid    Test   71.3  118.  102.  12.6  38.2 0.240 0.176 -0.0603
2 arima_at2 Madrid    Test   71.3  118.  102.  12.6  38.2 0.240 0.176 -0.0603
3 Snaive    Madrid    Test   16.7  124.  102. -12.8  46.7 0.240 0.185 -0.0438</code></pre>
</div>
</div>
</section>
<section id="days-10" class="level3">
<h3 class="anchored" data-anchor-id="days-10">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test   89.9  148.  121.  15.5  40.0 0.285 0.220 0.225
2 arima_at2 Madrid    Test   89.9  148.  121.  15.5  40.0 0.285 0.220 0.225
3 Snaive    Madrid    Test   22.0  137.  112. -13.4  48.6 0.264 0.204 0.131</code></pre>
</div>
</div>
</section>
<section id="days-11" class="level3">
<h3 class="anchored" data-anchor-id="days-11">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  4656. 8366. 4665.  56.9  63.6  11.0  12.5 0.838
2 arima_at2 Madrid    Test  4656. 8366. 4665.  56.9  63.6  11.0  12.5 0.838
3 Snaive    Madrid    Test  4718. 8525. 4752.  47.9  67.2  11.2  12.7 0.839</code></pre>
</div>
</div>
</section>
</section>
<section id="malaga" class="level2">
<h2 class="anchored" data-anchor-id="malaga">Malaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>data_Malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>data_Malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1  27.2                  -16        -9
 2 Málaga    2020-06-16         1  27.8                  -13        -4
 3 Málaga    2020-06-17         2  26.9                  -13         1
 4 Málaga    2020-06-18         2  21.6                  -12         3
 5 Málaga    2020-06-19         1  24.7                  -12         2
 6 Málaga    2020-06-20         4  22.6                  -14         8
 7 Málaga    2020-06-21         4  22.7                  -16        -3
 8 Málaga    2020-06-22         6  25                    -13         1
 9 Málaga    2020-06-23         8  25.6                  -10        18
10 Málaga    2020-06-24        65  24.5                  -13        12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_train <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_test <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work)</span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work),</span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos))</span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Málaga    &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Málaga    arima_at1  0.469   -500. 1029. 1030. 1087. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
2 Málaga    arima_at2  0.464   -498. 1024. 1025. 1083. &lt;cpl [16]&gt; &lt;cpl [2]&gt;
3 Málaga    Snaive     2.08      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,1,2)(2,0,0)[7] errors&gt;  0.464   -498. 1024. 1025. 1083.
2 arima_… &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;  0.469   -500. 1029. 1030. 1087.
3 Snaive                               &lt;SNAIVE&gt;  2.08      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    6.82     0.448
2 Málaga    arima_at2    4.67     0.700
3 Málaga    Snaive    1353.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    17.7     0.219
2 Málaga    arima_at2    10.6     0.715
3 Málaga    Snaive     1943.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    24.8     0.257
2 Málaga    arima_at2    17.7     0.668
3 Málaga    Snaive     2088.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1   121.     0.0171
2 Málaga    arima_at2    87.8    0.545 
3 Málaga    Snaive     3170.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-12" class="level3">
<h3 class="anchored" data-anchor-id="days-12">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test   9.98  18.0  16.2   7.92  34.9 0.164 0.107 -0.0177
2 arima_at2 Málaga    Test  10.2   18.3  16.3   8.34  35.0 0.166 0.108  0.0652
3 Snaive    Málaga    Test  -3.97  22.9  19.8 -27.0   52.2 0.201 0.135  0.0122</code></pre>
</div>
</div>
</section>
<section id="days-13" class="level3">
<h3 class="anchored" data-anchor-id="days-13">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test  13.0   21.1  17.6  13.8  31.5 0.179 0.124  0.199 
2 arima_at2 Málaga    Test  13.7   21.7  17.9  15.2  31.7 0.182 0.128  0.241 
3 Snaive    Málaga    Test  -3.81  22.7  18.7 -22.3  43.6 0.190 0.134 -0.0975</code></pre>
</div>
</div>
</section>
<section id="days-14" class="level3">
<h3 class="anchored" data-anchor-id="days-14">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test  18.4    26.2  22.0  20.8  33.9 0.224 0.154 0.260 
2 arima_at2 Málaga    Test  18.5    26.0  22.0  21.1  33.8 0.223 0.154 0.246 
3 Snaive    Málaga    Test  -0.886  22.0  18.6 -14.7  37.8 0.189 0.130 0.0886</code></pre>
</div>
</div>
</section>
<section id="days-15" class="level3">
<h3 class="anchored" data-anchor-id="days-15">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   628. 1042.  629.  58.6  62.8  6.39  6.16 0.933
2 arima_at2 Málaga    Test   599. 1007.  601.  53.2  57.8  6.10  5.95 0.932
3 Snaive    Málaga    Test   621. 1049.  628.  45.0  62.4  6.38  6.20 0.929</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla" class="level2">
<h2 class="anchored" data-anchor-id="sevilla">Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>data_Sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2  23.1                  -14       -13
 2 Sevilla   2020-06-16         1  24.0                  -10        -4
 3 Sevilla   2020-06-17         0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1  29.3                  -17       -19
 9 Sevilla   2020-06-23         0  30.2                  -12       -13
10 Sevilla   2020-06-24         1  29.4                  -12       -12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_train <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_test <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work)</span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb284-18"><a href="#cb284-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb284-19"><a href="#cb284-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work),</span>
<span id="cb284-20"><a href="#cb284-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb284-21"><a href="#cb284-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos))</span>
<span id="cb284-22"><a href="#cb284-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb284-23"><a href="#cb284-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-24"><a href="#cb284-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb284-25"><a href="#cb284-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Sevilla   &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Sevilla   arima_at1  0.855   -647. 1321. 1322. 1380. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Sevilla   arima_at2  0.837   -643. 1311. 1312. 1366. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
3 Sevilla   Snaive     2.47      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(3,1,0)(1,0,1)[7] errors&gt;  0.837   -643. 1311. 1312. 1366.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.855   -647. 1321. 1322. 1380.
3 Snaive                               &lt;SNAIVE&gt;  2.47      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-121-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-122-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-123-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    6.00     0.539
2 Sevilla   arima_at2   11.6      0.116
3 Sevilla   Snaive     995.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    15.7     0.333
2 Sevilla   arima_at2    21.0     0.101
3 Sevilla   Snaive     1444.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    29.5    0.103 
2 Sevilla   arima_at2    31.9    0.0603
3 Sevilla   Snaive     1580.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    124.  0.0104  
2 Sevilla   arima_at2    145.  0.000218
3 Sevilla   Snaive      2311.  0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb301-14"><a href="#cb301-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-16" class="level3">
<h3 class="anchored" data-anchor-id="days-16">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-130-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-131-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Sevilla   Test   3.54  9.18  7.23   8.02  21.4 0.0714 0.0582 -0.475 
2 arima_at2 Sevilla   Test   7.41 10.6   8.11  20.4   23.0 0.0801 0.0675 -0.416 
3 Snaive    Sevilla   Test  -5.28 15.6  13.3  -20.3   39.3 0.131  0.0990  0.0323</code></pre>
</div>
</div>
</section>
<section id="days-17" class="level3">
<h3 class="anchored" data-anchor-id="days-17">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-133-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-134-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model   provincia .type      ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE   ACF1
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 arima_a… Sevilla   Test    0.949  8.67  7.40  -6.17  28.5 0.0731 0.0549 -0.387
2 arima_a… Sevilla   Test    6.21  10.4   7.82  14.3   24.1 0.0772 0.0659 -0.416
3 Snaive   Sevilla   Test  -11.6   18.4  15.6  -54.4   63.9 0.154  0.117   0.268</code></pre>
</div>
</div>
</section>
<section id="days-18" class="level3">
<h3 class="anchored" data-anchor-id="days-18">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-136-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-137-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model  provincia .type     ME  RMSE   MAE     MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_… Sevilla   Test    3.38  10.7  8.64   0.302  28.6 0.0853 0.0681 -0.0110
2 arima_… Sevilla   Test    9.87  14.6 10.9   23.4    30.0 0.108  0.0924  0.143 
3 Snaive  Sevilla   Test  -12.8   21.0 18.2  -57.0    68.6 0.180  0.133   0.328 </code></pre>
</div>
</div>
</section>
<section id="days-19" class="level3">
<h3 class="anchored" data-anchor-id="days-19">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-139-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-140-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   687. 1168.  689.  58.0  66.1  6.80  7.40 0.898
2 arima_at2 Sevilla   Test   717. 1200.  717.  71.8  73.5  7.09  7.61 0.898
3 Snaive    Sevilla   Test   669. 1164.  680.  34.0  74.1  6.72  7.38 0.893</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="middel-of-sixth-epidemiological-period" class="level1">
<h1>Middel of sixth epidemiological period</h1>
<section id="asturias-1" class="level2">
<h2 class="anchored" data-anchor-id="asturias-1">Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0  16                   -6          39
 2 Asturias  2020-06-16         1  15.6                 -6           7
 3 Asturias  2020-06-17         0  15.6                 -7          20
 4 Asturias  2020-06-18         0  15.1                 -4          68
 5 Asturias  2020-06-19         0  14.8                 -4          52
 6 Asturias  2020-06-20         0  16.8                -10          71
 7 Asturias  2020-06-21         0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0  18.2                 -1          99
 9 Asturias  2020-06-23         0  20                   -2         129
10 Asturias  2020-06-24         0  18.2                 -9          63
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb347-9"><a href="#cb347-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb347-10"><a href="#cb347-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work)</span>
<span id="cb347-11"><a href="#cb347-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb347-12"><a href="#cb347-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb347-13"><a href="#cb347-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb347-14"><a href="#cb347-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb347-15"><a href="#cb347-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb347-16"><a href="#cb347-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb347-17"><a href="#cb347-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb347-18"><a href="#cb347-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb347-19"><a href="#cb347-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work),</span>
<span id="cb347-20"><a href="#cb347-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb347-21"><a href="#cb347-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos))</span>
<span id="cb347-22"><a href="#cb347-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb347-23"><a href="#cb347-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-24"><a href="#cb347-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb347-25"><a href="#cb347-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Asturias  &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.916   -812. 1653. 1653. 1714. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Asturias  arima_at2  0.891   -806. 1634. 1635. 1683. &lt;cpl [7]&gt;  &lt;cpl [8]&gt;
3 Asturias  Snaive     2.53      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(0,1,1)(1,0,1)[7] errors&gt;  0.891   -806. 1634. 1635. 1683.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.916   -812. 1653. 1653. 1714.
3 Snaive                               &lt;SNAIVE&gt;  2.53      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-149-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-150-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-151-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    16.9    0.0184
2 Asturias  arima_at2    15.5    0.0301
3 Asturias  Snaive      981.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    38.0  0.000521
2 Asturias  arima_at2    34.2  0.00190 
3 Asturias  Snaive     1393.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    58.5 0.0000214
2 Asturias  arima_at2    47.4 0.000829 
3 Asturias  Snaive     1470.  0        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1   103.   0.000188
2 Asturias  arima_at2    79.8  0.0249  
3 Asturias  Snaive     1527.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb364-5"><a href="#cb364-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb364-6"><a href="#cb364-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb364-7"><a href="#cb364-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb364-8"><a href="#cb364-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb364-9"><a href="#cb364-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb364-10"><a href="#cb364-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb364-11"><a href="#cb364-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb364-12"><a href="#cb364-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb364-13"><a href="#cb364-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb364-14"><a href="#cb364-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb365-10"><a href="#cb365-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-20" class="level3">
<h3 class="anchored" data-anchor-id="days-20">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-158-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb367-7"><a href="#cb367-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-159-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Asturias  Test  -168.  272.  248. -24.8  29.9  2.56  1.24  0.200
2 arima_at2 Asturias  Test  -253.  336.  319. -33.9  38.0  3.29  1.53  0.166
3 Snaive    Asturias  Test  -570.  586.  570. -62.8  62.8  5.89  2.66 -0.550</code></pre>
</div>
</div>
</section>
<section id="days-21" class="level3">
<h3 class="anchored" data-anchor-id="days-21">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb370-6"><a href="#cb370-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb370-7"><a href="#cb370-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-161-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb371-7"><a href="#cb371-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-162-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test  -271.  335.  311.  -44.3  46.9  3.21  1.52 0.387
2 arima_at2 Asturias  Test  -402.  461.  434.  -62.5  64.5  4.49  2.09 0.457
3 Snaive    Asturias  Test  -769.  812.  769. -107.  107.   7.94  3.69 0.299</code></pre>
</div>
</div>
</section>
<section id="days-22" class="level3">
<h3 class="anchored" data-anchor-id="days-22">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-164-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb375-6"><a href="#cb375-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb375-7"><a href="#cb375-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-165-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test  -353.  410.  380.  -74.4  76.1  3.93  1.87 0.530
2 arima_at2 Asturias  Test  -502.  555.  524. -100.  101.   5.42  2.52 0.602
3 Snaive    Asturias  Test  -920.  980.  920. -168.  168.   9.50  4.46 0.437</code></pre>
</div>
</div>
</section>
<section id="days-23" class="level3">
<h3 class="anchored" data-anchor-id="days-23">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb378-4"><a href="#cb378-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb378-5"><a href="#cb378-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb378-6"><a href="#cb378-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb378-7"><a href="#cb378-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-167-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb379-7"><a href="#cb379-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-168-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   -571.  623.  581.  -Inf   Inf  6.00  2.83 0.706
2 arima_at2 Asturias  Test   -707.  749.  715.  -Inf   Inf  7.39  3.41 0.710
3 Snaive    Asturias  Test  -1282. 1359. 1282.  -Inf   Inf 13.3   6.18 0.471</code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona-1" class="level2">
<h2 class="anchored" data-anchor-id="barcelona-1">Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>data_Barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62  21.2                   -9        17
 2 Barcelona 2020-06-16        66  20.8                  -10       -16
 3 Barcelona 2020-06-17        70  20.3                   -4        14
 4 Barcelona 2020-06-18        68  18.8                   -8        -6
 5 Barcelona 2020-06-19        65  20.4                   -5        10
 6 Barcelona 2020-06-20        53  21.8                  -12        15
 7 Barcelona 2020-06-21        38  22.8                  -18        18
 8 Barcelona 2020-06-22        69  23.8                    5        24
 9 Barcelona 2020-06-23        95  23.4                   19        28
10 Barcelona 2020-06-24        44  23.6                  -71        28
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_train <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_test <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb402"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb410-4"><a href="#cb410-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb410-5"><a href="#cb410-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb410-6"><a href="#cb410-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb410-7"><a href="#cb410-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb410-8"><a href="#cb410-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb410-9"><a href="#cb410-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb410-10"><a href="#cb410-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work)</span>
<span id="cb410-11"><a href="#cb410-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb410-12"><a href="#cb410-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb410-13"><a href="#cb410-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb410-14"><a href="#cb410-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb410-15"><a href="#cb410-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb410-16"><a href="#cb410-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb410-17"><a href="#cb410-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb410-18"><a href="#cb410-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb410-19"><a href="#cb410-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work),</span>
<span id="cb410-20"><a href="#cb410-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb410-21"><a href="#cb410-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos))</span>
<span id="cb410-22"><a href="#cb410-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb410-23"><a href="#cb410-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-24"><a href="#cb410-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb410-25"><a href="#cb410-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Barcelona &lt;LM w/ ARIMA(1,1,0)(1,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Barcelona arima_at1  0.909   -816. 1652. 1653. 1696. &lt;cpl [8]&gt;  &lt;cpl [0]&gt;
2 Barcelona arima_at2  0.815   -783. 1591. 1592. 1648. &lt;cpl [15]&gt; &lt;cpl [2]&gt;
3 Barcelona Snaive     4.60      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb414-5"><a href="#cb414-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb414-6"><a href="#cb414-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb414-7"><a href="#cb414-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(1,1,2)(2,0,0)[7] errors&gt;  0.815   -783. 1591. 1592. 1648.
2 arima_… &lt;LM w/ ARIMA(1,1,0)(1,0,0)[7] errors&gt;  0.909   -816. 1652. 1653. 1696.
3 Snaive                               &lt;SNAIVE&gt;  4.60      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-177-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-178-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb418"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-179-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    54.6 0.00000000179
2 Barcelona arima_at2    15.2 0.0332       
3 Barcelona Snaive     1689.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    70.7 0.00000000145
2 Barcelona arima_at2    37.2 0.000690     
3 Barcelona Snaive     2232.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    79.7 0.00000000897
2 Barcelona arima_at2    41.8 0.00443      
3 Barcelona Snaive     2328.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1   150.   3.08e-10
2 Barcelona arima_at2    99.5  4.27e- 4
3 Barcelona Snaive     2625.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb427-7"><a href="#cb427-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb427-8"><a href="#cb427-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb427-9"><a href="#cb427-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb427-10"><a href="#cb427-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb427-11"><a href="#cb427-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb427-12"><a href="#cb427-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb427-13"><a href="#cb427-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb427-14"><a href="#cb427-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb428"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb428-5"><a href="#cb428-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb428-6"><a href="#cb428-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb428-7"><a href="#cb428-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb428-8"><a href="#cb428-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb428-9"><a href="#cb428-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb428-10"><a href="#cb428-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-24" class="level3">
<h3 class="anchored" data-anchor-id="days-24">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-186-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb430"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb430-7"><a href="#cb430-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-187-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Barcelona Test   -304.  374.  304.  -4.15  4.15 0.382 0.191 -0.400 
2 arima_at2 Barcelona Test  -1168. 1213. 1168. -15.2  15.2  1.47  0.619 -0.0336
3 Snaive    Barcelona Test  -7681. 7943. 7681. -96.6  96.6  9.65  4.06   0.550 </code></pre>
</div>
</div>
</section>
<section id="days-25" class="level3">
<h3 class="anchored" data-anchor-id="days-25">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-189-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb434-6"><a href="#cb434-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb434-7"><a href="#cb434-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-190-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model  provincia .type     ME   RMSE   MAE     MPE   MAPE   MASE RMSSE   ACF1
  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_… Barcelona Test   -342.   432.  365.   -6.19   6.90  0.458 0.221 0.0799
2 arima_… Barcelona Test  -1123.  1217. 1123.  -19.4   19.4   1.41  0.621 0.408 
3 Snaive  Barcelona Test  -9702. 10297. 9702. -182.   182.   12.2   5.26  0.547 </code></pre>
</div>
</div>
</section>
<section id="days-26" class="level3">
<h3 class="anchored" data-anchor-id="days-26">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb437"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb437-7"><a href="#cb437-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-192-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb438-6"><a href="#cb438-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb438-7"><a href="#cb438-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-193-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb439-2"><a href="#cb439-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model provincia .type      ME   RMSE    MAE     MPE   MAPE   MASE RMSSE  ACF1
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima… Barcelona Test    -211.   381.   322.   -3.57   7.25  0.404 0.195 0.308
2 arima… Barcelona Test    -841.  1032.   886.  -15.5   17.4   1.11  0.527 0.620
3 Snaive Barcelona Test  -10898. 11601. 10898. -262.   262.   13.7   5.92  0.600</code></pre>
</div>
</div>
</section>
<section id="days-27" class="level3">
<h3 class="anchored" data-anchor-id="days-27">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb441-5"><a href="#cb441-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb441-6"><a href="#cb441-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb441-7"><a href="#cb441-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-195-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb442"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb442-4"><a href="#cb442-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb442-5"><a href="#cb442-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb442-6"><a href="#cb442-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb442-7"><a href="#cb442-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-196-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME   RMSE    MAE   MPE  MAPE   MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  -2.65e0   598.   482.  -Inf   Inf  0.605 0.305 0.689
2 arima_at2 Barcelona Test   6.08e1   912.   777.  -Inf   Inf  0.976 0.466 0.848
3 Snaive    Barcelona Test  -1.39e4 14803. 13931.  -Inf   Inf 17.5   7.56  0.580</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid-1" class="level2">
<h2 class="anchored" data-anchor-id="madrid-1">Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a>data_Madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb445-2"><a href="#cb445-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb445-3"><a href="#cb445-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-4"><a href="#cb445-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb445-5"><a href="#cb445-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb445-6"><a href="#cb445-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb445-7"><a href="#cb445-7" aria-hidden="true" tabindex="-1"></a>data_Madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153  20.7                   -8        34
 2 Madrid    2020-06-16        91  21                     -8        21
 3 Madrid    2020-06-17        93  20.2                   -5        34
 4 Madrid    2020-06-18        85  21.9                   -7        30
 5 Madrid    2020-06-19        78  22.6                   -9        22
 6 Madrid    2020-06-20        67  23.4                  -12        25
 7 Madrid    2020-06-21        42  25                    -13        14
 8 Madrid    2020-06-22        60  27.3                   -8        29
 9 Madrid    2020-06-23        68  28.4                   -9        23
10 Madrid    2020-06-24        49  28                     -7        22
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb447"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_train <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_test <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb451"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb451-2"><a href="#cb451-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb451-3"><a href="#cb451-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb451-4"><a href="#cb451-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb451-5"><a href="#cb451-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb453"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb453-5"><a href="#cb453-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb461"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb463"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb465"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb467"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb467-4"><a href="#cb467-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb469"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb469-2"><a href="#cb469-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb469-3"><a href="#cb469-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb471"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb473"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb473-5"><a href="#cb473-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb473-6"><a href="#cb473-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb473-7"><a href="#cb473-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb473-8"><a href="#cb473-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb473-9"><a href="#cb473-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb473-10"><a href="#cb473-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work)</span>
<span id="cb473-11"><a href="#cb473-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb473-12"><a href="#cb473-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb473-13"><a href="#cb473-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb473-14"><a href="#cb473-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb473-15"><a href="#cb473-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb473-16"><a href="#cb473-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb473-17"><a href="#cb473-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb473-18"><a href="#cb473-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb473-19"><a href="#cb473-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work),</span>
<span id="cb473-20"><a href="#cb473-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb473-21"><a href="#cb473-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos))</span>
<span id="cb473-22"><a href="#cb473-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb473-23"><a href="#cb473-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-24"><a href="#cb473-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb473-25"><a href="#cb473-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Madrid    &lt;LM w/ ARIMA(1,1,1)(1,0,2)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb475"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    
1 Madrid    arima_at1   1.18   -892. 1809. 1810. 1866. &lt;cpl [8]&gt; &lt;cpl [15]&gt;
2 Madrid    arima_at2   1.17   -889. 1804. 1804. 1861. &lt;cpl [8]&gt; &lt;cpl [9]&gt; 
3 Madrid    Snaive      5.10     NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb477-5"><a href="#cb477-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb477-6"><a href="#cb477-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb477-7"><a href="#cb477-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(1,1,2)(1,0,1)[7] errors&gt;   1.17   -889. 1804. 1804. 1861.
2 arima_… &lt;LM w/ ARIMA(1,1,1)(1,0,2)[7] errors&gt;   1.18   -892. 1809. 1810. 1866.
3 Snaive                               &lt;SNAIVE&gt;   5.10     NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb479-4"><a href="#cb479-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-205-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-206-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-207-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1   12.6     0.0823
2 Madrid    arima_at2    6.30    0.506 
3 Madrid    Snaive    1552.      0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb484-2"><a href="#cb484-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    25.5    0.0299
2 Madrid    arima_at2    21.3    0.0953
3 Madrid    Snaive     2076.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    36.2    0.0208
2 Madrid    arima_at2    33.0    0.0462
3 Madrid    Snaive     2151.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb488"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    86.2   0.00747
2 Madrid    arima_at2    78.0   0.0338 
3 Madrid    Snaive     2518.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb490-4"><a href="#cb490-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb490-5"><a href="#cb490-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb490-6"><a href="#cb490-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb490-7"><a href="#cb490-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb490-8"><a href="#cb490-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb490-9"><a href="#cb490-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb490-10"><a href="#cb490-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb490-11"><a href="#cb490-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb490-12"><a href="#cb490-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb490-13"><a href="#cb490-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb490-14"><a href="#cb490-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb491-4"><a href="#cb491-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb491-5"><a href="#cb491-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb491-6"><a href="#cb491-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb491-7"><a href="#cb491-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb491-8"><a href="#cb491-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb491-9"><a href="#cb491-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb491-10"><a href="#cb491-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-28" class="level3">
<h3 class="anchored" data-anchor-id="days-28">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb492"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb492-2"><a href="#cb492-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb492-3"><a href="#cb492-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb492-4"><a href="#cb492-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb492-5"><a href="#cb492-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb492-6"><a href="#cb492-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb492-7"><a href="#cb492-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-214-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb493"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb493-4"><a href="#cb493-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb493-5"><a href="#cb493-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb493-6"><a href="#cb493-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb493-7"><a href="#cb493-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-215-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Madrid    Test    268.  509.  401.   4.78  7.20 0.537 0.285 0.0164 
2 arima_at2 Madrid    Test    348.  569.  462.   6.71  8.51 0.619 0.319 0.00236
3 Snaive    Madrid    Test  -1649. 1869. 1649. -32.7  32.7  2.21  1.05  0.537  </code></pre>
</div>
</div>
</section>
<section id="days-29" class="level3">
<h3 class="anchored" data-anchor-id="days-29">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb496-6"><a href="#cb496-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb496-7"><a href="#cb496-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-217-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-218-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb498"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME  RMSE   MAE     MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test    -70.1  586.  460.  -3.97   12.0 0.615 0.328 0.309
2 arima_at2 Madrid    Test     56.2  553.  449.  -0.301  11.3 0.601 0.309 0.289
3 Snaive    Madrid    Test  -2634.  3064. 2634. -70.0    70.0 3.53  1.72  0.464</code></pre>
</div>
</div>
</section>
<section id="days-30" class="level3">
<h3 class="anchored" data-anchor-id="days-30">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb500"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb500-2"><a href="#cb500-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb500-3"><a href="#cb500-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb500-4"><a href="#cb500-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb500-5"><a href="#cb500-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb500-6"><a href="#cb500-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb500-7"><a href="#cb500-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-220-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb501"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb501-4"><a href="#cb501-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb501-5"><a href="#cb501-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb501-6"><a href="#cb501-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb501-7"><a href="#cb501-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-221-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb502"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb502-2"><a href="#cb502-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test   -449.  911.  709.  -25.2  30.6 0.949 0.510 0.559
2 arima_at2 Madrid    Test   -320.  830.  657.  -20.4  27.8 0.880 0.465 0.555
3 Snaive    Madrid    Test  -3530. 4142. 3530. -143.  143.  4.73  2.32  0.576</code></pre>
</div>
</div>
</section>
<section id="days-31" class="level3">
<h3 class="anchored" data-anchor-id="days-31">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb504"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb504-4"><a href="#cb504-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb504-5"><a href="#cb504-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb504-6"><a href="#cb504-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb504-7"><a href="#cb504-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-223-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb505-5"><a href="#cb505-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb505-6"><a href="#cb505-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb505-7"><a href="#cb505-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-224-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb506"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb506-2"><a href="#cb506-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  -1153. 1478. 1249. -1126. 1128.  1.67 0.828 0.660
2 arima_at2 Madrid    Test  -1337. 1762. 1461. -1430. 1433.  1.96 0.986 0.741
3 Snaive    Madrid    Test  -5635. 6384. 5635. -4097. 4097.  7.54 3.57  0.622</code></pre>
</div>
</div>
</section>
</section>
<section id="malaga-1" class="level2">
<h2 class="anchored" data-anchor-id="malaga-1">Malaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb508"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a>data_Malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb508-3"><a href="#cb508-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb508-4"><a href="#cb508-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb508-5"><a href="#cb508-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb508-6"><a href="#cb508-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb508-7"><a href="#cb508-7" aria-hidden="true" tabindex="-1"></a>data_Malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1  27.2                  -16        -9
 2 Málaga    2020-06-16         1  27.8                  -13        -4
 3 Málaga    2020-06-17         2  26.9                  -13         1
 4 Málaga    2020-06-18         2  21.6                  -12         3
 5 Málaga    2020-06-19         1  24.7                  -12         2
 6 Málaga    2020-06-20         4  22.6                  -14         8
 7 Málaga    2020-06-21         4  22.7                  -16        -3
 8 Málaga    2020-06-22         6  25                    -13         1
 9 Málaga    2020-06-23         8  25.6                  -10        18
10 Málaga    2020-06-24        65  24.5                  -13        12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb510"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_train <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb510-2"><a href="#cb510-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb510-3"><a href="#cb510-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_test <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb512-3"><a href="#cb512-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb514"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb514-4"><a href="#cb514-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb514-5"><a href="#cb514-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb516"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb516-3"><a href="#cb516-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb516-4"><a href="#cb516-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb516-5"><a href="#cb516-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb518"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb518-3"><a href="#cb518-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb518-4"><a href="#cb518-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb520"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb522"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb522-2"><a href="#cb522-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb522-3"><a href="#cb522-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb522-4"><a href="#cb522-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb524"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb524-2"><a href="#cb524-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb524-3"><a href="#cb524-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb526"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb528"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb528-2"><a href="#cb528-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb528-3"><a href="#cb528-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb528-4"><a href="#cb528-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb530"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb530-2"><a href="#cb530-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb530-3"><a href="#cb530-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb530-4"><a href="#cb530-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb532"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb532-3"><a href="#cb532-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb534"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb536"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb536-5"><a href="#cb536-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb536-6"><a href="#cb536-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb536-7"><a href="#cb536-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb536-8"><a href="#cb536-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb536-9"><a href="#cb536-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb536-10"><a href="#cb536-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work)</span>
<span id="cb536-11"><a href="#cb536-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb536-12"><a href="#cb536-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb536-13"><a href="#cb536-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb536-14"><a href="#cb536-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb536-15"><a href="#cb536-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb536-16"><a href="#cb536-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb536-17"><a href="#cb536-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb536-18"><a href="#cb536-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb536-19"><a href="#cb536-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work),</span>
<span id="cb536-20"><a href="#cb536-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb536-21"><a href="#cb536-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos))</span>
<span id="cb536-22"><a href="#cb536-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb536-23"><a href="#cb536-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-24"><a href="#cb536-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb536-25"><a href="#cb536-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Málaga    &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb538"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
1 Málaga    arima_at1  0.568   -671. 1369. 1370. 1431. &lt;cpl [18]&gt; &lt;cpl [0]&gt; 
2 Málaga    arima_at2  0.550   -662. 1352. 1353. 1414. &lt;cpl [7]&gt;  &lt;cpl [11]&gt;
3 Málaga    Snaive     2.32      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb540"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb540-2"><a href="#cb540-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb540-3"><a href="#cb540-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb540-4"><a href="#cb540-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb540-5"><a href="#cb540-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb540-6"><a href="#cb540-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb540-7"><a href="#cb540-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(0,1,4)(1,0,1)[7] errors&gt;  0.550   -662. 1352. 1353. 1414.
2 arima_… &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;  0.568   -671. 1369. 1370. 1431.
3 Snaive                               &lt;SNAIVE&gt;  2.32      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb542"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb542-2"><a href="#cb542-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb542-3"><a href="#cb542-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb542-4"><a href="#cb542-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-233-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb543"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb543-2"><a href="#cb543-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb543-3"><a href="#cb543-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-234-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb544"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb544-2"><a href="#cb544-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb544-3"><a href="#cb544-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-235-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb545"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb545-2"><a href="#cb545-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    8.51     0.290
2 Málaga    arima_at2    4.99     0.661
3 Málaga    Snaive    1613.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb547"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb547-2"><a href="#cb547-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    27.2    0.0181
2 Málaga    arima_at2    24.1    0.0447
3 Málaga    Snaive     2365.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb549"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb549-1"><a href="#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb549-2"><a href="#cb549-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    45.8   0.00136
2 Málaga    arima_at2    35.4   0.0258 
3 Málaga    Snaive     2545.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb551"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb551-1"><a href="#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb551-2"><a href="#cb551-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    99.1  0.000463
2 Málaga    arima_at2    87.6  0.00568 
3 Málaga    Snaive     3404.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb553"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb553-1"><a href="#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb553-2"><a href="#cb553-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb553-3"><a href="#cb553-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb553-4"><a href="#cb553-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb553-5"><a href="#cb553-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb553-6"><a href="#cb553-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb553-7"><a href="#cb553-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb553-8"><a href="#cb553-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb553-9"><a href="#cb553-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb553-10"><a href="#cb553-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb553-11"><a href="#cb553-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb553-12"><a href="#cb553-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb553-13"><a href="#cb553-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb553-14"><a href="#cb553-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb554"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb554-2"><a href="#cb554-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb554-3"><a href="#cb554-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb554-4"><a href="#cb554-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb554-5"><a href="#cb554-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb554-6"><a href="#cb554-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb554-7"><a href="#cb554-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb554-8"><a href="#cb554-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb554-9"><a href="#cb554-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb554-10"><a href="#cb554-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-32" class="level3">
<h3 class="anchored" data-anchor-id="days-32">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb555"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb555-1"><a href="#cb555-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb555-2"><a href="#cb555-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb555-3"><a href="#cb555-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb555-4"><a href="#cb555-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb555-5"><a href="#cb555-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb555-6"><a href="#cb555-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb555-7"><a href="#cb555-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-242-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb556"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb556-2"><a href="#cb556-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb556-3"><a href="#cb556-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb556-4"><a href="#cb556-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb556-5"><a href="#cb556-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb556-6"><a href="#cb556-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb556-7"><a href="#cb556-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-243-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb557"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb557-2"><a href="#cb557-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME  RMSE   MAE    MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test    24.7   169.  128.  -5.55  22.5 0.971 0.683 0.0978
2 arima_at2 Málaga    Test     2.08  162.  117.  -9.09  21.7 0.888 0.653 0.175 
3 Snaive    Málaga    Test  -170.    240.  192. -33.7   35.9 1.45  0.969 0.246 </code></pre>
</div>
</div>
</section>
<section id="days-33" class="level3">
<h3 class="anchored" data-anchor-id="days-33">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb559"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb559-5"><a href="#cb559-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb559-6"><a href="#cb559-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb559-7"><a href="#cb559-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-245-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb560"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb560-3"><a href="#cb560-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb560-4"><a href="#cb560-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb560-5"><a href="#cb560-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb560-6"><a href="#cb560-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb560-7"><a href="#cb560-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-246-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb561"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb561-2"><a href="#cb561-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE     MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test   112.   245.  194.   5.34   27.3  1.47 0.988 0.293 
2 arima_at2 Málaga    Test    79.4  220.  176.   0.521  26.3  1.33 0.891 0.268 
3 Snaive    Málaga    Test  -142.   223.  170. -28.9    31.9  1.29 0.901 0.0235</code></pre>
</div>
</div>
</section>
<section id="days-34" class="level3">
<h3 class="anchored" data-anchor-id="days-34">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb563"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb563-3"><a href="#cb563-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb563-4"><a href="#cb563-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb563-5"><a href="#cb563-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb563-6"><a href="#cb563-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb563-7"><a href="#cb563-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-248-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb564"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb564-2"><a href="#cb564-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb564-3"><a href="#cb564-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb564-4"><a href="#cb564-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb564-5"><a href="#cb564-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb564-6"><a href="#cb564-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb564-7"><a href="#cb564-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-249-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb565"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb565-2"><a href="#cb565-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test    92.3  227.  170.   3.69  24.7  1.29 0.917 0.401
2 arima_at2 Málaga    Test    59.7  201.  153.  -1.09  23.6  1.16 0.813 0.364
3 Snaive    Málaga    Test  -209.   280.  228. -41.6   43.5  1.72 1.13  0.172</code></pre>
</div>
</div>
</section>
<section id="days-35" class="level3">
<h3 class="anchored" data-anchor-id="days-35">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb567"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb567-4"><a href="#cb567-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb567-5"><a href="#cb567-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb567-6"><a href="#cb567-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb567-7"><a href="#cb567-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-251-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb568"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb568-3"><a href="#cb568-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb568-4"><a href="#cb568-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb568-5"><a href="#cb568-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb568-6"><a href="#cb568-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb568-7"><a href="#cb568-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-252-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb569"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb569-2"><a href="#cb569-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   -35.6  246.  182.  -Inf   Inf  1.38 0.993 0.597
2 arima_at2 Málaga    Test   -30.4  219.  161.  -Inf   Inf  1.22 0.885 0.534
3 Snaive    Málaga    Test  -438.   527.  445.  -Inf   Inf  3.37 2.13  0.514</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla-1" class="level2">
<h2 class="anchored" data-anchor-id="sevilla-1">Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb571"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb571-4"><a href="#cb571-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb571-5"><a href="#cb571-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb571-6"><a href="#cb571-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb571-7"><a href="#cb571-7" aria-hidden="true" tabindex="-1"></a>data_Sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2  23.1                  -14       -13
 2 Sevilla   2020-06-16         1  24.0                  -10        -4
 3 Sevilla   2020-06-17         0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1  29.3                  -17       -19
 9 Sevilla   2020-06-23         0  30.2                  -12       -13
10 Sevilla   2020-06-24         1  29.4                  -12       -12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb573"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_train <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb573-2"><a href="#cb573-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb573-3"><a href="#cb573-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb575"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_test <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb575-2"><a href="#cb575-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb575-3"><a href="#cb575-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb577"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb577-2"><a href="#cb577-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb577-3"><a href="#cb577-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb577-4"><a href="#cb577-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb577-5"><a href="#cb577-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb579"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb579-2"><a href="#cb579-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb579-3"><a href="#cb579-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb579-4"><a href="#cb579-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb579-5"><a href="#cb579-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb581"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb581-1"><a href="#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb581-2"><a href="#cb581-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb581-3"><a href="#cb581-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb581-4"><a href="#cb581-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb583"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb585"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb585-1"><a href="#cb585-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb585-2"><a href="#cb585-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb585-3"><a href="#cb585-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb585-4"><a href="#cb585-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb587"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb587-2"><a href="#cb587-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb587-3"><a href="#cb587-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb589"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb591"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb591-1"><a href="#cb591-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb591-2"><a href="#cb591-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb591-3"><a href="#cb591-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb591-4"><a href="#cb591-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb593"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb593-1"><a href="#cb593-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb593-2"><a href="#cb593-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb593-3"><a href="#cb593-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb593-4"><a href="#cb593-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb595"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb595-1"><a href="#cb595-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb595-2"><a href="#cb595-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb595-3"><a href="#cb595-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb597"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb599"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb599-5"><a href="#cb599-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb599-6"><a href="#cb599-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb599-7"><a href="#cb599-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb599-8"><a href="#cb599-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb599-9"><a href="#cb599-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb599-10"><a href="#cb599-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work)</span>
<span id="cb599-11"><a href="#cb599-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb599-12"><a href="#cb599-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb599-13"><a href="#cb599-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb599-14"><a href="#cb599-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb599-15"><a href="#cb599-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb599-16"><a href="#cb599-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb599-17"><a href="#cb599-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb599-18"><a href="#cb599-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb599-19"><a href="#cb599-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work),</span>
<span id="cb599-20"><a href="#cb599-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb599-21"><a href="#cb599-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos))</span>
<span id="cb599-22"><a href="#cb599-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb599-23"><a href="#cb599-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-24"><a href="#cb599-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb599-25"><a href="#cb599-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Sevilla   &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb601"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
1 Sevilla   arima_at1  0.940   -821. 1670. 1670. 1731. &lt;cpl [17]&gt; &lt;cpl [1]&gt; 
2 Sevilla   arima_at2  0.910   -813. 1654. 1654. 1715. &lt;cpl [7]&gt;  &lt;cpl [11]&gt;
3 Sevilla   Snaive     2.93      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb603"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb603-1"><a href="#cb603-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb603-2"><a href="#cb603-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb603-3"><a href="#cb603-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb603-4"><a href="#cb603-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb603-5"><a href="#cb603-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb603-6"><a href="#cb603-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb603-7"><a href="#cb603-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(0,1,4)(1,0,1)[7] errors&gt;  0.910   -813. 1654. 1654. 1715.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.940   -821. 1670. 1670. 1731.
3 Snaive                               &lt;SNAIVE&gt;  2.93      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb605"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb605-2"><a href="#cb605-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb605-3"><a href="#cb605-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb605-4"><a href="#cb605-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-261-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb606"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb606-1"><a href="#cb606-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb606-2"><a href="#cb606-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb606-3"><a href="#cb606-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-262-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb607"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-263-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb608"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb608-1"><a href="#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb608-2"><a href="#cb608-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    2.80     0.903
2 Sevilla   arima_at2    1.90     0.965
3 Sevilla   Snaive    1179.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb610"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb610-1"><a href="#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb610-2"><a href="#cb610-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    18.2     0.198
2 Sevilla   arima_at2    15.5     0.343
3 Sevilla   Snaive     1697.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb612"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb612-1"><a href="#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb612-2"><a href="#cb612-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    29.8    0.0960
2 Sevilla   arima_at2    24.7    0.261 
3 Sevilla   Snaive     1803.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb614"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb614-1"><a href="#cb614-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb614-2"><a href="#cb614-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    74.5    0.0599
2 Sevilla   arima_at2    71.2    0.0979
3 Sevilla   Snaive     2248.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb616"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb616-2"><a href="#cb616-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb616-3"><a href="#cb616-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb616-4"><a href="#cb616-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb616-5"><a href="#cb616-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb616-6"><a href="#cb616-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb616-7"><a href="#cb616-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb616-8"><a href="#cb616-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb616-9"><a href="#cb616-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb616-10"><a href="#cb616-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb616-11"><a href="#cb616-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb616-12"><a href="#cb616-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb616-13"><a href="#cb616-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb616-14"><a href="#cb616-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb617"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb617-1"><a href="#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb617-2"><a href="#cb617-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb617-3"><a href="#cb617-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb617-4"><a href="#cb617-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb617-5"><a href="#cb617-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb617-6"><a href="#cb617-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb617-7"><a href="#cb617-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb617-8"><a href="#cb617-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb617-9"><a href="#cb617-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb617-10"><a href="#cb617-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-36" class="level3">
<h3 class="anchored" data-anchor-id="days-36">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb618"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb618-1"><a href="#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb618-2"><a href="#cb618-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb618-3"><a href="#cb618-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb618-4"><a href="#cb618-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb618-5"><a href="#cb618-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb618-6"><a href="#cb618-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb618-7"><a href="#cb618-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-270-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb619"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb619-1"><a href="#cb619-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb619-2"><a href="#cb619-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb619-3"><a href="#cb619-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb619-4"><a href="#cb619-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb619-5"><a href="#cb619-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb619-6"><a href="#cb619-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb619-7"><a href="#cb619-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-271-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb620"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb620-1"><a href="#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb620-2"><a href="#cb620-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test    43.3  75.6  58.3   5.86  9.89 0.407 0.277 0.110
2 arima_at2 Sevilla   Test    37.2  72.4  52.1   6.09  9.43 0.364 0.265 0.196
3 Snaive    Sevilla   Test  -293.  356.  300.  -46.0  47.8  2.10  1.30  0.521</code></pre>
</div>
</div>
</section>
<section id="days-37" class="level3">
<h3 class="anchored" data-anchor-id="days-37">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb622"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb622-1"><a href="#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb622-2"><a href="#cb622-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb622-3"><a href="#cb622-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb622-4"><a href="#cb622-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb622-5"><a href="#cb622-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb622-6"><a href="#cb622-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb622-7"><a href="#cb622-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-273-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb623"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb623-2"><a href="#cb623-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb623-3"><a href="#cb623-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb623-4"><a href="#cb623-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb623-5"><a href="#cb623-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb623-6"><a href="#cb623-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb623-7"><a href="#cb623-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-274-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb624"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb624-1"><a href="#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb624-2"><a href="#cb624-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   139.  224.  157.  15.1  21.6  1.10 0.819 0.417
2 arima_at2 Sevilla   Test   132.  211.  147.  15.7  20.2  1.02 0.773 0.379
3 Snaive    Sevilla   Test  -279.  321.  282. -47.5  48.4  1.97 1.17  0.409</code></pre>
</div>
</div>
</section>
<section id="days-38" class="level3">
<h3 class="anchored" data-anchor-id="days-38">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb626"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb626-2"><a href="#cb626-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb626-3"><a href="#cb626-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb626-4"><a href="#cb626-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb626-5"><a href="#cb626-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb626-6"><a href="#cb626-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb626-7"><a href="#cb626-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-276-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb627"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb627-1"><a href="#cb627-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb627-2"><a href="#cb627-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb627-3"><a href="#cb627-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb627-4"><a href="#cb627-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb627-5"><a href="#cb627-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb627-6"><a href="#cb627-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb627-7"><a href="#cb627-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-277-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb628"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb628-1"><a href="#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb628-2"><a href="#cb628-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   123.  211.  155.  10.3  26.5 1.09  0.772 0.476
2 arima_at2 Sevilla   Test   121.  196.  140.  13.4  22.3 0.980 0.716 0.421
3 Snaive    Sevilla   Test  -356.  404.  358. -71.9  72.5 2.50  1.48  0.498</code></pre>
</div>
</div>
</section>
<section id="days-39" class="level3">
<h3 class="anchored" data-anchor-id="days-39">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb630"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb630-1"><a href="#cb630-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb630-2"><a href="#cb630-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb630-3"><a href="#cb630-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb630-4"><a href="#cb630-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb630-5"><a href="#cb630-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb630-6"><a href="#cb630-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb630-7"><a href="#cb630-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-279-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb631"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb631-2"><a href="#cb631-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb631-3"><a href="#cb631-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb631-4"><a href="#cb631-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb631-5"><a href="#cb631-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb631-6"><a href="#cb631-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb631-7"><a href="#cb631-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-280-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb632"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb632-1"><a href="#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb632-2"><a href="#cb632-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   -43.3  207.  154.  -Inf   Inf 1.08  0.756 0.707
2 arima_at2 Sevilla   Test    15.5  155.  113.  -Inf   Inf 0.786 0.566 0.597
3 Snaive    Sevilla   Test  -681.   784.  682.  -Inf   Inf 4.77  2.87  0.637</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./multivariate.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Multivariate (INE mobility + temp) prediction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lstm.html" class="pagination-link">
        <span class="nav-page-text">Task 5: LSTM</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>