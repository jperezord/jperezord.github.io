<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.345">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PEC3 - COVID-19 Outbreak prediction - Multivariate (Google mobility + temp) prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<link href="./lstm.html" rel="next">
<link href="./multivariate.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Multivariate (Google mobility + temp) prediction</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PEC3 - COVID-19 Outbreak prediction</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jperezord/jperezord.github.io.git" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./data.html" class="sidebar-item-text sidebar-link">Task 1: Data acquisition and exploration</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cne_data.html" class="sidebar-item-text sidebar-link">CNE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./google_data.html" class="sidebar-item-text sidebar-link">GOOGLE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ine_data.html" class="sidebar-item-text sidebar-link">INE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aemet_data.html" class="sidebar-item-text sidebar-link">AEMET data</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./combination.html" class="sidebar-item-text sidebar-link">Task 2: Datasets combination</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visual.html" class="sidebar-item-text sidebar-link">Task 3: Visual analysis</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./arima.html" class="sidebar-item-text sidebar-link">Task 4: ARIMA</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acf.html" class="sidebar-item-text sidebar-link">ACF and PACF plots</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stl.html" class="sidebar-item-text sidebar-link">STL decomposition / Transformations</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate.html" class="sidebar-item-text sidebar-link">Univariate prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate.html" class="sidebar-item-text sidebar-link">Multivariate (INE mobility + temp) prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate_google.html" class="sidebar-item-text sidebar-link active">Multivariate (Google mobility + temp) prediction</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./lstm.html" class="sidebar-item-text sidebar-link">Task 5: LSTM</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lstm_uni.html" class="sidebar-item-text sidebar-link">LSTM univariate prediction</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-sixth-epidemiological-period" id="toc-before-sixth-epidemiological-period" class="nav-link active" data-scroll-target="#before-sixth-epidemiological-period">Before sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias" id="toc-asturias" class="nav-link" data-scroll-target="#asturias">Asturias</a>
  <ul class="collapse">
  <li><a href="#days" id="toc-days" class="nav-link" data-scroll-target="#days">7 days</a></li>
  <li><a href="#days-1" id="toc-days-1" class="nav-link" data-scroll-target="#days-1">14 days</a></li>
  <li><a href="#days-2" id="toc-days-2" class="nav-link" data-scroll-target="#days-2">21 days</a></li>
  </ul></li>
  <li><a href="#barcelona" id="toc-barcelona" class="nav-link" data-scroll-target="#barcelona">Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-3" id="toc-days-3" class="nav-link" data-scroll-target="#days-3">7 days</a></li>
  <li><a href="#days-4" id="toc-days-4" class="nav-link" data-scroll-target="#days-4">14 days</a></li>
  <li><a href="#days-5" id="toc-days-5" class="nav-link" data-scroll-target="#days-5">21 days</a></li>
  </ul></li>
  <li><a href="#madrid" id="toc-madrid" class="nav-link" data-scroll-target="#madrid">Madrid</a>
  <ul class="collapse">
  <li><a href="#days-6" id="toc-days-6" class="nav-link" data-scroll-target="#days-6">7 days</a></li>
  <li><a href="#days-7" id="toc-days-7" class="nav-link" data-scroll-target="#days-7">14 days</a></li>
  <li><a href="#days-8" id="toc-days-8" class="nav-link" data-scroll-target="#days-8">21 days</a></li>
  </ul></li>
  <li><a href="#malaga" id="toc-malaga" class="nav-link" data-scroll-target="#malaga">Malaga</a>
  <ul class="collapse">
  <li><a href="#days-9" id="toc-days-9" class="nav-link" data-scroll-target="#days-9">7 days</a></li>
  <li><a href="#days-10" id="toc-days-10" class="nav-link" data-scroll-target="#days-10">14 days</a></li>
  <li><a href="#days-11" id="toc-days-11" class="nav-link" data-scroll-target="#days-11">21 days</a></li>
  </ul></li>
  <li><a href="#sevilla" id="toc-sevilla" class="nav-link" data-scroll-target="#sevilla">Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-12" id="toc-days-12" class="nav-link" data-scroll-target="#days-12">7 days</a></li>
  <li><a href="#days-13" id="toc-days-13" class="nav-link" data-scroll-target="#days-13">14 days</a></li>
  <li><a href="#days-14" id="toc-days-14" class="nav-link" data-scroll-target="#days-14">21 days</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#middel-of-sixth-epidemiological-period" id="toc-middel-of-sixth-epidemiological-period" class="nav-link" data-scroll-target="#middel-of-sixth-epidemiological-period">Middel of sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias-1" id="toc-asturias-1" class="nav-link" data-scroll-target="#asturias-1">Asturias</a>
  <ul class="collapse">
  <li><a href="#days-15" id="toc-days-15" class="nav-link" data-scroll-target="#days-15">7 days</a></li>
  <li><a href="#days-16" id="toc-days-16" class="nav-link" data-scroll-target="#days-16">14 days</a></li>
  <li><a href="#days-17" id="toc-days-17" class="nav-link" data-scroll-target="#days-17">21 days</a></li>
  </ul></li>
  <li><a href="#barcelona-1" id="toc-barcelona-1" class="nav-link" data-scroll-target="#barcelona-1">Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-18" id="toc-days-18" class="nav-link" data-scroll-target="#days-18">7 days</a></li>
  <li><a href="#days-19" id="toc-days-19" class="nav-link" data-scroll-target="#days-19">14 days</a></li>
  <li><a href="#days-20" id="toc-days-20" class="nav-link" data-scroll-target="#days-20">21 days</a></li>
  </ul></li>
  <li><a href="#madrid-1" id="toc-madrid-1" class="nav-link" data-scroll-target="#madrid-1">Madrid</a>
  <ul class="collapse">
  <li><a href="#days-21" id="toc-days-21" class="nav-link" data-scroll-target="#days-21">7 days</a></li>
  <li><a href="#days-22" id="toc-days-22" class="nav-link" data-scroll-target="#days-22">14 days</a></li>
  <li><a href="#days-23" id="toc-days-23" class="nav-link" data-scroll-target="#days-23">21 days</a></li>
  </ul></li>
  <li><a href="#malaga-1" id="toc-malaga-1" class="nav-link" data-scroll-target="#malaga-1">Malaga</a>
  <ul class="collapse">
  <li><a href="#days-24" id="toc-days-24" class="nav-link" data-scroll-target="#days-24">7 days</a></li>
  <li><a href="#days-25" id="toc-days-25" class="nav-link" data-scroll-target="#days-25">14 days</a></li>
  <li><a href="#days-26" id="toc-days-26" class="nav-link" data-scroll-target="#days-26">21 days</a></li>
  </ul></li>
  <li><a href="#sevilla-1" id="toc-sevilla-1" class="nav-link" data-scroll-target="#sevilla-1">Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-27" id="toc-days-27" class="nav-link" data-scroll-target="#days-27">7 days</a></li>
  <li><a href="#days-28" id="toc-days-28" class="nav-link" data-scroll-target="#days-28">14 days</a></li>
  <li><a href="#days-29" id="toc-days-29" class="nav-link" data-scroll-target="#days-29">21 days</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Multivariate (Google mobility + temp) prediction</h1>
</div>





<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Load packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>      here,      <span class="co"># file locator</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      tidyverse, <span class="co"># data management and ggplot2 graphics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      skimr,     <span class="co"># get overview of data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      janitor,   <span class="co"># produce and adorn tabulations and cross-tabulations</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      tsibble,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      fable,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      feasts,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      fabletools,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      lubridate</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>covid_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"clean"</span>, <span class="st">"final_covid_data.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The temporal limits of our prediction will be:</p>
<ul>
<li>Data as of June 14th 2020 which is considered the beginning of the second epidemiological period in Spain</li>
<li>In the first case scenario, data previous the start of the sixth wave of covid-19 (14 oct 2021).</li>
<li>In the second case scenario, all the available data (limited by mobility information 29 dec 2021)</li>
</ul>
<section id="before-sixth-epidemiological-period" class="level1">
<h1>Before sixth epidemiological period</h1>
<section id="asturias" class="level2">
<h2 class="anchored" data-anchor-id="asturias">Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0  16                   -6          39
 2 Asturias  2020-06-16         1  15.6                 -6           7
 3 Asturias  2020-06-17         0  15.6                 -7          20
 4 Asturias  2020-06-18         0  15.1                 -4          68
 5 Asturias  2020-06-19         0  14.8                 -4          52
 6 Asturias  2020-06-20         0  16.8                -10          71
 7 Asturias  2020-06-21         0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0  18.2                 -1          99
 9 Asturias  2020-06-23         0  20                   -2         129
10 Asturias  2020-06-24         0  18.2                 -9          63
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work),</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos))</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(best$var.coef)): Se han producido NaNs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Asturias  &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.955   -675. 1380. 1381. 1443. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
2 Asturias  arima_at2  0.922   -668. 1363. 1364. 1417. &lt;cpl [9]&gt;  &lt;cpl [8]&gt;
3 Asturias  Snaive     2.32      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,0,1)(1,0,1)[7] errors&gt;  0.922   -668. 1363. 1364. 1417.
2 arima_… &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;  0.955   -675. 1380. 1381. 1443.
3 Snaive                               &lt;SNAIVE&gt;  2.32      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    17.1    0.0165
2 Asturias  arima_at2    12.1    0.0972
3 Asturias  Snaive      629.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    35.5   0.00125
2 Asturias  arima_at2    28.9   0.0108 
3 Asturias  Snaive      892.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    52.1  0.000185
2 Asturias  arima_at2    38.2  0.0121  
3 Asturias  Snaive      927.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days" class="level3">
<h3 class="anchored" data-anchor-id="days">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   3.68  9.00  5.65   6.27  23.7 0.114 0.110 0.0968 
2 arima_at2 Asturias  Test   5.62  9.84  6.95  15.8   29.0 0.140 0.120 0.318  
3 Snaive    Asturias  Test   2.41 14.0   9.98 -10.1   49.0 0.201 0.171 0.00766</code></pre>
</div>
</div>
</section>
<section id="days-1" class="level3">
<h3 class="anchored" data-anchor-id="days-1">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   7.39  11.7  8.37 18.2   26.9 0.168 0.142  0.0327
2 arima_at2 Asturias  Test  11.4   15.0 12.1  33.0   39.6 0.243 0.183  0.304 
3 Snaive    Asturias  Test   6.69  16.0 11.4   8.17  41.5 0.229 0.195 -0.156 </code></pre>
</div>
</div>
</section>
<section id="days-2" class="level3">
<h3 class="anchored" data-anchor-id="days-2">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE     ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 arima_at1 Asturias  Test   4.99  10.5  7.85  9.97  26.3 0.158 0.128 -0.00881
2 arima_at2 Asturias  Test  11.7   14.8 12.1  34.3   38.7 0.243 0.180  0.155  
3 Snaive    Asturias  Test   5.77  15.6 11.5   6.52  40.8 0.232 0.190 -0.223  </code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona" class="level2">
<h2 class="anchored" data-anchor-id="barcelona">Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>data_Barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62  21.2                   -9        17
 2 Barcelona 2020-06-16        66  20.8                  -10       -16
 3 Barcelona 2020-06-17        70  20.3                   -4        14
 4 Barcelona 2020-06-18        68  18.8                   -8        -6
 5 Barcelona 2020-06-19        65  20.4                   -5        10
 6 Barcelona 2020-06-20        53  21.8                  -12        15
 7 Barcelona 2020-06-21        38  22.8                  -18        18
 8 Barcelona 2020-06-22        69  23.8                    5        24
 9 Barcelona 2020-06-23        95  23.4                   19        28
10 Barcelona 2020-06-24        44  23.6                  -71        28
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_train <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_test <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work),</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos))</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Barcelona &lt;LM w/ ARIMA(1,0,2)(1,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
1 Barcelona arima_at1  0.501   -525. 1076. 1077. 1131. &lt;cpl [8]&gt; &lt;cpl [2]&gt;
2 Barcelona arima_at2  0.492   -520. 1068. 1069. 1127. &lt;cpl [9]&gt; &lt;cpl [2]&gt;
3 Barcelona Snaive     3.23      NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,0,2)(1,0,0)[7] errors&gt;  0.492   -520. 1068. 1069. 1127.
2 arima_… &lt;LM w/ ARIMA(1,0,2)(1,0,0)[7] errors&gt;  0.501   -525. 1076. 1077. 1131.
3 Snaive                               &lt;SNAIVE&gt;  3.23      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    49.8 0.0000000156 
2 Barcelona arima_at2    52.9 0.00000000385
3 Barcelona Snaive     1648.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    68.6 0.00000000350
2 Barcelona arima_at2    69.2 0.00000000268
3 Barcelona Snaive     2222.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat    lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 Barcelona arima_at1    77.6 0.0000000204
2 Barcelona arima_at2    78.4 0.0000000147
3 Barcelona Snaive     2272.  0           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-3" class="level3">
<h3 class="anchored" data-anchor-id="days-3">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  -29.5  75.9  67.0 -20.3  40.8 0.178 0.114 0.551
2 arima_at2 Barcelona Test  -45.0  88.5  79.0 -28.7  47.2 0.210 0.134 0.598
3 Snaive    Barcelona Test  -25.0  80.0  67.1 -17.8  40.2 0.178 0.121 0.187</code></pre>
</div>
</div>
</section>
<section id="days-4" class="level3">
<h3 class="anchored" data-anchor-id="days-4">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test  -17.3  72.1  63.5 -12.7  34.8 0.169 0.109 0.462 
2 arima_at2 Barcelona Test  -47.5  91.4  80.9 -27.0  43.8 0.215 0.138 0.505 
3 Snaive    Barcelona Test  -21.3  88.0  75.0 -15.3  40.3 0.199 0.133 0.0630</code></pre>
</div>
</div>
</section>
<section id="days-5" class="level3">
<h3 class="anchored" data-anchor-id="days-5">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test    2.67  82.2  67.8  -7.70  33.2 0.180 0.124  0.389
2 arima_at2 Barcelona Test  -46.5   91.9  83.2 -28.8   43.5 0.221 0.139  0.321
3 Snaive    Barcelona Test  -10.1  119.   90.1 -14.8   41.9 0.239 0.179 -0.242</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid" class="level2">
<h2 class="anchored" data-anchor-id="madrid">Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>data_Madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>data_Madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153  20.7                   -8        34
 2 Madrid    2020-06-16        91  21                     -8        21
 3 Madrid    2020-06-17        93  20.2                   -5        34
 4 Madrid    2020-06-18        85  21.9                   -7        30
 5 Madrid    2020-06-19        78  22.6                   -9        22
 6 Madrid    2020-06-20        67  23.4                  -12        25
 7 Madrid    2020-06-21        42  25                    -13        14
 8 Madrid    2020-06-22        60  27.3                   -8        29
 9 Madrid    2020-06-23        68  28.4                   -9        23
10 Madrid    2020-06-24        49  28                     -7        22
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_train <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_test <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work)</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work),</span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos))</span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Madrid    &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Madrid    arima_at1  0.494   -519. 1066. 1067. 1125. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
2 Madrid    arima_at2  0.494   -519. 1066. 1067. 1125. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
3 Madrid    Snaive     3.02      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;  0.494   -519. 1066. 1067. 1125.
2 arima_… &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;  0.494   -519. 1066. 1067. 1125.
3 Snaive                               &lt;SNAIVE&gt;  3.02      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    8.14     0.320
2 Madrid    arima_at2    8.14     0.320
3 Madrid    Snaive    1553.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    19.6     0.144
2 Madrid    arima_at2    19.6     0.144
3 Madrid    Snaive     2371.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    29.2     0.109
2 Madrid    arima_at2    29.2     0.109
3 Madrid    Snaive     2571.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-6" class="level3">
<h3 class="anchored" data-anchor-id="days-6">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Madrid    Test   66.6  114.  98.7 10.6   38.9 0.233 0.170 -0.142
2 arima_at2 Madrid    Test   66.6  114.  98.7 10.6   38.9 0.233 0.170 -0.142
3 Snaive    Madrid    Test   25.6  123. 102.  -9.85  47.5 0.240 0.183 -0.107</code></pre>
</div>
</div>
</section>
<section id="days-7" class="level3">
<h3 class="anchored" data-anchor-id="days-7">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Madrid    Test   71.3  118.  102.  12.6  38.2 0.240 0.176 -0.0603
2 arima_at2 Madrid    Test   71.3  118.  102.  12.6  38.2 0.240 0.176 -0.0603
3 Snaive    Madrid    Test   16.7  124.  102. -12.8  46.7 0.240 0.185 -0.0438</code></pre>
</div>
</div>
</section>
<section id="days-8" class="level3">
<h3 class="anchored" data-anchor-id="days-8">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test   89.9  148.  121.  15.5  40.0 0.285 0.220 0.225
2 arima_at2 Madrid    Test   89.9  148.  121.  15.5  40.0 0.285 0.220 0.225
3 Snaive    Madrid    Test   22.0  137.  112. -13.4  48.6 0.264 0.204 0.131</code></pre>
</div>
</div>
</section>
</section>
<section id="malaga" class="level2">
<h2 class="anchored" data-anchor-id="malaga">Malaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>data_Malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>data_Malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1  27.2                  -16        -9
 2 Málaga    2020-06-16         1  27.8                  -13        -4
 3 Málaga    2020-06-17         2  26.9                  -13         1
 4 Málaga    2020-06-18         2  21.6                  -12         3
 5 Málaga    2020-06-19         1  24.7                  -12         2
 6 Málaga    2020-06-20         4  22.6                  -14         8
 7 Málaga    2020-06-21         4  22.7                  -16        -3
 8 Málaga    2020-06-22         6  25                    -13         1
 9 Málaga    2020-06-23         8  25.6                  -10        18
10 Málaga    2020-06-24        65  24.5                  -13        12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_train <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_test <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work)</span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work),</span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos))</span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-24"><a href="#cb212-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb212-25"><a href="#cb212-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Málaga    &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Málaga    arima_at1  0.469   -500. 1029. 1030. 1087. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
2 Málaga    arima_at2  0.464   -498. 1024. 1025. 1083. &lt;cpl [16]&gt; &lt;cpl [2]&gt;
3 Málaga    Snaive     2.08      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,1,2)(2,0,0)[7] errors&gt;  0.464   -498. 1024. 1025. 1083.
2 arima_… &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;  0.469   -500. 1029. 1030. 1087.
3 Snaive                               &lt;SNAIVE&gt;  2.08      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    6.82     0.448
2 Málaga    arima_at2    4.67     0.700
3 Málaga    Snaive    1353.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    17.7     0.219
2 Málaga    arima_at2    10.6     0.715
3 Málaga    Snaive     1943.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    24.8     0.257
2 Málaga    arima_at2    17.7     0.668
3 Málaga    Snaive     2088.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-9" class="level3">
<h3 class="anchored" data-anchor-id="days-9">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test   9.98  18.0  16.2   7.92  34.9 0.164 0.107 -0.0177
2 arima_at2 Málaga    Test  10.2   18.3  16.3   8.34  35.0 0.166 0.108  0.0652
3 Snaive    Málaga    Test  -3.97  22.9  19.8 -27.0   52.2 0.201 0.135  0.0122</code></pre>
</div>
</div>
</section>
<section id="days-10" class="level3">
<h3 class="anchored" data-anchor-id="days-10">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test  13.0   21.1  17.6  13.8  31.5 0.179 0.124  0.199 
2 arima_at2 Málaga    Test  13.7   21.7  17.9  15.2  31.7 0.182 0.128  0.241 
3 Snaive    Málaga    Test  -3.81  22.7  18.7 -22.3  43.6 0.190 0.134 -0.0975</code></pre>
</div>
</div>
</section>
<section id="days-11" class="level3">
<h3 class="anchored" data-anchor-id="days-11">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test  18.4    26.2  22.0  20.8  33.9 0.224 0.154 0.260 
2 arima_at2 Málaga    Test  18.5    26.0  22.0  21.1  33.8 0.223 0.154 0.246 
3 Snaive    Málaga    Test  -0.886  22.0  18.6 -14.7  37.8 0.189 0.130 0.0886</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla" class="level2">
<h2 class="anchored" data-anchor-id="sevilla">Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>data_Sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2  23.1                  -14       -13
 2 Sevilla   2020-06-16         1  24.0                  -10        -4
 3 Sevilla   2020-06-17         0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1  29.3                  -17       -19
 9 Sevilla   2020-06-23         0  30.2                  -12       -13
10 Sevilla   2020-06-24         1  29.4                  -12       -12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_train <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_test <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work)</span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb272-15"><a href="#cb272-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb272-16"><a href="#cb272-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb272-17"><a href="#cb272-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb272-18"><a href="#cb272-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb272-19"><a href="#cb272-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work),</span>
<span id="cb272-20"><a href="#cb272-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb272-21"><a href="#cb272-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos))</span>
<span id="cb272-22"><a href="#cb272-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb272-23"><a href="#cb272-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-24"><a href="#cb272-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb272-25"><a href="#cb272-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Sevilla   &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Sevilla   arima_at1  0.855   -647. 1321. 1322. 1380. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Sevilla   arima_at2  0.837   -643. 1311. 1312. 1366. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
3 Sevilla   Snaive     2.47      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(3,1,0)(1,0,1)[7] errors&gt;  0.837   -643. 1311. 1312. 1366.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.855   -647. 1321. 1322. 1380.
3 Snaive                               &lt;SNAIVE&gt;  2.47      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    6.00     0.539
2 Sevilla   arima_at2   11.6      0.116
3 Sevilla   Snaive     995.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    15.7     0.333
2 Sevilla   arima_at2    21.0     0.101
3 Sevilla   Snaive     1444.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    29.5    0.103 
2 Sevilla   arima_at2    31.9    0.0603
3 Sevilla   Snaive     1580.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb291-9"><a href="#cb291-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-12" class="level3">
<h3 class="anchored" data-anchor-id="days-12">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Sevilla   Test   3.54  9.18  7.23   8.02  21.4 0.0714 0.0582 -0.475 
2 arima_at2 Sevilla   Test   7.41 10.6   8.11  20.4   23.0 0.0801 0.0675 -0.416 
3 Snaive    Sevilla   Test  -5.28 15.6  13.3  -20.3   39.3 0.131  0.0990  0.0323</code></pre>
</div>
</div>
</section>
<section id="days-13" class="level3">
<h3 class="anchored" data-anchor-id="days-13">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-116-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-117-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model   provincia .type      ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE   ACF1
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 arima_a… Sevilla   Test    0.949  8.67  7.40  -6.17  28.5 0.0731 0.0549 -0.387
2 arima_a… Sevilla   Test    6.21  10.4   7.82  14.3   24.1 0.0772 0.0659 -0.416
3 Snaive   Sevilla   Test  -11.6   18.4  15.6  -54.4   63.9 0.154  0.117   0.268</code></pre>
</div>
</div>
</section>
<section id="days-14" class="level3">
<h3 class="anchored" data-anchor-id="days-14">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-119-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-120-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model  provincia .type     ME  RMSE   MAE     MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_… Sevilla   Test    3.38  10.7  8.64   0.302  28.6 0.0853 0.0681 -0.0110
2 arima_… Sevilla   Test    9.87  14.6 10.9   23.4    30.0 0.108  0.0924  0.143 
3 Snaive  Sevilla   Test  -12.8   21.0 18.2  -57.0    68.6 0.180  0.133   0.328 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="middel-of-sixth-epidemiological-period" class="level1">
<h1>Middel of sixth epidemiological period</h1>
<section id="asturias-1" class="level2">
<h2 class="anchored" data-anchor-id="asturias-1">Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0  16                   -6          39
 2 Asturias  2020-06-16         1  15.6                 -6           7
 3 Asturias  2020-06-17         0  15.6                 -7          20
 4 Asturias  2020-06-18         0  15.1                 -4          68
 5 Asturias  2020-06-19         0  14.8                 -4          52
 6 Asturias  2020-06-20         0  16.8                -10          71
 7 Asturias  2020-06-21         0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0  18.2                 -1          99
 9 Asturias  2020-06-23         0  20                   -2         129
10 Asturias  2020-06-24         0  18.2                 -9          63
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-28" "2021-03-13" "2021-03-13" "2021-07-27" "2021-12-10" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-12-11" "2022-01-07" "2022-02-03" "2022-02-03" "2022-03-02" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb332-10"><a href="#cb332-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work)</span>
<span id="cb332-11"><a href="#cb332-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb332-12"><a href="#cb332-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb332-13"><a href="#cb332-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb332-14"><a href="#cb332-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb332-15"><a href="#cb332-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb332-16"><a href="#cb332-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb332-17"><a href="#cb332-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb332-18"><a href="#cb332-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb332-19"><a href="#cb332-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work),</span>
<span id="cb332-20"><a href="#cb332-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb332-21"><a href="#cb332-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos))</span>
<span id="cb332-22"><a href="#cb332-22" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(best$var.coef)): Se han producido NaNs

Warning in sqrt(diag(best$var.coef)): Se han producido NaNs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Asturias  &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.917   -744. 1517. 1518. 1582. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
2 Asturias  arima_at2  0.888   -736. 1500. 1501. 1560. &lt;cpl [9]&gt;  &lt;cpl [8]&gt;
3 Asturias  Snaive     2.33      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,0,1)(1,0,1)[7] errors&gt;  0.888   -736. 1500. 1501. 1560.
2 arima_… &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;  0.917   -744. 1517. 1518. 1582.
3 Snaive                               &lt;SNAIVE&gt;  2.33      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-129-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-130-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-131-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    17.5    0.0143
2 Asturias  arima_at2    10.4    0.167 
3 Asturias  Snaive      771.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    38.2  0.000490
2 Asturias  arima_at2    28.9  0.0109  
3 Asturias  Snaive     1089.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    60.5 0.0000106
2 Asturias  arima_at2    42.9 0.00328  
3 Asturias  Snaive     1141.  0        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb352-6"><a href="#cb352-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb352-7"><a href="#cb352-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb352-8"><a href="#cb352-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb352-9"><a href="#cb352-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb352-10"><a href="#cb352-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb352-11"><a href="#cb352-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-15" class="level3">
<h3 class="anchored" data-anchor-id="days-15">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-137-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-138-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test  127.   155.  134.  18.1  19.7  2.68  1.89 0.256
2 arima_at2 Asturias  Test   97.0  124.  107.  13.6  15.8  2.14  1.52 0.196
3 Snaive    Asturias  Test  180.   213.  181.  26.9  27.2  3.62  2.62 0.425</code></pre>
</div>
</div>
</section>
<section id="days-16" class="level3">
<h3 class="anchored" data-anchor-id="days-16">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-140-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-141-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   315.  392.  319.  32.4  33.2  6.37  4.81 0.748
2 arima_at2 Asturias  Test   261.  333.  267.  26.4  27.5  5.32  4.08 0.716
3 Snaive    Asturias  Test   370.  437.  371.  40.2  40.3  7.41  5.35 0.665</code></pre>
</div>
</div>
</section>
<section id="days-17" class="level3">
<h3 class="anchored" data-anchor-id="days-17">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-143-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-144-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   688.  912.  690.  45.4  45.9  13.8  11.2 0.856
2 arima_at2 Asturias  Test   605.  820.  609.  39.0  39.7  12.2  10.0 0.847
3 Snaive    Asturias  Test   735.  938.  736.  51.3  51.4  14.7  11.5 0.846</code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona-1" class="level2">
<h2 class="anchored" data-anchor-id="barcelona-1">Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a>data_Barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62  21.2                   -9        17
 2 Barcelona 2020-06-16        66  20.8                  -10       -16
 3 Barcelona 2020-06-17        70  20.3                   -4        14
 4 Barcelona 2020-06-18        68  18.8                   -8        -6
 5 Barcelona 2020-06-19        65  20.4                   -5        10
 6 Barcelona 2020-06-20        53  21.8                  -12        15
 7 Barcelona 2020-06-21        38  22.8                  -18        18
 8 Barcelona 2020-06-22        69  23.8                    5        24
 9 Barcelona 2020-06-23        95  23.4                   19        28
10 Barcelona 2020-06-24        44  23.6                  -71        28
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_train <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-28" "2021-03-13" "2021-03-13" "2021-07-27" "2021-12-10" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_test <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-12-11" "2022-01-07" "2022-02-03" "2022-02-03" "2022-03-02" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb394-8"><a href="#cb394-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb394-9"><a href="#cb394-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb394-10"><a href="#cb394-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work)</span>
<span id="cb394-11"><a href="#cb394-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb394-12"><a href="#cb394-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb394-13"><a href="#cb394-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb394-14"><a href="#cb394-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb394-15"><a href="#cb394-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb394-16"><a href="#cb394-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb394-17"><a href="#cb394-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb394-18"><a href="#cb394-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb394-19"><a href="#cb394-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work),</span>
<span id="cb394-20"><a href="#cb394-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb394-21"><a href="#cb394-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos))</span>
<span id="cb394-22"><a href="#cb394-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb394-23"><a href="#cb394-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-24"><a href="#cb394-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb394-25"><a href="#cb394-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Barcelona &lt;LM w/ ARIMA(1,0,1)(1,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Barcelona arima_at1  0.704   -678. 1380. 1380. 1431. &lt;cpl [8]&gt;  &lt;cpl [1]&gt;
2 Barcelona arima_at2  0.656   -659. 1344. 1344. 1399. &lt;cpl [15]&gt; &lt;cpl [1]&gt;
3 Barcelona Snaive     3.32      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(1,0,1)(2,0,0)[7] errors&gt;  0.656   -659. 1344. 1344. 1399.
2 arima_… &lt;LM w/ ARIMA(1,0,1)(1,0,0)[7] errors&gt;  0.704   -678. 1380. 1380. 1431.
3 Snaive                               &lt;SNAIVE&gt;  3.32      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-153-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-154-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-155-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1    31.4 0.0000526
2 Barcelona arima_at2    19.6 0.00643  
3 Barcelona Snaive     1606.  0        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat  lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1 Barcelona arima_at1    51.6 0.00000326
2 Barcelona arima_at2    48.6 0.0000105 
3 Barcelona Snaive     2217.  0         </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat  lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1 Barcelona arima_at1    62.5 0.00000529
2 Barcelona arima_at2    55.8 0.0000544 
3 Barcelona Snaive     2281.  0         </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb412-5"><a href="#cb412-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb412-6"><a href="#cb412-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb412-7"><a href="#cb412-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb412-8"><a href="#cb412-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb412-9"><a href="#cb412-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb412-10"><a href="#cb412-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb412-11"><a href="#cb412-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb413-6"><a href="#cb413-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb413-7"><a href="#cb413-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb413-8"><a href="#cb413-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb413-9"><a href="#cb413-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-18" class="level3">
<h3 class="anchored" data-anchor-id="days-18">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb414-5"><a href="#cb414-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb414-6"><a href="#cb414-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb414-7"><a href="#cb414-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-161-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb415-6"><a href="#cb415-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb415-7"><a href="#cb415-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-162-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test   138. 1021.  839.  -2.15  26.2  2.27  1.58 -0.799
2 arima_at2 Barcelona Test  -135.  815.  640. -10.7   22.0  1.73  1.26 -0.771
3 Snaive    Barcelona Test  1416. 1821. 1416.  36.4   36.4  3.83  2.82 -0.679</code></pre>
</div>
</div>
</section>
<section id="days-19" class="level3">
<h3 class="anchored" data-anchor-id="days-19">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb418"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb418-4"><a href="#cb418-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb418-5"><a href="#cb418-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb418-6"><a href="#cb418-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb418-7"><a href="#cb418-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-164-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb419-7"><a href="#cb419-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-165-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb420"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  2407. 4079. 2799.  20.5  35.9  7.57  6.31 0.576
2 arima_at2 Barcelona Test  2031. 3750. 2500.  13.0  32.0  6.76  5.80 0.597
3 Snaive    Barcelona Test  3999. 5311. 3999.  54.0  54.0 10.8   8.22 0.613</code></pre>
</div>
</div>
</section>
<section id="days-20" class="level3">
<h3 class="anchored" data-anchor-id="days-20">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb422"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb422-3"><a href="#cb422-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb422-4"><a href="#cb422-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb422-5"><a href="#cb422-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb422-6"><a href="#cb422-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb422-7"><a href="#cb422-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-167-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb423-5"><a href="#cb423-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb423-6"><a href="#cb423-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb423-7"><a href="#cb423-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-168-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb424"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  5312. 7672. 5574.  36.8  47.1  15.1  11.9 0.760
2 arima_at2 Barcelona Test  4773. 7099. 5086.  29.9  42.5  13.7  11.0 0.762
3 Snaive    Barcelona Test  7046. 9149. 7046.  64.1  64.1  19.0  14.2 0.770</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid-1" class="level2">
<h2 class="anchored" data-anchor-id="madrid-1">Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb426"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a>data_Madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb426-4"><a href="#cb426-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb426-5"><a href="#cb426-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb426-6"><a href="#cb426-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb426-7"><a href="#cb426-7" aria-hidden="true" tabindex="-1"></a>data_Madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153  20.7                   -8        34
 2 Madrid    2020-06-16        91  21                     -8        21
 3 Madrid    2020-06-17        93  20.2                   -5        34
 4 Madrid    2020-06-18        85  21.9                   -7        30
 5 Madrid    2020-06-19        78  22.6                   -9        22
 6 Madrid    2020-06-20        67  23.4                  -12        25
 7 Madrid    2020-06-21        42  25                    -13        14
 8 Madrid    2020-06-22        60  27.3                   -8        29
 9 Madrid    2020-06-23        68  28.4                   -9        23
10 Madrid    2020-06-24        49  28                     -7        22
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb428"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_train <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-28" "2021-03-13" "2021-03-13" "2021-07-27" "2021-12-10" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb430"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_test <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-12-11" "2022-01-07" "2022-02-03" "2022-02-03" "2022-03-02" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb432"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb436"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb436-4"><a href="#cb436-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb440"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb440-4"><a href="#cb440-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb442"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb444"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb446"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb448"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb448-3"><a href="#cb448-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb448-4"><a href="#cb448-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb450"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb452"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb454-5"><a href="#cb454-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb454-6"><a href="#cb454-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb454-7"><a href="#cb454-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb454-8"><a href="#cb454-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb454-9"><a href="#cb454-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb454-10"><a href="#cb454-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work)</span>
<span id="cb454-11"><a href="#cb454-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb454-12"><a href="#cb454-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb454-13"><a href="#cb454-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb454-14"><a href="#cb454-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb454-15"><a href="#cb454-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb454-16"><a href="#cb454-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb454-17"><a href="#cb454-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb454-18"><a href="#cb454-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb454-19"><a href="#cb454-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work),</span>
<span id="cb454-20"><a href="#cb454-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb454-21"><a href="#cb454-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos))</span>
<span id="cb454-22"><a href="#cb454-22" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(best$var.coef)): Se han producido NaNs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb456"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Madrid    &lt;LM w/ ARIMA(1,1,2)(1,0,1)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb458"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    
1 Madrid    arima_at1  0.750   -690. 1406. 1407. 1462. &lt;cpl [8]&gt; &lt;cpl [9]&gt; 
2 Madrid    arima_at2  0.733   -684. 1395. 1396. 1456. &lt;cpl [8]&gt; &lt;cpl [10]&gt;
3 Madrid    Snaive     3.03      NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb460-6"><a href="#cb460-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb460-7"><a href="#cb460-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(1,1,3)(1,0,1)[7] errors&gt;  0.733   -684. 1395. 1396. 1456.
2 arima_… &lt;LM w/ ARIMA(1,1,2)(1,0,1)[7] errors&gt;  0.750   -690. 1406. 1407. 1462.
3 Snaive                               &lt;SNAIVE&gt;  3.03      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb462"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb462-3"><a href="#cb462-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb462-4"><a href="#cb462-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-177-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb466-2"><a href="#cb466-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb466-3"><a href="#cb466-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-178-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb467"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-179-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    2.71     0.910
2 Madrid    arima_at2    2.68     0.913
3 Madrid    Snaive    1456.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb470"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1   14.3      0.428
2 Madrid    arima_at2    6.25     0.960
3 Madrid    Snaive    2255.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb472"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb472-2"><a href="#cb472-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    20.5     0.488
2 Madrid    arima_at2    13.1     0.906
3 Madrid    Snaive     2460.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb474"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb474-3"><a href="#cb474-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb474-4"><a href="#cb474-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb474-5"><a href="#cb474-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb474-6"><a href="#cb474-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb474-7"><a href="#cb474-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb474-8"><a href="#cb474-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb474-9"><a href="#cb474-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb474-10"><a href="#cb474-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb474-11"><a href="#cb474-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb475"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb475-2"><a href="#cb475-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb475-3"><a href="#cb475-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb475-4"><a href="#cb475-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb475-5"><a href="#cb475-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb475-6"><a href="#cb475-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb475-7"><a href="#cb475-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb475-8"><a href="#cb475-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb475-9"><a href="#cb475-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-21" class="level3">
<h3 class="anchored" data-anchor-id="days-21">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb476-2"><a href="#cb476-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb476-3"><a href="#cb476-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb476-4"><a href="#cb476-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb476-5"><a href="#cb476-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb476-6"><a href="#cb476-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb476-7"><a href="#cb476-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-185-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb477-5"><a href="#cb477-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb477-6"><a href="#cb477-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb477-7"><a href="#cb477-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-186-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb478"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  2968. 3574. 2995.  43.9  45.4  7.47  5.55 0.532
2 arima_at2 Madrid    Test  2702. 3278. 2743.  39.1  41.4  6.84  5.09 0.537
3 Snaive    Madrid    Test  4099. 4624. 4099.  70.7  70.7 10.2   7.18 0.498</code></pre>
</div>
</div>
</section>
<section id="days-22" class="level3">
<h3 class="anchored" data-anchor-id="days-22">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb480-4"><a href="#cb480-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb480-5"><a href="#cb480-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb480-6"><a href="#cb480-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb480-7"><a href="#cb480-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-188-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb481-4"><a href="#cb481-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb481-5"><a href="#cb481-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb481-6"><a href="#cb481-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb481-7"><a href="#cb481-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-189-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME   RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  6583.  8686. 6597.  55.3  56.1  16.5  13.5 0.652
2 arima_at2 Madrid    Test  5859.  7851. 5880.  48.2  49.3  14.7  12.2 0.600
3 Snaive    Madrid    Test  8368. 10550. 8368.  79.0  79.0  20.9  16.4 0.683</code></pre>
</div>
</div>
</section>
<section id="days-23" class="level3">
<h3 class="anchored" data-anchor-id="days-23">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb484-2"><a href="#cb484-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb484-3"><a href="#cb484-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb484-4"><a href="#cb484-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb484-5"><a href="#cb484-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb484-6"><a href="#cb484-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb484-7"><a href="#cb484-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-191-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb485"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb485-2"><a href="#cb485-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb485-3"><a href="#cb485-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb485-4"><a href="#cb485-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb485-5"><a href="#cb485-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb485-6"><a href="#cb485-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb485-7"><a href="#cb485-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-192-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME   RMSE    MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test   8302. 10414.  8311.  59.1  59.6  20.7  16.2 0.569
2 arima_at2 Madrid    Test   6954.  8985.  7110.  48.2  50.8  17.7  14.0 0.460
3 Snaive    Madrid    Test  10562. 12807. 10562.  81.8  81.8  26.3  19.9 0.631</code></pre>
</div>
</div>
</section>
</section>
<section id="malaga-1" class="level2">
<h2 class="anchored" data-anchor-id="malaga-1">Malaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb488"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a>data_Malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb488-3"><a href="#cb488-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb488-4"><a href="#cb488-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb488-5"><a href="#cb488-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb488-6"><a href="#cb488-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb488-7"><a href="#cb488-7" aria-hidden="true" tabindex="-1"></a>data_Malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1  27.2                  -16        -9
 2 Málaga    2020-06-16         1  27.8                  -13        -4
 3 Málaga    2020-06-17         2  26.9                  -13         1
 4 Málaga    2020-06-18         2  21.6                  -12         3
 5 Málaga    2020-06-19         1  24.7                  -12         2
 6 Málaga    2020-06-20         4  22.6                  -14         8
 7 Málaga    2020-06-21         4  22.7                  -16        -3
 8 Málaga    2020-06-22         6  25                    -13         1
 9 Málaga    2020-06-23         8  25.6                  -10        18
10 Málaga    2020-06-24        65  24.5                  -13        12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_train <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-28" "2021-03-13" "2021-03-13" "2021-07-27" "2021-12-10" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb492"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_test <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb492-2"><a href="#cb492-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb492-3"><a href="#cb492-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-12-11" "2022-01-07" "2022-02-03" "2022-02-03" "2022-03-02" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb494-3"><a href="#cb494-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb494-4"><a href="#cb494-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb494-5"><a href="#cb494-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb498"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb500"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb502"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb502-2"><a href="#cb502-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb502-3"><a href="#cb502-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb502-4"><a href="#cb502-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb504"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb506"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb508"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb508-3"><a href="#cb508-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb508-4"><a href="#cb508-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb510"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb510-2"><a href="#cb510-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb510-3"><a href="#cb510-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb510-4"><a href="#cb510-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb512-3"><a href="#cb512-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb514"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb516"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb516-3"><a href="#cb516-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb516-4"><a href="#cb516-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb516-5"><a href="#cb516-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb516-6"><a href="#cb516-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb516-7"><a href="#cb516-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb516-8"><a href="#cb516-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb516-9"><a href="#cb516-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb516-10"><a href="#cb516-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work)</span>
<span id="cb516-11"><a href="#cb516-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb516-12"><a href="#cb516-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb516-13"><a href="#cb516-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb516-14"><a href="#cb516-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb516-15"><a href="#cb516-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb516-16"><a href="#cb516-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb516-17"><a href="#cb516-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb516-18"><a href="#cb516-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb516-19"><a href="#cb516-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work),</span>
<span id="cb516-20"><a href="#cb516-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb516-21"><a href="#cb516-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos))</span>
<span id="cb516-22"><a href="#cb516-22" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(best$var.coef)): Se han producido NaNs

Warning in sqrt(diag(best$var.coef)): Se han producido NaNs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb518"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Málaga    &lt;LM w/ ARIMA(1,0,1)(2,0,1)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb520"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
1 Málaga    arima_at1  0.495   -578. 1184. 1184. 1244. &lt;cpl [15]&gt; &lt;cpl [8]&gt; 
2 Málaga    arima_at2  0.486   -573. 1176. 1177. 1240. &lt;cpl [8]&gt;  &lt;cpl [10]&gt;
3 Málaga    Snaive     2.00      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb522"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb522-2"><a href="#cb522-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb522-3"><a href="#cb522-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb522-4"><a href="#cb522-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb522-5"><a href="#cb522-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb522-6"><a href="#cb522-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb522-7"><a href="#cb522-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(1,0,3)(1,0,1)[7] errors&gt;  0.486   -573. 1176. 1177. 1240.
2 arima_… &lt;LM w/ ARIMA(1,0,1)(2,0,1)[7] errors&gt;  0.495   -578. 1184. 1184. 1244.
3 Snaive                               &lt;SNAIVE&gt;  2.00      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb524"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb524-2"><a href="#cb524-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb524-3"><a href="#cb524-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb524-4"><a href="#cb524-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-201-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb528"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb528-2"><a href="#cb528-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb528-3"><a href="#cb528-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-202-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb529"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb529-2"><a href="#cb529-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb529-3"><a href="#cb529-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-203-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb530"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb530-2"><a href="#cb530-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    17.8    0.0131
2 Málaga    arima_at2    12.6    0.0837
3 Málaga    Snaive     1429.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb532"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    31.8   0.00425
2 Málaga    arima_at2    25.5   0.0295 
3 Málaga    Snaive     2060.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb534"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb534-2"><a href="#cb534-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    46.1   0.00126
2 Málaga    arima_at2    41.1   0.00550
3 Málaga    Snaive     2230.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb536"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb536-5"><a href="#cb536-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb536-6"><a href="#cb536-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb536-7"><a href="#cb536-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb536-8"><a href="#cb536-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb536-9"><a href="#cb536-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb536-10"><a href="#cb536-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb536-11"><a href="#cb536-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb537"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb537-2"><a href="#cb537-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb537-3"><a href="#cb537-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb537-4"><a href="#cb537-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb537-5"><a href="#cb537-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb537-6"><a href="#cb537-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb537-7"><a href="#cb537-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb537-8"><a href="#cb537-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb537-9"><a href="#cb537-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-24" class="level3">
<h3 class="anchored" data-anchor-id="days-24">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb538"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb538-2"><a href="#cb538-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb538-3"><a href="#cb538-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb538-4"><a href="#cb538-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb538-5"><a href="#cb538-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb538-6"><a href="#cb538-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb538-7"><a href="#cb538-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-209-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb539"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb539-2"><a href="#cb539-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb539-3"><a href="#cb539-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb539-4"><a href="#cb539-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb539-5"><a href="#cb539-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb539-6"><a href="#cb539-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb539-7"><a href="#cb539-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-210-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb540"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb540-2"><a href="#cb540-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   213.  257.  213.  24.1  24.1  2.29  1.59 0.403
2 arima_at2 Málaga    Test   187.  238.  187.  20.8  20.8  2.01  1.47 0.417
3 Snaive    Málaga    Test   399.  417.  399.  48.9  48.9  4.28  2.58 0.128</code></pre>
</div>
</div>
</section>
<section id="days-25" class="level3">
<h3 class="anchored" data-anchor-id="days-25">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb542"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb542-2"><a href="#cb542-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb542-3"><a href="#cb542-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb542-4"><a href="#cb542-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb542-5"><a href="#cb542-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb542-6"><a href="#cb542-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb542-7"><a href="#cb542-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-212-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb543"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb543-2"><a href="#cb543-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb543-3"><a href="#cb543-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb543-4"><a href="#cb543-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb543-5"><a href="#cb543-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb543-6"><a href="#cb543-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb543-7"><a href="#cb543-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-213-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb544"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb544-2"><a href="#cb544-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   475.  581.  475.  36.8  36.8  5.10  3.59 0.560
2 arima_at2 Málaga    Test   447.  558.  447.  34.0  34.0  4.80  3.45 0.560
3 Snaive    Málaga    Test   707.  799.  707.  59.2  59.2  7.59  4.94 0.581</code></pre>
</div>
</div>
</section>
<section id="days-26" class="level3">
<h3 class="anchored" data-anchor-id="days-26">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb546"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb546-2"><a href="#cb546-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb546-3"><a href="#cb546-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb546-4"><a href="#cb546-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb546-5"><a href="#cb546-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb546-6"><a href="#cb546-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb546-7"><a href="#cb546-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-215-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb547"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb547-2"><a href="#cb547-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb547-3"><a href="#cb547-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb547-4"><a href="#cb547-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb547-5"><a href="#cb547-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb547-6"><a href="#cb547-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb547-7"><a href="#cb547-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-216-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb548"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb548-2"><a href="#cb548-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   829. 1070.  829.  45.8  45.8  8.91  6.62 0.759
2 arima_at2 Málaga    Test   802. 1051.  802.  43.6  43.6  8.62  6.50 0.759
3 Snaive    Málaga    Test  1094. 1310. 1094.  66.1  66.1 11.8   8.10 0.779</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla-1" class="level2">
<h2 class="anchored" data-anchor-id="sevilla-1">Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb550"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb550-2"><a href="#cb550-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb550-3"><a href="#cb550-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb550-4"><a href="#cb550-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb550-5"><a href="#cb550-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb550-6"><a href="#cb550-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb550-7"><a href="#cb550-7" aria-hidden="true" tabindex="-1"></a>data_Sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2  23.1                  -14       -13
 2 Sevilla   2020-06-16         1  24.0                  -10        -4
 3 Sevilla   2020-06-17         0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1  29.3                  -17       -19
 9 Sevilla   2020-06-23         0  30.2                  -12       -13
10 Sevilla   2020-06-24         1  29.4                  -12       -12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb552"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_train <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb552-2"><a href="#cb552-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb552-3"><a href="#cb552-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-28" "2021-03-13" "2021-03-13" "2021-07-27" "2021-12-10" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb554"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_test <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb554-2"><a href="#cb554-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb554-3"><a href="#cb554-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-12-11" "2022-01-07" "2022-02-03" "2022-02-03" "2022-03-02" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb556"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb556-2"><a href="#cb556-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb556-3"><a href="#cb556-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb556-4"><a href="#cb556-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb556-5"><a href="#cb556-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb558"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb558-2"><a href="#cb558-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb558-3"><a href="#cb558-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb558-4"><a href="#cb558-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb558-5"><a href="#cb558-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb560"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb560-3"><a href="#cb560-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb560-4"><a href="#cb560-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb562"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb564"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb564-2"><a href="#cb564-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb564-3"><a href="#cb564-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb564-4"><a href="#cb564-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb566"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb566-2"><a href="#cb566-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb566-3"><a href="#cb566-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb568"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb570"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb570-2"><a href="#cb570-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb570-3"><a href="#cb570-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb570-4"><a href="#cb570-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb572"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb572-2"><a href="#cb572-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb572-3"><a href="#cb572-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb572-4"><a href="#cb572-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb574"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb574-1"><a href="#cb574-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb574-2"><a href="#cb574-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb574-3"><a href="#cb574-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value

Warning in optimise(lambda_coef_var, c(lower, upper), x = x, .period =
max(.period, : NA/Inf replaced by maximum positive value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb576"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb576-1"><a href="#cb576-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb578"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb578-1"><a href="#cb578-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb578-2"><a href="#cb578-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb578-3"><a href="#cb578-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb578-4"><a href="#cb578-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb578-5"><a href="#cb578-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb578-6"><a href="#cb578-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb578-7"><a href="#cb578-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb578-8"><a href="#cb578-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb578-9"><a href="#cb578-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb578-10"><a href="#cb578-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work)</span>
<span id="cb578-11"><a href="#cb578-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb578-12"><a href="#cb578-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb578-13"><a href="#cb578-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb578-14"><a href="#cb578-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb578-15"><a href="#cb578-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb578-16"><a href="#cb578-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb578-17"><a href="#cb578-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb578-18"><a href="#cb578-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb578-19"><a href="#cb578-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work),</span>
<span id="cb578-20"><a href="#cb578-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb578-21"><a href="#cb578-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos))</span>
<span id="cb578-22"><a href="#cb578-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb578-23"><a href="#cb578-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb578-24"><a href="#cb578-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb578-25"><a href="#cb578-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Sevilla   &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb580"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
1 Sevilla   arima_at1  0.845   -720. 1467. 1468. 1528. &lt;cpl [17]&gt; &lt;cpl [1]&gt; 
2 Sevilla   arima_at2  0.816   -711. 1451. 1452. 1511. &lt;cpl [7]&gt;  &lt;cpl [11]&gt;
3 Sevilla   Snaive     2.39      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb582"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb582-2"><a href="#cb582-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb582-3"><a href="#cb582-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb582-4"><a href="#cb582-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb582-5"><a href="#cb582-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb582-6"><a href="#cb582-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb582-7"><a href="#cb582-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(0,1,4)(1,0,1)[7] errors&gt;  0.816   -711. 1451. 1452. 1511.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.845   -720. 1467. 1468. 1528.
3 Snaive                               &lt;SNAIVE&gt;  2.39      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb584"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb584-2"><a href="#cb584-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb584-3"><a href="#cb584-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb584-4"><a href="#cb584-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing non-finite values (stat_bin).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-225-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb588"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb588-2"><a href="#cb588-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb588-3"><a href="#cb588-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-226-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb589"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb589-2"><a href="#cb589-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb589-3"><a href="#cb589-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-227-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb590"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb590-2"><a href="#cb590-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    5.22     0.634
2 Sevilla   arima_at2    2.28     0.943
3 Sevilla   Snaive    1084.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb592"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb592-1"><a href="#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb592-2"><a href="#cb592-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    16.0     0.316
2 Sevilla   arima_at2    11.8     0.622
3 Sevilla   Snaive     1585.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb594"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb594-1"><a href="#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb594-2"><a href="#cb594-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    33.0    0.0461
2 Sevilla   arima_at2    23.6    0.314 
3 Sevilla   Snaive     1738.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb596"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb596-1"><a href="#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb596-2"><a href="#cb596-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb596-3"><a href="#cb596-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb596-4"><a href="#cb596-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb596-5"><a href="#cb596-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb596-6"><a href="#cb596-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb596-7"><a href="#cb596-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb596-8"><a href="#cb596-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb596-9"><a href="#cb596-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb596-10"><a href="#cb596-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb596-11"><a href="#cb596-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb597"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb597-2"><a href="#cb597-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb597-3"><a href="#cb597-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb597-4"><a href="#cb597-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb597-5"><a href="#cb597-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb597-6"><a href="#cb597-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb597-7"><a href="#cb597-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb597-8"><a href="#cb597-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb597-9"><a href="#cb597-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-27" class="level3">
<h3 class="anchored" data-anchor-id="days-27">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb598"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb598-1"><a href="#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb598-2"><a href="#cb598-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb598-3"><a href="#cb598-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb598-4"><a href="#cb598-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb598-5"><a href="#cb598-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>))</span>
<span id="cb598-6"><a href="#cb598-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb598-7"><a href="#cb598-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-233-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb599"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">9</span>) <span class="sc">&amp;</span></span>
<span id="cb599-5"><a href="#cb599-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb599-6"><a href="#cb599-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb599-7"><a href="#cb599-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-234-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb600"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb600-1"><a href="#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb600-2"><a href="#cb600-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   492.  571.  492.  47.4  47.4  5.19  3.80 0.534
2 arima_at2 Sevilla   Test   463.  546.  463.  44.1  44.1  4.89  3.63 0.530
3 Snaive    Sevilla   Test   614.  683.  614.  62.8  62.8  6.48  4.54 0.325</code></pre>
</div>
</div>
</section>
<section id="days-28" class="level3">
<h3 class="anchored" data-anchor-id="days-28">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb602"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb602-1"><a href="#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb602-2"><a href="#cb602-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb602-3"><a href="#cb602-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb602-4"><a href="#cb602-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb602-5"><a href="#cb602-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>))</span>
<span id="cb602-6"><a href="#cb602-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb602-7"><a href="#cb602-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-236-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb603"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb603-1"><a href="#cb603-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb603-2"><a href="#cb603-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb603-3"><a href="#cb603-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb603-4"><a href="#cb603-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">16</span>) <span class="sc">&amp;</span></span>
<span id="cb603-5"><a href="#cb603-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb603-6"><a href="#cb603-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb603-7"><a href="#cb603-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-237-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb604"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb604-1"><a href="#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb604-2"><a href="#cb604-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   905. 1106.  905.  57.9  57.9  9.55  7.35 0.745
2 arima_at2 Sevilla   Test   848. 1042.  848.  53.8  53.8  8.94  6.93 0.735
3 Snaive    Sevilla   Test  1046. 1229. 1046.  71.1  71.1 11.0   8.17 0.717</code></pre>
</div>
</div>
</section>
<section id="days-29" class="level3">
<h3 class="anchored" data-anchor-id="days-29">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb606"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb606-1"><a href="#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb606-2"><a href="#cb606-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb606-3"><a href="#cb606-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb606-4"><a href="#cb606-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb606-5"><a href="#cb606-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>))</span>
<span id="cb606-6"><a href="#cb606-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb606-7"><a href="#cb606-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-239-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb607"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb607-4"><a href="#cb607-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-10"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">23</span>) <span class="sc">&amp;</span></span>
<span id="cb607-5"><a href="#cb607-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb607-6"><a href="#cb607-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb607-7"><a href="#cb607-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-240-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb608"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb608-1"><a href="#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb608-2"><a href="#cb608-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test  1309. 1584. 1309.  65.0  65.0  13.8 10.5  0.805
2 arima_at2 Sevilla   Test  1218. 1479. 1218.  60.1  60.1  12.9  9.84 0.792
3 Snaive    Sevilla   Test  1457. 1722. 1457.  75.8  75.8  15.4 11.5  0.779</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./multivariate.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Multivariate (INE mobility + temp) prediction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lstm.html" class="pagination-link">
        <span class="nav-page-text">Task 5: LSTM</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>