<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.442">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PEC3 - COVID-19 Outbreak prediction - Multivariate (Google mobility + temp) prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<link href="./lstm.html" rel="next">
<link href="./multivariate.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Multivariate (Google mobility + temp) prediction</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PEC3 - COVID-19 Outbreak prediction</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jperezord/jperezord.github.io.git" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./data.html" class="sidebar-item-text sidebar-link">Task 1: Data acquisition and exploration</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cne_data.html" class="sidebar-item-text sidebar-link">CNE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ine_data.html" class="sidebar-item-text sidebar-link">INE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./google_data.html" class="sidebar-item-text sidebar-link">GOOGLE data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aemet_data.html" class="sidebar-item-text sidebar-link">AEMET data</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./combination.html" class="sidebar-item-text sidebar-link">Task 2: Datasets combination</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visual.html" class="sidebar-item-text sidebar-link">Task 3: Visual analysis</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visual_demo.html" class="sidebar-item-text sidebar-link">Task 4: Visual demographic analysis</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./arima.html" class="sidebar-item-text sidebar-link">Task 5: ARIMA</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acf.html" class="sidebar-item-text sidebar-link">ACF and PACF plots</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stl.html" class="sidebar-item-text sidebar-link">STL decomposition / Transformations</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate.html" class="sidebar-item-text sidebar-link">Univariate prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate_temp.html" class="sidebar-item-text sidebar-link">Multivariate (temperature) prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate.html" class="sidebar-item-text sidebar-link">Multivariate (INE mobility + temp) prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate_google.html" class="sidebar-item-text sidebar-link active">Multivariate (Google mobility + temp) prediction</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./lstm.html" class="sidebar-item-text sidebar-link">Task 6: LSTM</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lstm_uni.html" class="sidebar-item-text sidebar-link">LSTM univariate prediction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lstm_multi.html" class="sidebar-item-text sidebar-link">LSTM multivariate prediction</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-sixth-epidemiological-period" id="toc-before-sixth-epidemiological-period" class="nav-link active" data-scroll-target="#before-sixth-epidemiological-period">Before sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias" id="toc-asturias" class="nav-link" data-scroll-target="#asturias">Asturias</a>
  <ul class="collapse">
  <li><a href="#days" id="toc-days" class="nav-link" data-scroll-target="#days">7 days</a></li>
  <li><a href="#days-1" id="toc-days-1" class="nav-link" data-scroll-target="#days-1">14 days</a></li>
  <li><a href="#days-2" id="toc-days-2" class="nav-link" data-scroll-target="#days-2">21 days</a></li>
  <li><a href="#days-3" id="toc-days-3" class="nav-link" data-scroll-target="#days-3">90 days</a></li>
  </ul></li>
  <li><a href="#barcelona" id="toc-barcelona" class="nav-link" data-scroll-target="#barcelona">Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-4" id="toc-days-4" class="nav-link" data-scroll-target="#days-4">7 days</a></li>
  <li><a href="#days-5" id="toc-days-5" class="nav-link" data-scroll-target="#days-5">14 days</a></li>
  <li><a href="#days-6" id="toc-days-6" class="nav-link" data-scroll-target="#days-6">21 days</a></li>
  <li><a href="#days-7" id="toc-days-7" class="nav-link" data-scroll-target="#days-7">90 days</a></li>
  </ul></li>
  <li><a href="#madrid" id="toc-madrid" class="nav-link" data-scroll-target="#madrid">Madrid</a>
  <ul class="collapse">
  <li><a href="#days-8" id="toc-days-8" class="nav-link" data-scroll-target="#days-8">7 days</a></li>
  <li><a href="#days-9" id="toc-days-9" class="nav-link" data-scroll-target="#days-9">14 days</a></li>
  <li><a href="#days-10" id="toc-days-10" class="nav-link" data-scroll-target="#days-10">21 days</a></li>
  <li><a href="#days-11" id="toc-days-11" class="nav-link" data-scroll-target="#days-11">90 days</a></li>
  </ul></li>
  <li><a href="#malaga" id="toc-malaga" class="nav-link" data-scroll-target="#malaga">Malaga</a>
  <ul class="collapse">
  <li><a href="#days-12" id="toc-days-12" class="nav-link" data-scroll-target="#days-12">7 days</a></li>
  <li><a href="#days-13" id="toc-days-13" class="nav-link" data-scroll-target="#days-13">14 days</a></li>
  <li><a href="#days-14" id="toc-days-14" class="nav-link" data-scroll-target="#days-14">21 days</a></li>
  <li><a href="#days-15" id="toc-days-15" class="nav-link" data-scroll-target="#days-15">90 days</a></li>
  </ul></li>
  <li><a href="#sevilla" id="toc-sevilla" class="nav-link" data-scroll-target="#sevilla">Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-16" id="toc-days-16" class="nav-link" data-scroll-target="#days-16">7 days</a></li>
  <li><a href="#days-17" id="toc-days-17" class="nav-link" data-scroll-target="#days-17">14 days</a></li>
  <li><a href="#days-18" id="toc-days-18" class="nav-link" data-scroll-target="#days-18">21 days</a></li>
  <li><a href="#days-19" id="toc-days-19" class="nav-link" data-scroll-target="#days-19">90 days</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#middel-of-sixth-epidemiological-period" id="toc-middel-of-sixth-epidemiological-period" class="nav-link" data-scroll-target="#middel-of-sixth-epidemiological-period">Middel of sixth epidemiological period</a>
  <ul class="collapse">
  <li><a href="#asturias-1" id="toc-asturias-1" class="nav-link" data-scroll-target="#asturias-1">Asturias</a>
  <ul class="collapse">
  <li><a href="#days-20" id="toc-days-20" class="nav-link" data-scroll-target="#days-20">7 days</a></li>
  <li><a href="#days-21" id="toc-days-21" class="nav-link" data-scroll-target="#days-21">14 days</a></li>
  <li><a href="#days-22" id="toc-days-22" class="nav-link" data-scroll-target="#days-22">21 days</a></li>
  <li><a href="#days-23" id="toc-days-23" class="nav-link" data-scroll-target="#days-23">57 days</a></li>
  </ul></li>
  <li><a href="#barcelona-1" id="toc-barcelona-1" class="nav-link" data-scroll-target="#barcelona-1">Barcelona</a>
  <ul class="collapse">
  <li><a href="#days-24" id="toc-days-24" class="nav-link" data-scroll-target="#days-24">7 days</a></li>
  <li><a href="#days-25" id="toc-days-25" class="nav-link" data-scroll-target="#days-25">14 days</a></li>
  <li><a href="#days-26" id="toc-days-26" class="nav-link" data-scroll-target="#days-26">21 days</a></li>
  <li><a href="#days-27" id="toc-days-27" class="nav-link" data-scroll-target="#days-27">57 days</a></li>
  </ul></li>
  <li><a href="#madrid-1" id="toc-madrid-1" class="nav-link" data-scroll-target="#madrid-1">Madrid</a>
  <ul class="collapse">
  <li><a href="#days-28" id="toc-days-28" class="nav-link" data-scroll-target="#days-28">7 days</a></li>
  <li><a href="#days-29" id="toc-days-29" class="nav-link" data-scroll-target="#days-29">14 days</a></li>
  <li><a href="#days-30" id="toc-days-30" class="nav-link" data-scroll-target="#days-30">21 days</a></li>
  <li><a href="#days-31" id="toc-days-31" class="nav-link" data-scroll-target="#days-31">57 days</a></li>
  </ul></li>
  <li><a href="#malaga-1" id="toc-malaga-1" class="nav-link" data-scroll-target="#malaga-1">Malaga</a>
  <ul class="collapse">
  <li><a href="#days-32" id="toc-days-32" class="nav-link" data-scroll-target="#days-32">7 days</a></li>
  <li><a href="#days-33" id="toc-days-33" class="nav-link" data-scroll-target="#days-33">14 days</a></li>
  <li><a href="#days-34" id="toc-days-34" class="nav-link" data-scroll-target="#days-34">21 days</a></li>
  <li><a href="#days-35" id="toc-days-35" class="nav-link" data-scroll-target="#days-35">57 days</a></li>
  </ul></li>
  <li><a href="#sevilla-1" id="toc-sevilla-1" class="nav-link" data-scroll-target="#sevilla-1">Sevilla</a>
  <ul class="collapse">
  <li><a href="#days-36" id="toc-days-36" class="nav-link" data-scroll-target="#days-36">7 days</a></li>
  <li><a href="#days-37" id="toc-days-37" class="nav-link" data-scroll-target="#days-37">14 days</a></li>
  <li><a href="#days-38" id="toc-days-38" class="nav-link" data-scroll-target="#days-38">21 days</a></li>
  <li><a href="#days-39" id="toc-days-39" class="nav-link" data-scroll-target="#days-39">57 days</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Multivariate (Google mobility + temp) prediction</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Load packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>      here,      <span class="co"># file locator</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      tidyverse, <span class="co"># data management and ggplot2 graphics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      skimr,     <span class="co"># get overview of data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      janitor,   <span class="co"># produce and adorn tabulations and cross-tabulations</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      tsibble,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      fable,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      feasts,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      fabletools,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      lubridate</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>covid_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"clean"</span>, <span class="st">"final_covid_data.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The temporal limits of our prediction will be:</p>
<ul>
<li>Data as of June 14th 2020 which is considered the beginning of the second epidemiological period in Spain</li>
<li>In the first case scenario, data previous the start of the sixth wave of covid-19 (14 oct 2021).</li>
<li>In the second case scenario, all the available data (limited by mobility information 29 dec 2021)</li>
</ul>
<section id="before-sixth-epidemiological-period" class="level1">
<h1>Before sixth epidemiological period</h1>
<section id="asturias" class="level2">
<h2 class="anchored" data-anchor-id="asturias">Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0  16                   -6          39
 2 Asturias  2020-06-16         1  15.6                 -6           7
 3 Asturias  2020-06-17         0  15.6                 -7          20
 4 Asturias  2020-06-18         0  15.1                 -4          68
 5 Asturias  2020-06-19         0  14.8                 -4          52
 6 Asturias  2020-06-20         0  16.8                -10          71
 7 Asturias  2020-06-21         0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0  18.2                 -1          99
 9 Asturias  2020-06-23         0  20                   -2         129
10 Asturias  2020-06-24         0  18.2                 -9          63
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work),</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos))</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(best$var.coef)): NaNs produced</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Asturias  &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.955   -675. 1380. 1381. 1443. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
2 Asturias  arima_at2  0.922   -668. 1363. 1364. 1417. &lt;cpl [9]&gt;  &lt;cpl [8]&gt;
3 Asturias  Snaive     2.32      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,0,1)(1,0,1)[7] errors&gt;  0.922   -668. 1363. 1364. 1417.
2 arima_… &lt;LM w/ ARIMA(4,0,0)(2,0,0)[7] errors&gt;  0.955   -675. 1380. 1381. 1443.
3 Snaive                               &lt;SNAIVE&gt;  2.32      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    17.1    0.0165
2 Asturias  arima_at2    12.1    0.0972
3 Asturias  Snaive      629.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    35.5   0.00125
2 Asturias  arima_at2    28.9   0.0108 
3 Asturias  Snaive      892.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    52.1  0.000185
2 Asturias  arima_at2    38.2  0.0121  
3 Asturias  Snaive      927.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1   128.    0.00526
2 Asturias  arima_at2    99.4   0.233  
3 Asturias  Snaive     1195.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days" class="level3">
<h3 class="anchored" data-anchor-id="days">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   3.68  9.00  5.65   6.27  23.7 0.114 0.110 0.0968 
2 arima_at2 Asturias  Test   5.62  9.84  6.95  15.8   29.0 0.140 0.120 0.318  
3 Snaive    Asturias  Test   2.41 14.0   9.98 -10.1   49.0 0.201 0.171 0.00766</code></pre>
</div>
</div>
</section>
<section id="days-1" class="level3">
<h3 class="anchored" data-anchor-id="days-1">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Asturias  Test   7.39  11.7  8.37 18.2   26.9 0.168 0.142  0.0327
2 arima_at2 Asturias  Test  11.4   15.0 12.1  33.0   39.6 0.243 0.183  0.304 
3 Snaive    Asturias  Test   6.69  16.0 11.4   8.17  41.5 0.229 0.195 -0.156 </code></pre>
</div>
</div>
</section>
<section id="days-2" class="level3">
<h3 class="anchored" data-anchor-id="days-2">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE     ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 arima_at1 Asturias  Test   4.99  10.5  7.85  9.97  26.3 0.158 0.128 -0.00881
2 arima_at2 Asturias  Test  11.7   14.8 12.1  34.3   38.7 0.243 0.180  0.155  
3 Snaive    Asturias  Test   5.77  15.6 11.5   6.52  40.8 0.232 0.190 -0.223  </code></pre>
</div>
</div>
</section>
<section id="days-3" class="level3">
<h3 class="anchored" data-anchor-id="days-3">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   689. 1200.  691.  56.5  64.2  13.9  14.6 0.925
2 arima_at2 Asturias  Test   721. 1229.  721.  74.4  75.9  14.5  15.0 0.926
3 Snaive    Asturias  Test   702. 1213.  704.  60.0  71.7  14.2  14.8 0.925</code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona" class="level2">
<h2 class="anchored" data-anchor-id="barcelona">Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>data_Barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62  21.2                   -9        17
 2 Barcelona 2020-06-16        66  20.8                  -10       -16
 3 Barcelona 2020-06-17        70  20.3                   -4        14
 4 Barcelona 2020-06-18        68  18.8                   -8        -6
 5 Barcelona 2020-06-19        65  20.4                   -5        10
 6 Barcelona 2020-06-20        53  21.8                  -12        15
 7 Barcelona 2020-06-21        38  22.8                  -18        18
 8 Barcelona 2020-06-22        69  23.8                    5        24
 9 Barcelona 2020-06-23        95  23.4                   19        28
10 Barcelona 2020-06-24        44  23.6                  -71        28
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_train <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_test <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work),</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos))</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Barcelona &lt;LM w/ ARIMA(1,0,2)(1,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
1 Barcelona arima_at1  0.501   -525. 1076. 1077. 1131. &lt;cpl [8]&gt; &lt;cpl [2]&gt;
2 Barcelona arima_at2  0.492   -520. 1068. 1069. 1127. &lt;cpl [9]&gt; &lt;cpl [2]&gt;
3 Barcelona Snaive     3.23      NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,0,2)(1,0,0)[7] errors&gt;  0.492   -520. 1068. 1069. 1127.
2 arima_… &lt;LM w/ ARIMA(1,0,2)(1,0,0)[7] errors&gt;  0.501   -525. 1076. 1077. 1131.
3 Snaive                               &lt;SNAIVE&gt;  3.23      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    49.8 0.0000000156 
2 Barcelona arima_at2    52.9 0.00000000385
3 Barcelona Snaive     1648.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    68.6 0.00000000350
2 Barcelona arima_at2    69.2 0.00000000268
3 Barcelona Snaive     2222.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat    lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 Barcelona arima_at1    77.6 0.0000000204
2 Barcelona arima_at2    78.4 0.0000000147
3 Barcelona Snaive     2272.  0           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat    lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 Barcelona arima_at1    182. 0.0000000314
2 Barcelona arima_at2    176. 0.000000148 
3 Barcelona Snaive      3575. 0           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-4" class="level3">
<h3 class="anchored" data-anchor-id="days-4">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  -29.5  75.9  67.0 -20.3  40.8 0.178 0.114 0.551
2 arima_at2 Barcelona Test  -45.0  88.5  79.0 -28.7  47.2 0.210 0.134 0.598
3 Snaive    Barcelona Test  -25.0  80.0  67.1 -17.8  40.2 0.178 0.121 0.187</code></pre>
</div>
</div>
</section>
<section id="days-5" class="level3">
<h3 class="anchored" data-anchor-id="days-5">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test  -17.3  72.1  63.5 -12.7  34.8 0.169 0.109 0.462 
2 arima_at2 Barcelona Test  -47.5  91.4  80.9 -27.0  43.8 0.215 0.138 0.505 
3 Snaive    Barcelona Test  -21.3  88.0  75.0 -15.3  40.3 0.199 0.133 0.0630</code></pre>
</div>
</div>
</section>
<section id="days-6" class="level3">
<h3 class="anchored" data-anchor-id="days-6">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Barcelona Test    2.67  82.2  67.8  -7.70  33.2 0.180 0.124  0.389
2 arima_at2 Barcelona Test  -46.5   91.9  83.2 -28.8   43.5 0.221 0.139  0.321
3 Snaive    Barcelona Test  -10.1  119.   90.1 -14.8   41.9 0.239 0.179 -0.242</code></pre>
</div>
</div>
</section>
<section id="days-7" class="level3">
<h3 class="anchored" data-anchor-id="days-7">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  4772. 8726. 4788.  55.3  65.0  12.7  13.2 0.867
2 arima_at2 Barcelona Test  4698. 8750. 4736.  42.6  61.9  12.6  13.2 0.869
3 Snaive    Barcelona Test  4888. 8865. 4913.  56.6  70.5  13.1  13.4 0.870</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid" class="level2">
<h2 class="anchored" data-anchor-id="madrid">Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>data_Madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>data_Madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153  20.7                   -8        34
 2 Madrid    2020-06-16        91  21                     -8        21
 3 Madrid    2020-06-17        93  20.2                   -5        34
 4 Madrid    2020-06-18        85  21.9                   -7        30
 5 Madrid    2020-06-19        78  22.6                   -9        22
 6 Madrid    2020-06-20        67  23.4                  -12        25
 7 Madrid    2020-06-21        42  25                    -13        14
 8 Madrid    2020-06-22        60  27.3                   -8        29
 9 Madrid    2020-06-23        68  28.4                   -9        23
10 Madrid    2020-06-24        49  28                     -7        22
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_train <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_test <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work)</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work),</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos))</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Madrid    &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Madrid    arima_at1  0.494   -519. 1066. 1067. 1125. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
2 Madrid    arima_at2  0.494   -519. 1066. 1067. 1125. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
3 Madrid    Snaive     3.02      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;  0.494   -519. 1066. 1067. 1125.
2 arima_… &lt;LM w/ ARIMA(3,0,0)(1,0,1)[7] errors&gt;  0.494   -519. 1066. 1067. 1125.
3 Snaive                               &lt;SNAIVE&gt;  3.02      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    8.14     0.320
2 Madrid    arima_at2    8.14     0.320
3 Madrid    Snaive    1553.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    19.6     0.144
2 Madrid    arima_at2    19.6     0.144
3 Madrid    Snaive     2371.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    29.2     0.109
2 Madrid    arima_at2    29.2     0.109
3 Madrid    Snaive     2571.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    119.    0.0225
2 Madrid    arima_at2    119.    0.0225
3 Madrid    Snaive      3699.    0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-8" class="level3">
<h3 class="anchored" data-anchor-id="days-8">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Madrid    Test   66.6  114.  98.7 10.6   38.9 0.233 0.170 -0.142
2 arima_at2 Madrid    Test   66.6  114.  98.7 10.6   38.9 0.233 0.170 -0.142
3 Snaive    Madrid    Test   25.6  123. 102.  -9.85  47.5 0.240 0.183 -0.107</code></pre>
</div>
</div>
</section>
<section id="days-9" class="level3">
<h3 class="anchored" data-anchor-id="days-9">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Madrid    Test   71.3  118.  102.  12.6  38.2 0.240 0.176 -0.0603
2 arima_at2 Madrid    Test   71.3  118.  102.  12.6  38.2 0.240 0.176 -0.0603
3 Snaive    Madrid    Test   16.7  124.  102. -12.8  46.7 0.240 0.185 -0.0438</code></pre>
</div>
</div>
</section>
<section id="days-10" class="level3">
<h3 class="anchored" data-anchor-id="days-10">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test   89.9  148.  121.  15.5  40.0 0.285 0.220 0.225
2 arima_at2 Madrid    Test   89.9  148.  121.  15.5  40.0 0.285 0.220 0.225
3 Snaive    Madrid    Test   22.0  137.  112. -13.4  48.6 0.264 0.204 0.131</code></pre>
</div>
</div>
</section>
<section id="days-11" class="level3">
<h3 class="anchored" data-anchor-id="days-11">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  4656. 8366. 4665.  56.9  63.6  11.0  12.5 0.838
2 arima_at2 Madrid    Test  4656. 8366. 4665.  56.9  63.6  11.0  12.5 0.838
3 Snaive    Madrid    Test  4718. 8525. 4752.  47.9  67.2  11.2  12.7 0.839</code></pre>
</div>
</div>
</section>
</section>
<section id="malaga" class="level2">
<h2 class="anchored" data-anchor-id="malaga">Malaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>data_Malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>data_Malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1  27.2                  -16        -9
 2 Málaga    2020-06-16         1  27.8                  -13        -4
 3 Málaga    2020-06-17         2  26.9                  -13         1
 4 Málaga    2020-06-18         2  21.6                  -12         3
 5 Málaga    2020-06-19         1  24.7                  -12         2
 6 Málaga    2020-06-20         4  22.6                  -14         8
 7 Málaga    2020-06-21         4  22.7                  -16        -3
 8 Málaga    2020-06-22         6  25                    -13         1
 9 Málaga    2020-06-23         8  25.6                  -10        18
10 Málaga    2020-06-24        65  24.5                  -13        12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_train <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_test <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work)</span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work),</span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos))</span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Málaga    &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Málaga    arima_at1  0.469   -500. 1029. 1030. 1087. &lt;cpl [18]&gt; &lt;cpl [0]&gt;
2 Málaga    arima_at2  0.464   -498. 1024. 1025. 1083. &lt;cpl [16]&gt; &lt;cpl [2]&gt;
3 Málaga    Snaive     2.08      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(2,1,2)(2,0,0)[7] errors&gt;  0.464   -498. 1024. 1025. 1083.
2 arima_… &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;  0.469   -500. 1029. 1030. 1087.
3 Snaive                               &lt;SNAIVE&gt;  2.08      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    6.82     0.448
2 Málaga    arima_at2    4.67     0.700
3 Málaga    Snaive    1353.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    17.7     0.219
2 Málaga    arima_at2    10.6     0.715
3 Málaga    Snaive     1943.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    24.8     0.257
2 Málaga    arima_at2    17.7     0.668
3 Málaga    Snaive     2088.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1   121.     0.0171
2 Málaga    arima_at2    87.8    0.545 
3 Málaga    Snaive     3170.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-12" class="level3">
<h3 class="anchored" data-anchor-id="days-12">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test   9.98  18.0  16.2   7.92  34.9 0.164 0.107 -0.0177
2 arima_at2 Málaga    Test  10.2   18.3  16.3   8.34  35.0 0.166 0.108  0.0652
3 Snaive    Málaga    Test  -3.97  22.9  19.8 -27.0   52.2 0.201 0.135  0.0122</code></pre>
</div>
</div>
</section>
<section id="days-13" class="level3">
<h3 class="anchored" data-anchor-id="days-13">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Málaga    Test  13.0   21.1  17.6  13.8  31.5 0.179 0.124  0.199 
2 arima_at2 Málaga    Test  13.7   21.7  17.9  15.2  31.7 0.182 0.128  0.241 
3 Snaive    Málaga    Test  -3.81  22.7  18.7 -22.3  43.6 0.190 0.134 -0.0975</code></pre>
</div>
</div>
</section>
<section id="days-14" class="level3">
<h3 class="anchored" data-anchor-id="days-14">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test  18.4    26.2  22.0  20.8  33.9 0.224 0.154 0.260 
2 arima_at2 Málaga    Test  18.5    26.0  22.0  21.1  33.8 0.223 0.154 0.246 
3 Snaive    Málaga    Test  -0.886  22.0  18.6 -14.7  37.8 0.189 0.130 0.0886</code></pre>
</div>
</div>
</section>
<section id="days-15" class="level3">
<h3 class="anchored" data-anchor-id="days-15">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   628. 1042.  629.  58.6  62.8  6.39  6.16 0.933
2 arima_at2 Málaga    Test   599. 1007.  601.  53.2  57.8  6.10  5.95 0.932
3 Snaive    Málaga    Test   621. 1049.  628.  45.0  62.4  6.38  6.20 0.929</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla" class="level2">
<h2 class="anchored" data-anchor-id="sevilla">Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>data_Sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2  23.1                  -14       -13
 2 Sevilla   2020-06-16         1  24.0                  -10        -4
 3 Sevilla   2020-06-17         0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1  29.3                  -17       -19
 9 Sevilla   2020-06-23         0  30.2                  -12       -13
10 Sevilla   2020-06-24         1  29.4                  -12       -12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_train <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-10-14" "2021-02-13" "2021-02-13" "2021-06-14" "2021-10-14" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_test <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2021-10-15" "2021-11-25" "2022-01-05" "2022-01-05" "2022-02-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work)</span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb254-16"><a href="#cb254-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb254-17"><a href="#cb254-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb254-18"><a href="#cb254-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb254-19"><a href="#cb254-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work),</span>
<span id="cb254-20"><a href="#cb254-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb254-21"><a href="#cb254-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos))</span>
<span id="cb254-22"><a href="#cb254-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb254-23"><a href="#cb254-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-24"><a href="#cb254-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb254-25"><a href="#cb254-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Sevilla   &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Sevilla   arima_at1  0.855   -647. 1321. 1322. 1380. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Sevilla   arima_at2  0.837   -643. 1311. 1312. 1366. &lt;cpl [10]&gt; &lt;cpl [7]&gt;
3 Sevilla   Snaive     2.47      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(3,1,0)(1,0,1)[7] errors&gt;  0.837   -643. 1311. 1312. 1366.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.855   -647. 1321. 1322. 1380.
3 Snaive                               &lt;SNAIVE&gt;  2.47      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-121-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-122-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-123-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    6.00     0.539
2 Sevilla   arima_at2   11.6      0.116
3 Sevilla   Snaive     995.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    15.7     0.333
2 Sevilla   arima_at2    21.0     0.101
3 Sevilla   Snaive     1444.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    29.5    0.103 
2 Sevilla   arima_at2    31.9    0.0603
3 Sevilla   Snaive     1580.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    124.  0.0104  
2 Sevilla   arima_at2    145.  0.000218
3 Sevilla   Snaive      2311.  0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a>data_fc_h90 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-16" class="level3">
<h3 class="anchored" data-anchor-id="days-16">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-130-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-131-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Sevilla   Test   3.54  9.18  7.23   8.02  21.4 0.0714 0.0582 -0.475 
2 arima_at2 Sevilla   Test   7.41 10.6   8.11  20.4   23.0 0.0801 0.0675 -0.416 
3 Snaive    Sevilla   Test  -5.28 15.6  13.3  -20.3   39.3 0.131  0.0990  0.0323</code></pre>
</div>
</div>
</section>
<section id="days-17" class="level3">
<h3 class="anchored" data-anchor-id="days-17">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-133-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-134-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model   provincia .type      ME  RMSE   MAE    MPE  MAPE   MASE  RMSSE   ACF1
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 arima_a… Sevilla   Test    0.949  8.67  7.40  -6.17  28.5 0.0731 0.0549 -0.387
2 arima_a… Sevilla   Test    6.21  10.4   7.82  14.3   24.1 0.0772 0.0659 -0.416
3 Snaive   Sevilla   Test  -11.6   18.4  15.6  -54.4   63.9 0.154  0.117   0.268</code></pre>
</div>
</div>
</section>
<section id="days-18" class="level3">
<h3 class="anchored" data-anchor-id="days-18">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-136-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-137-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model  provincia .type     ME  RMSE   MAE     MPE  MAPE   MASE  RMSSE    ACF1
  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 arima_… Sevilla   Test    3.38  10.7  8.64   0.302  28.6 0.0853 0.0681 -0.0110
2 arima_… Sevilla   Test    9.87  14.6 10.9   23.4    30.0 0.108  0.0924  0.143 
3 Snaive  Sevilla   Test  -12.8   21.0 18.2  -57.0    68.6 0.180  0.133   0.328 </code></pre>
</div>
</div>
</section>
<section id="days-19" class="level3">
<h3 class="anchored" data-anchor-id="days-19">90 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>))</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-139-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>fc_h90 <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-10-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">90</span>) <span class="sc">&amp;</span></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h90"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-140-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h90, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   687. 1168.  689.  58.0  66.1  6.80  7.40 0.898
2 arima_at2 Sevilla   Test   717. 1200.  717.  71.8  73.5  7.09  7.61 0.898
3 Snaive    Sevilla   Test   669. 1164.  680.  34.0  74.1  6.72  7.38 0.893</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="middel-of-sixth-epidemiological-period" class="level1">
<h1>Middel of sixth epidemiological period</h1>
<section id="asturias-1" class="level2">
<h2 class="anchored" data-anchor-id="asturias-1">Asturias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>data_asturias <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Asturias"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>data_asturias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Asturias  2020-06-15         0  16                   -6          39
 2 Asturias  2020-06-16         1  15.6                 -6           7
 3 Asturias  2020-06-17         0  15.6                 -7          20
 4 Asturias  2020-06-18         0  15.1                 -4          68
 5 Asturias  2020-06-19         0  14.8                 -4          52
 6 Asturias  2020-06-20         0  16.8                -10          71
 7 Asturias  2020-06-21         0  18.2                 -5.5        46
 8 Asturias  2020-06-22         0  18.2                 -1          99
 9 Asturias  2020-06-23         0  20                   -2         129
10 Asturias  2020-06-24         0  18.2                 -9          63
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>data_asturias_train <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>data_asturias_test <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_asturias_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>lambda_asturias_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>lambda_asturias_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_asturias_train <span class="sc">%&gt;%</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb311-9"><a href="#cb311-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb311-10"><a href="#cb311-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work)</span>
<span id="cb311-11"><a href="#cb311-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb311-12"><a href="#cb311-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos) <span class="sc">~</span> </span>
<span id="cb311-13"><a href="#cb311-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_asturias_tmed) <span class="sc">+</span> </span>
<span id="cb311-14"><a href="#cb311-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_asturias_grocery) <span class="sc">+</span></span>
<span id="cb311-15"><a href="#cb311-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_asturias_parks) <span class="sc">+</span></span>
<span id="cb311-16"><a href="#cb311-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_asturias_resd) <span class="sc">+</span></span>
<span id="cb311-17"><a href="#cb311-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_asturias_retail) <span class="sc">+</span></span>
<span id="cb311-18"><a href="#cb311-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_asturias_transit) <span class="sc">+</span></span>
<span id="cb311-19"><a href="#cb311-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_asturias_work),</span>
<span id="cb311-20"><a href="#cb311-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb311-21"><a href="#cb311-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_asturias_casos))</span>
<span id="cb311-22"><a href="#cb311-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb311-23"><a href="#cb311-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-24"><a href="#cb311-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb311-25"><a href="#cb311-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Asturias  &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Asturias  arima_at1  0.916   -812. 1653. 1653. 1714. &lt;cpl [17]&gt; &lt;cpl [1]&gt;
2 Asturias  arima_at2  0.891   -806. 1634. 1635. 1683. &lt;cpl [7]&gt;  &lt;cpl [8]&gt;
3 Asturias  Snaive     2.53      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(0,1,1)(1,0,1)[7] errors&gt;  0.891   -806. 1634. 1635. 1683.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.916   -812. 1653. 1653. 1714.
3 Snaive                               &lt;SNAIVE&gt;  2.53      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-149-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-150-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-151-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    16.9    0.0184
2 Asturias  arima_at2    15.5    0.0301
3 Asturias  Snaive      981.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    38.0  0.000521
2 Asturias  arima_at2    34.2  0.00190 
3 Asturias  Snaive     1393.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1    58.5 0.0000214
2 Asturias  arima_at2    47.4 0.000829 
3 Asturias  Snaive     1470.  0        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Asturias  arima_at1   103.   0.000188
2 Asturias  arima_at2    79.8  0.0249  
3 Asturias  Snaive     1527.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb328-7"><a href="#cb328-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb328-8"><a href="#cb328-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb328-9"><a href="#cb328-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb328-10"><a href="#cb328-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb328-11"><a href="#cb328-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb328-12"><a href="#cb328-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb328-13"><a href="#cb328-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb328-14"><a href="#cb328-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-20" class="level3">
<h3 class="anchored" data-anchor-id="days-20">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-158-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-159-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Asturias  Test  -168.  272.  248. -24.8  29.9  2.56  1.24  0.200
2 arima_at2 Asturias  Test  -253.  336.  319. -33.9  38.0  3.29  1.53  0.166
3 Snaive    Asturias  Test  -570.  586.  570. -62.8  62.8  5.89  2.66 -0.550</code></pre>
</div>
</div>
</section>
<section id="days-21" class="level3">
<h3 class="anchored" data-anchor-id="days-21">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-161-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb335-7"><a href="#cb335-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-162-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test  -271.  335.  311.  -44.3  46.9  3.21  1.52 0.387
2 arima_at2 Asturias  Test  -402.  461.  434.  -62.5  64.5  4.49  2.09 0.457
3 Snaive    Asturias  Test  -769.  812.  769. -107.  107.   7.94  3.69 0.299</code></pre>
</div>
</div>
</section>
<section id="days-22" class="level3">
<h3 class="anchored" data-anchor-id="days-22">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-164-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb339-5"><a href="#cb339-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb339-6"><a href="#cb339-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb339-7"><a href="#cb339-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-165-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test  -353.  410.  380.  -74.4  76.1  3.93  1.87 0.530
2 arima_at2 Asturias  Test  -502.  555.  524. -100.  101.   5.42  2.52 0.602
3 Snaive    Asturias  Test  -920.  980.  920. -168.  168.   9.50  4.46 0.437</code></pre>
</div>
</div>
</section>
<section id="days-23" class="level3">
<h3 class="anchored" data-anchor-id="days-23">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>            data_asturias_test <span class="sc">%&gt;%</span> </span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-167-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>            data_asturias <span class="sc">%&gt;%</span> </span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Asturias - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-168-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_asturias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Asturias  Test   -571.  623.  581.  -Inf   Inf  6.00  2.83 0.706
2 arima_at2 Asturias  Test   -707.  749.  715.  -Inf   Inf  7.39  3.41 0.710
3 Snaive    Asturias  Test  -1282. 1359. 1282.  -Inf   Inf 13.3   6.18 0.471</code></pre>
</div>
</div>
</section>
</section>
<section id="barcelona-1" class="level2">
<h2 class="anchored" data-anchor-id="barcelona-1">Barcelona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Barcelona"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>data_Barcelona</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Barcelona 2020-06-15        62  21.2                   -9        17
 2 Barcelona 2020-06-16        66  20.8                  -10       -16
 3 Barcelona 2020-06-17        70  20.3                   -4        14
 4 Barcelona 2020-06-18        68  18.8                   -8        -6
 5 Barcelona 2020-06-19        65  20.4                   -5        10
 6 Barcelona 2020-06-20        53  21.8                  -12        15
 7 Barcelona 2020-06-21        38  22.8                  -18        18
 8 Barcelona 2020-06-22        69  23.8                    5        24
 9 Barcelona 2020-06-23        95  23.4                   19        28
10 Barcelona 2020-06-24        44  23.6                  -71        28
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_train <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>data_Barcelona_test <span class="ot">&lt;-</span> data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Barcelona_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>lambda_Barcelona_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Barcelona_train <span class="sc">%&gt;%</span></span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb368-7"><a href="#cb368-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb368-8"><a href="#cb368-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb368-9"><a href="#cb368-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb368-10"><a href="#cb368-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work)</span>
<span id="cb368-11"><a href="#cb368-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb368-12"><a href="#cb368-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos) <span class="sc">~</span> </span>
<span id="cb368-13"><a href="#cb368-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Barcelona_tmed) <span class="sc">+</span> </span>
<span id="cb368-14"><a href="#cb368-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Barcelona_grocery) <span class="sc">+</span></span>
<span id="cb368-15"><a href="#cb368-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Barcelona_parks) <span class="sc">+</span></span>
<span id="cb368-16"><a href="#cb368-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Barcelona_resd) <span class="sc">+</span></span>
<span id="cb368-17"><a href="#cb368-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Barcelona_retail) <span class="sc">+</span></span>
<span id="cb368-18"><a href="#cb368-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Barcelona_transit) <span class="sc">+</span></span>
<span id="cb368-19"><a href="#cb368-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Barcelona_work),</span>
<span id="cb368-20"><a href="#cb368-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb368-21"><a href="#cb368-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Barcelona_casos))</span>
<span id="cb368-22"><a href="#cb368-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb368-23"><a href="#cb368-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-24"><a href="#cb368-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb368-25"><a href="#cb368-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Barcelona &lt;LM w/ ARIMA(1,1,0)(1,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots 
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;   
1 Barcelona arima_at1  0.909   -816. 1652. 1653. 1696. &lt;cpl [8]&gt;  &lt;cpl [0]&gt;
2 Barcelona arima_at2  0.815   -783. 1591. 1592. 1648. &lt;cpl [15]&gt; &lt;cpl [2]&gt;
3 Barcelona Snaive     4.60      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(1,1,2)(2,0,0)[7] errors&gt;  0.815   -783. 1591. 1592. 1648.
2 arima_… &lt;LM w/ ARIMA(1,1,0)(1,0,0)[7] errors&gt;  0.909   -816. 1652. 1653. 1696.
3 Snaive                               &lt;SNAIVE&gt;  4.60      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-177-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-178-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-179-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    54.6 0.00000000179
2 Barcelona arima_at2    15.2 0.0332       
3 Barcelona Snaive     1689.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    70.7 0.00000000145
2 Barcelona arima_at2    37.2 0.000690     
3 Barcelona Snaive     2232.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat     lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Barcelona arima_at1    79.7 0.00000000897
2 Barcelona arima_at2    41.8 0.00443      
3 Barcelona Snaive     2328.  0            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb383-2"><a href="#cb383-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Barcelona arima_at1   150.   3.08e-10
2 Barcelona arima_at2    99.5  4.27e- 4
3 Barcelona Snaive     2625.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb385-6"><a href="#cb385-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb385-7"><a href="#cb385-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb385-8"><a href="#cb385-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb385-9"><a href="#cb385-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb385-10"><a href="#cb385-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb385-11"><a href="#cb385-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb385-12"><a href="#cb385-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb385-13"><a href="#cb385-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb385-14"><a href="#cb385-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb386-10"><a href="#cb386-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-24" class="level3">
<h3 class="anchored" data-anchor-id="days-24">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-186-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-187-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Barcelona Test   -304.  374.  304.  -4.15  4.15 0.382 0.191 -0.400 
2 arima_at2 Barcelona Test  -1168. 1213. 1168. -15.2  15.2  1.47  0.619 -0.0336
3 Snaive    Barcelona Test  -7681. 7943. 7681. -96.6  96.6  9.65  4.06   0.550 </code></pre>
</div>
</div>
</section>
<section id="days-25" class="level3">
<h3 class="anchored" data-anchor-id="days-25">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb391"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb391-7"><a href="#cb391-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-189-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-190-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model  provincia .type     ME   RMSE   MAE     MPE   MAPE   MASE RMSSE   ACF1
  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_… Barcelona Test   -342.   432.  365.   -6.19   6.90  0.458 0.221 0.0799
2 arima_… Barcelona Test  -1123.  1217. 1123.  -19.4   19.4   1.41  0.621 0.408 
3 Snaive  Barcelona Test  -9702. 10297. 9702. -182.   182.   12.2   5.26  0.547 </code></pre>
</div>
</div>
</section>
<section id="days-26" class="level3">
<h3 class="anchored" data-anchor-id="days-26">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-192-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb396-7"><a href="#cb396-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-193-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model provincia .type      ME   RMSE    MAE     MPE   MAPE   MASE RMSSE  ACF1
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima… Barcelona Test    -211.   381.   322.   -3.57   7.25  0.404 0.195 0.308
2 arima… Barcelona Test    -841.  1032.   886.  -15.5   17.4   1.11  0.527 0.620
3 Snaive Barcelona Test  -10898. 11601. 10898. -262.   262.   13.7   5.92  0.600</code></pre>
</div>
</div>
</section>
<section id="days-27" class="level3">
<h3 class="anchored" data-anchor-id="days-27">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>            data_Barcelona_test <span class="sc">%&gt;%</span> </span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-195-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>            data_Barcelona <span class="sc">%&gt;%</span> </span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb400-6"><a href="#cb400-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb400-7"><a href="#cb400-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Barcelona - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-196-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Barcelona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME   RMSE    MAE   MPE  MAPE   MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Barcelona Test  -2.65e0   598.   482.  -Inf   Inf  0.605 0.305 0.689
2 arima_at2 Barcelona Test   6.08e1   912.   777.  -Inf   Inf  0.976 0.466 0.848
3 Snaive    Barcelona Test  -1.39e4 14803. 13931.  -Inf   Inf 17.5   7.56  0.580</code></pre>
</div>
</div>
</section>
</section>
<section id="madrid-1" class="level2">
<h2 class="anchored" data-anchor-id="madrid-1">Madrid</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>data_Madrid <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Madrid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true" tabindex="-1"></a>data_Madrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Madrid    2020-06-15       153  20.7                   -8        34
 2 Madrid    2020-06-16        91  21                     -8        21
 3 Madrid    2020-06-17        93  20.2                   -5        34
 4 Madrid    2020-06-18        85  21.9                   -7        30
 5 Madrid    2020-06-19        78  22.6                   -9        22
 6 Madrid    2020-06-20        67  23.4                  -12        25
 7 Madrid    2020-06-21        42  25                    -13        14
 8 Madrid    2020-06-22        60  27.3                   -8        29
 9 Madrid    2020-06-23        68  28.4                   -9        23
10 Madrid    2020-06-24        49  28                     -7        22
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_train <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb407"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a>data_Madrid_test <span class="ot">&lt;-</span> data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Madrid_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb411"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb411-4"><a href="#cb411-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb411-5"><a href="#cb411-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a>lambda_Madrid_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Madrid_train <span class="sc">%&gt;%</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb425-10"><a href="#cb425-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work)</span>
<span id="cb425-11"><a href="#cb425-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb425-12"><a href="#cb425-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos) <span class="sc">~</span> </span>
<span id="cb425-13"><a href="#cb425-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Madrid_tmed) <span class="sc">+</span> </span>
<span id="cb425-14"><a href="#cb425-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Madrid_grocery) <span class="sc">+</span></span>
<span id="cb425-15"><a href="#cb425-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Madrid_parks) <span class="sc">+</span></span>
<span id="cb425-16"><a href="#cb425-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Madrid_resd) <span class="sc">+</span></span>
<span id="cb425-17"><a href="#cb425-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Madrid_retail) <span class="sc">+</span></span>
<span id="cb425-18"><a href="#cb425-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Madrid_transit) <span class="sc">+</span></span>
<span id="cb425-19"><a href="#cb425-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Madrid_work),</span>
<span id="cb425-20"><a href="#cb425-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb425-21"><a href="#cb425-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Madrid_casos))</span>
<span id="cb425-22"><a href="#cb425-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb425-23"><a href="#cb425-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-24"><a href="#cb425-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb425-25"><a href="#cb425-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Madrid    &lt;LM w/ ARIMA(1,1,1)(1,0,2)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    
1 Madrid    arima_at1   1.18   -892. 1809. 1810. 1866. &lt;cpl [8]&gt; &lt;cpl [15]&gt;
2 Madrid    arima_at2   1.17   -889. 1804. 1804. 1861. &lt;cpl [8]&gt; &lt;cpl [9]&gt; 
3 Madrid    Snaive      5.10     NA    NA    NA    NA  &lt;NULL&gt;    &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(1,1,2)(1,0,1)[7] errors&gt;   1.17   -889. 1804. 1804. 1861.
2 arima_… &lt;LM w/ ARIMA(1,1,1)(1,0,2)[7] errors&gt;   1.18   -892. 1809. 1810. 1866.
3 Snaive                               &lt;SNAIVE&gt;   5.10     NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb431-4"><a href="#cb431-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-205-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb432"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-206-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-207-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1   12.6     0.0823
2 Madrid    arima_at2    6.30    0.506 
3 Madrid    Snaive    1552.      0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb436"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    25.5    0.0299
2 Madrid    arima_at2    21.3    0.0953
3 Madrid    Snaive     2076.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    36.2    0.0208
2 Madrid    arima_at2    33.0    0.0462
3 Madrid    Snaive     2151.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb440"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Madrid    arima_at1    86.2   0.00747
2 Madrid    arima_at2    78.0   0.0338 
3 Madrid    Snaive     2518.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb442"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb442-4"><a href="#cb442-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb442-5"><a href="#cb442-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb442-6"><a href="#cb442-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb442-7"><a href="#cb442-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb442-8"><a href="#cb442-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb442-9"><a href="#cb442-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb442-10"><a href="#cb442-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb442-11"><a href="#cb442-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb442-12"><a href="#cb442-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb442-13"><a href="#cb442-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb442-14"><a href="#cb442-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb443-7"><a href="#cb443-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb443-8"><a href="#cb443-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb443-9"><a href="#cb443-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb443-10"><a href="#cb443-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-28" class="level3">
<h3 class="anchored" data-anchor-id="days-28">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb444"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb444-4"><a href="#cb444-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb444-5"><a href="#cb444-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb444-6"><a href="#cb444-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb444-7"><a href="#cb444-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-214-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb445-2"><a href="#cb445-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb445-3"><a href="#cb445-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb445-4"><a href="#cb445-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb445-5"><a href="#cb445-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb445-6"><a href="#cb445-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb445-7"><a href="#cb445-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-215-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb446"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 arima_at1 Madrid    Test    268.  509.  401.   4.78  7.20 0.537 0.285 0.0164 
2 arima_at2 Madrid    Test    348.  569.  462.   6.71  8.51 0.619 0.319 0.00237
3 Snaive    Madrid    Test  -1649. 1869. 1649. -32.7  32.7  2.21  1.05  0.537  </code></pre>
</div>
</div>
</section>
<section id="days-29" class="level3">
<h3 class="anchored" data-anchor-id="days-29">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb448"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb448-3"><a href="#cb448-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb448-4"><a href="#cb448-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb448-5"><a href="#cb448-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb448-6"><a href="#cb448-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb448-7"><a href="#cb448-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-217-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb449-5"><a href="#cb449-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb449-6"><a href="#cb449-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb449-7"><a href="#cb449-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-218-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb450"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME  RMSE   MAE     MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test    -70.1  586.  460.  -3.97   12.0 0.615 0.328 0.309
2 arima_at2 Madrid    Test     56.2  553.  449.  -0.301  11.3 0.601 0.309 0.289
3 Snaive    Madrid    Test  -2634.  3064. 2634. -70.0    70.0 3.53  1.72  0.464</code></pre>
</div>
</div>
</section>
<section id="days-30" class="level3">
<h3 class="anchored" data-anchor-id="days-30">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb452"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb452-3"><a href="#cb452-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb452-4"><a href="#cb452-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb452-5"><a href="#cb452-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb452-6"><a href="#cb452-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb452-7"><a href="#cb452-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-220-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb453"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb453-5"><a href="#cb453-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb453-6"><a href="#cb453-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb453-7"><a href="#cb453-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-221-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test   -449.  911.  709.  -25.2  30.6 0.949 0.510 0.559
2 arima_at2 Madrid    Test   -320.  830.  657.  -20.4  27.8 0.880 0.465 0.555
3 Snaive    Madrid    Test  -3530. 4142. 3530. -143.  143.  4.73  2.32  0.576</code></pre>
</div>
</div>
</section>
<section id="days-31" class="level3">
<h3 class="anchored" data-anchor-id="days-31">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb456"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb456-3"><a href="#cb456-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb456-4"><a href="#cb456-4" aria-hidden="true" tabindex="-1"></a>            data_Madrid_test <span class="sc">%&gt;%</span> </span>
<span id="cb456-5"><a href="#cb456-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb456-6"><a href="#cb456-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb456-7"><a href="#cb456-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-223-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a>            data_Madrid <span class="sc">%&gt;%</span> </span>
<span id="cb457-4"><a href="#cb457-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb457-5"><a href="#cb457-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb457-6"><a href="#cb457-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb457-7"><a href="#cb457-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Madrid - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-224-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb458"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Madrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Madrid    Test  -1153. 1478. 1249. -1126. 1128.  1.67 0.828 0.660
2 arima_at2 Madrid    Test  -1337. 1762. 1461. -1430. 1433.  1.96 0.986 0.741
3 Snaive    Madrid    Test  -5635. 6384. 5635. -4097. 4097.  7.54 3.57  0.622</code></pre>
</div>
</div>
</section>
</section>
<section id="malaga-1" class="level2">
<h2 class="anchored" data-anchor-id="malaga-1">Malaga</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a>data_Malaga <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Málaga"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb460-6"><a href="#cb460-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb460-7"><a href="#cb460-7" aria-hidden="true" tabindex="-1"></a>data_Malaga</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Málaga    2020-06-15         1  27.2                  -16        -9
 2 Málaga    2020-06-16         1  27.8                  -13        -4
 3 Málaga    2020-06-17         2  26.9                  -13         1
 4 Málaga    2020-06-18         2  21.6                  -12         3
 5 Málaga    2020-06-19         1  24.7                  -12         2
 6 Málaga    2020-06-20         4  22.6                  -14         8
 7 Málaga    2020-06-21         4  22.7                  -16        -3
 8 Málaga    2020-06-22         6  25                    -13         1
 9 Málaga    2020-06-23         8  25.6                  -10        18
10 Málaga    2020-06-24        65  24.5                  -13        12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb462"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_train <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb462-3"><a href="#cb462-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb464"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a>data_Malaga_test <span class="ot">&lt;-</span> data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb464-2"><a href="#cb464-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb464-3"><a href="#cb464-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Malaga_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb466-2"><a href="#cb466-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb466-3"><a href="#cb466-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb466-4"><a href="#cb466-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb466-5"><a href="#cb466-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb468-3"><a href="#cb468-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb468-4"><a href="#cb468-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb468-5"><a href="#cb468-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb470"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb470-3"><a href="#cb470-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb470-4"><a href="#cb470-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb470-5"><a href="#cb470-5" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb472"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb472-2"><a href="#cb472-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb472-3"><a href="#cb472-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb472-4"><a href="#cb472-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb474"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb474-3"><a href="#cb474-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb474-4"><a href="#cb474-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb476-2"><a href="#cb476-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb476-3"><a href="#cb476-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb476-4"><a href="#cb476-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb478"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb478-3"><a href="#cb478-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb478-4"><a href="#cb478-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb480-4"><a href="#cb480-4" aria-hidden="true" tabindex="-1"></a>lambda_Malaga_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Malaga_train <span class="sc">%&gt;%</span></span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb482-3"><a href="#cb482-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb482-4"><a href="#cb482-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb482-5"><a href="#cb482-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb482-6"><a href="#cb482-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb482-7"><a href="#cb482-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb482-8"><a href="#cb482-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb482-9"><a href="#cb482-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb482-10"><a href="#cb482-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work)</span>
<span id="cb482-11"><a href="#cb482-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb482-12"><a href="#cb482-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos) <span class="sc">~</span> </span>
<span id="cb482-13"><a href="#cb482-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Malaga_tmed) <span class="sc">+</span> </span>
<span id="cb482-14"><a href="#cb482-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Malaga_grocery) <span class="sc">+</span></span>
<span id="cb482-15"><a href="#cb482-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Malaga_parks) <span class="sc">+</span></span>
<span id="cb482-16"><a href="#cb482-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Malaga_resd) <span class="sc">+</span></span>
<span id="cb482-17"><a href="#cb482-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Malaga_retail) <span class="sc">+</span></span>
<span id="cb482-18"><a href="#cb482-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Malaga_transit) <span class="sc">+</span></span>
<span id="cb482-19"><a href="#cb482-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Malaga_work),</span>
<span id="cb482-20"><a href="#cb482-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb482-21"><a href="#cb482-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Malaga_casos))</span>
<span id="cb482-22"><a href="#cb482-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb482-23"><a href="#cb482-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-24"><a href="#cb482-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb482-25"><a href="#cb482-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Málaga    &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
1 Málaga    arima_at1  0.568   -671. 1369. 1370. 1431. &lt;cpl [18]&gt; &lt;cpl [0]&gt; 
2 Málaga    arima_at2  0.550   -662. 1352. 1353. 1414. &lt;cpl [7]&gt;  &lt;cpl [11]&gt;
3 Málaga    Snaive     2.32      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb486-3"><a href="#cb486-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb486-4"><a href="#cb486-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb486-5"><a href="#cb486-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb486-6"><a href="#cb486-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb486-7"><a href="#cb486-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(0,1,4)(1,0,1)[7] errors&gt;  0.550   -662. 1352. 1353. 1414.
2 arima_… &lt;LM w/ ARIMA(4,1,0)(2,0,0)[7] errors&gt;  0.568   -671. 1369. 1370. 1431.
3 Snaive                               &lt;SNAIVE&gt;  2.32      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb488"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb488-3"><a href="#cb488-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb488-4"><a href="#cb488-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-233-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb489"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-234-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-235-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    8.51     0.290
2 Málaga    arima_at2    4.99     0.661
3 Málaga    Snaive    1613.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb493"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    27.2    0.0181
2 Málaga    arima_at2    24.1    0.0447
3 Málaga    Snaive     2365.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb495"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    45.8   0.00136
2 Málaga    arima_at2    35.4   0.0258 
3 Málaga    Snaive     2545.    0      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Málaga    arima_at1    99.1  0.000463
2 Málaga    arima_at2    87.6  0.00568 
3 Málaga    Snaive     3404.   0       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb499"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb499-4"><a href="#cb499-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb499-5"><a href="#cb499-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb499-6"><a href="#cb499-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb499-7"><a href="#cb499-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb499-8"><a href="#cb499-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb499-9"><a href="#cb499-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb499-10"><a href="#cb499-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb499-11"><a href="#cb499-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb499-12"><a href="#cb499-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb499-13"><a href="#cb499-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb499-14"><a href="#cb499-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb500"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb500-2"><a href="#cb500-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb500-3"><a href="#cb500-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb500-4"><a href="#cb500-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb500-5"><a href="#cb500-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb500-6"><a href="#cb500-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb500-7"><a href="#cb500-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb500-8"><a href="#cb500-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb500-9"><a href="#cb500-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb500-10"><a href="#cb500-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-32" class="level3">
<h3 class="anchored" data-anchor-id="days-32">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb501"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb501-4"><a href="#cb501-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb501-5"><a href="#cb501-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb501-6"><a href="#cb501-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb501-7"><a href="#cb501-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-242-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb502"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb502-2"><a href="#cb502-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb502-3"><a href="#cb502-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb502-4"><a href="#cb502-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb502-5"><a href="#cb502-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb502-6"><a href="#cb502-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb502-7"><a href="#cb502-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-243-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb503"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type      ME  RMSE   MAE    MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test    24.7   169.  128.  -5.55  22.5 0.971 0.683 0.0978
2 arima_at2 Málaga    Test     2.08  162.  117.  -9.09  21.7 0.888 0.653 0.175 
3 Snaive    Málaga    Test  -170.    240.  192. -33.7   35.9 1.45  0.969 0.246 </code></pre>
</div>
</div>
</section>
<section id="days-33" class="level3">
<h3 class="anchored" data-anchor-id="days-33">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb505-5"><a href="#cb505-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb505-6"><a href="#cb505-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb505-7"><a href="#cb505-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-245-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb506"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb506-2"><a href="#cb506-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb506-3"><a href="#cb506-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb506-4"><a href="#cb506-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb506-5"><a href="#cb506-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb506-6"><a href="#cb506-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb506-7"><a href="#cb506-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-246-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb507"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE     MPE  MAPE  MASE RMSSE   ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 arima_at1 Málaga    Test   112.   245.  194.   5.34   27.3  1.47 0.988 0.293 
2 arima_at2 Málaga    Test    79.4  220.  176.   0.521  26.3  1.33 0.891 0.268 
3 Snaive    Málaga    Test  -142.   223.  170. -28.9    31.9  1.29 0.901 0.0235</code></pre>
</div>
</div>
</section>
<section id="days-34" class="level3">
<h3 class="anchored" data-anchor-id="days-34">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb509"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb509-2"><a href="#cb509-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb509-3"><a href="#cb509-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb509-4"><a href="#cb509-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb509-5"><a href="#cb509-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb509-6"><a href="#cb509-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb509-7"><a href="#cb509-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-248-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb510"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb510-2"><a href="#cb510-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb510-3"><a href="#cb510-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb510-4"><a href="#cb510-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb510-5"><a href="#cb510-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb510-6"><a href="#cb510-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb510-7"><a href="#cb510-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-249-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb511"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test    92.3  227.  170.   3.69  24.7  1.29 0.917 0.401
2 arima_at2 Málaga    Test    59.7  201.  153.  -1.09  23.6  1.16 0.813 0.364
3 Snaive    Málaga    Test  -209.   280.  228. -41.6   43.5  1.72 1.13  0.172</code></pre>
</div>
</div>
</section>
<section id="days-35" class="level3">
<h3 class="anchored" data-anchor-id="days-35">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb513"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb513-2"><a href="#cb513-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb513-3"><a href="#cb513-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb513-4"><a href="#cb513-4" aria-hidden="true" tabindex="-1"></a>            data_Malaga_test <span class="sc">%&gt;%</span> </span>
<span id="cb513-5"><a href="#cb513-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb513-6"><a href="#cb513-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb513-7"><a href="#cb513-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-251-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb514"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true" tabindex="-1"></a>            data_Malaga <span class="sc">%&gt;%</span> </span>
<span id="cb514-4"><a href="#cb514-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb514-5"><a href="#cb514-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb514-6"><a href="#cb514-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb514-7"><a href="#cb514-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Malaga - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-252-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb515"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb515-2"><a href="#cb515-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Malaga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Málaga    Test   -35.6  246.  182.  -Inf   Inf  1.38 0.993 0.597
2 arima_at2 Málaga    Test   -30.4  219.  161.  -Inf   Inf  1.22 0.885 0.534
3 Snaive    Málaga    Test  -438.   527.  445.  -Inf   Inf  3.37 2.13  0.514</code></pre>
</div>
</div>
</section>
</section>
<section id="sevilla-1" class="level2">
<h2 class="anchored" data-anchor-id="sevilla-1">Sevilla</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb517"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span> </span>
<span id="cb517-2"><a href="#cb517-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(provincia <span class="sc">==</span> <span class="st">"Sevilla"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb517-3"><a href="#cb517-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-14"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb517-4"><a href="#cb517-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(provincia, fecha, num_casos, tmed, mob_grocery_pharmacy, mob_parks, mob_residential, mob_retail_recreation, mob_transit_stations, mob_workplaces) <span class="sc">%&gt;%</span> </span>
<span id="cb517-5"><a href="#cb517-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb517-6"><a href="#cb517-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>(<span class="at">key =</span> provincia, <span class="at">index =</span> fecha)</span>
<span id="cb517-7"><a href="#cb517-7" aria-hidden="true" tabindex="-1"></a>data_Sevilla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 653 x 10 [1D]
# Key:       provincia [1]
   provincia fecha      num_casos  tmed mob_grocery_pharmacy mob_parks
   &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 Sevilla   2020-06-15         2  23.1                  -14       -13
 2 Sevilla   2020-06-16         1  24.0                  -10        -4
 3 Sevilla   2020-06-17         0  24.9                  -10        -7
 4 Sevilla   2020-06-18         0  25.8                  -12       -13
 5 Sevilla   2020-06-19         0  26.6                  -13       -20
 6 Sevilla   2020-06-20         0  27.5                  -20       -34
 7 Sevilla   2020-06-21         0  28.4                  -27       -47
 8 Sevilla   2020-06-22         1  29.3                  -17       -19
 9 Sevilla   2020-06-23         0  30.2                  -12       -13
10 Sevilla   2020-06-24         1  29.4                  -12       -12
# … with 643 more rows, and 4 more variables: mob_residential &lt;dbl&gt;,
#   mob_retail_recreation &lt;dbl&gt;, mob_transit_stations &lt;dbl&gt;,
#   mob_workplaces &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb519"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_train <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb519-2"><a href="#cb519-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb519-3"><a href="#cb519-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_train<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2020-06-15" "2020-11-10" "2021-04-08" "2021-04-08" "2021-09-04" "2022-01-31" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb521"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a>data_Sevilla_test <span class="ot">&lt;-</span> data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb521-2"><a href="#cb521-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb521-3"><a href="#cb521-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_Sevilla_test<span class="sc">$</span>fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
"2022-02-01" "2022-02-15" "2022-03-01" "2022-03-01" "2022-03-15" "2022-03-29" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb523"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for num_casos</span></span>
<span id="cb523-2"><a href="#cb523-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb523-3"><a href="#cb523-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(num_casos, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb523-4"><a href="#cb523-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb523-5"><a href="#cb523-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_casos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2278229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb525"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for average temp</span></span>
<span id="cb525-2"><a href="#cb525-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb525-3"><a href="#cb525-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb525-4"><a href="#cb525-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb525-5"><a href="#cb525-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_tmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.056074</code></pre>
</div>
<div class="sourceCode cell-code" id="cb527"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lamba for mobility</span></span>
<span id="cb527-2"><a href="#cb527-2" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb527-3"><a href="#cb527-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_grocery_pharmacy, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb527-4"><a href="#cb527-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb527-5"><a href="#cb527-5" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_grocery</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.377952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb529"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb529-2"><a href="#cb529-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_parks, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb529-3"><a href="#cb529-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb529-4"><a href="#cb529-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7188469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb531"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb531-2"><a href="#cb531-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_residential, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb531-3"><a href="#cb531-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb531-4"><a href="#cb531-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_resd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000064</code></pre>
</div>
<div class="sourceCode cell-code" id="cb533"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb533-2"><a href="#cb533-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_retail_recreation, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb533-3"><a href="#cb533-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb533-4"><a href="#cb533-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_retail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb535"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_transit_stations, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb535-3"><a href="#cb535-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb535-4"><a href="#cb535-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_transit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.116829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb537"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work <span class="ot">&lt;-</span> data_asturias <span class="sc">%&gt;%</span></span>
<span id="cb537-2"><a href="#cb537-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(mob_workplaces, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb537-3"><a href="#cb537-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb537-4"><a href="#cb537-4" aria-hidden="true" tabindex="-1"></a>lambda_Sevilla_work</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.999927</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb539"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> data_Sevilla_train <span class="sc">%&gt;%</span></span>
<span id="cb539-2"><a href="#cb539-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb539-3"><a href="#cb539-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at1 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb539-4"><a href="#cb539-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb539-5"><a href="#cb539-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb539-6"><a href="#cb539-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb539-7"><a href="#cb539-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb539-8"><a href="#cb539-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb539-9"><a href="#cb539-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb539-10"><a href="#cb539-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work)</span>
<span id="cb539-11"><a href="#cb539-11" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb539-12"><a href="#cb539-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">arima_at2 =</span> <span class="fu">ARIMA</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos) <span class="sc">~</span> </span>
<span id="cb539-13"><a href="#cb539-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(tmed, lambda_Sevilla_tmed) <span class="sc">+</span> </span>
<span id="cb539-14"><a href="#cb539-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_grocery_pharmacy, lambda_Sevilla_grocery) <span class="sc">+</span></span>
<span id="cb539-15"><a href="#cb539-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_parks, lambda_Sevilla_parks) <span class="sc">+</span></span>
<span id="cb539-16"><a href="#cb539-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_residential, lambda_Sevilla_resd) <span class="sc">+</span></span>
<span id="cb539-17"><a href="#cb539-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_retail_recreation, lambda_Sevilla_retail) <span class="sc">+</span></span>
<span id="cb539-18"><a href="#cb539-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_transit_stations, lambda_Sevilla_transit) <span class="sc">+</span></span>
<span id="cb539-19"><a href="#cb539-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">box_cox</span>(mob_workplaces, lambda_Sevilla_work),</span>
<span id="cb539-20"><a href="#cb539-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approx =</span> <span class="cn">FALSE</span>),</span>
<span id="cb539-21"><a href="#cb539-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">Snaive =</span> <span class="fu">SNAIVE</span>(<span class="fu">box_cox</span>(num_casos, lambda_Sevilla_casos))</span>
<span id="cb539-22"><a href="#cb539-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb539-23"><a href="#cb539-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-24"><a href="#cb539-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show and report model</span></span>
<span id="cb539-25"><a href="#cb539-25" aria-hidden="true" tabindex="-1"></a>fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
# Key:     provincia [1]
  provincia                             arima_at1
  &lt;chr&gt;                                   &lt;model&gt;
1 Sevilla   &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;
# … with 2 more variables: arima_at2 &lt;model&gt;, Snaive &lt;model&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb541"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb541-1"><a href="#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  provincia .model    sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
1 Sevilla   arima_at1  0.940   -821. 1670. 1670. 1731. &lt;cpl [17]&gt; &lt;cpl [1]&gt; 
2 Sevilla   arima_at2  0.910   -813. 1654. 1654. 1715. &lt;cpl [7]&gt;  &lt;cpl [11]&gt;
3 Sevilla   Snaive     2.93      NA    NA    NA    NA  &lt;NULL&gt;     &lt;NULL&gt;    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb543"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb543-2"><a href="#cb543-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span>provincia,</span>
<span id="cb543-3"><a href="#cb543-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">".model"</span>,</span>
<span id="cb543-4"><a href="#cb543-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"orders"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb543-5"><a href="#cb543-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(<span class="fu">glance</span>(fit_model), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"provincia"</span>, <span class="st">".model"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb543-6"><a href="#cb543-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> </span>
<span id="cb543-7"><a href="#cb543-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 3 x 7
# Key:     .model [3]
  .model                                 orders sigma2 log_lik   AIC  AICc   BIC
  &lt;chr&gt;                                 &lt;model&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_… &lt;LM w/ ARIMA(0,1,4)(1,0,1)[7] errors&gt;  0.910   -813. 1654. 1654. 1715.
2 arima_… &lt;LM w/ ARIMA(3,1,1)(2,0,0)[7] errors&gt;  0.940   -821. 1670. 1670. 1731.
3 Snaive                               &lt;SNAIVE&gt;  2.93      NA    NA    NA    NA </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb545"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a Ljung-Box test &gt;&gt; large p-value, confirms residuals are similar / considered to white noise</span></span>
<span id="cb545-2"><a href="#cb545-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb545-3"><a href="#cb545-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Snaive) <span class="sc">%&gt;%</span> </span>
<span id="cb545-4"><a href="#cb545-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-261-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb546"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb546-2"><a href="#cb546-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at1) <span class="sc">%&gt;%</span> </span>
<span id="cb546-3"><a href="#cb546-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-262-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb547"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="sc">%&gt;%</span> </span>
<span id="cb547-2"><a href="#cb547-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(arima_at2) <span class="sc">%&gt;%</span> </span>
<span id="cb547-3"><a href="#cb547-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-263-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb548"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb548-2"><a href="#cb548-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    2.80     0.903
2 Sevilla   arima_at2    1.90     0.965
3 Sevilla   Snaive    1179.       0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb550"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb550-2"><a href="#cb550-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    18.2     0.198
2 Sevilla   arima_at2    15.5     0.343
3 Sevilla   Snaive     1697.      0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb552"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb552-2"><a href="#cb552-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    29.8    0.0960
2 Sevilla   arima_at2    24.7    0.261 
3 Sevilla   Snaive     1803.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb554"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_model) <span class="sc">%&gt;%</span></span>
<span id="cb554-2"><a href="#cb554-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag=</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  provincia .model    lb_stat lb_pvalue
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Sevilla   arima_at1    74.5    0.0599
2 Sevilla   arima_at2    71.2    0.0979
3 Sevilla   Snaive     2248.     0     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb556"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To predict future values of infections, we need to pass the model future/prediction values of the complementary variables tmed and mobility</span></span>
<span id="cb556-2"><a href="#cb556-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to select those from the test dataset</span></span>
<span id="cb556-3"><a href="#cb556-3" aria-hidden="true" tabindex="-1"></a>data_fc_h7 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb556-4"><a href="#cb556-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb556-5"><a href="#cb556-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb556-6"><a href="#cb556-6" aria-hidden="true" tabindex="-1"></a>data_fc_h14 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb556-7"><a href="#cb556-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb556-8"><a href="#cb556-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb556-9"><a href="#cb556-9" aria-hidden="true" tabindex="-1"></a>data_fc_h21 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb556-10"><a href="#cb556-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb556-11"><a href="#cb556-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>)</span>
<span id="cb556-12"><a href="#cb556-12" aria-hidden="true" tabindex="-1"></a>data_fc_h57 <span class="ot">&lt;-</span> data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb556-13"><a href="#cb556-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>num_casos) <span class="sc">%&gt;%</span> </span>
<span id="cb556-14"><a href="#cb556-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb557"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant spikes out of 30 is still consistent with white noise</span></span>
<span id="cb557-2"><a href="#cb557-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To be sure, use a Ljung-Box test, which has a large p-value, confirming that</span></span>
<span id="cb557-3"><a href="#cb557-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the residuals are similar to white noise.</span></span>
<span id="cb557-4"><a href="#cb557-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the alternative models also passed this test.</span></span>
<span id="cb557-5"><a href="#cb557-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb557-6"><a href="#cb557-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb557-7"><a href="#cb557-7" aria-hidden="true" tabindex="-1"></a>fc_h7  <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h7)</span>
<span id="cb557-8"><a href="#cb557-8" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h14)</span>
<span id="cb557-9"><a href="#cb557-9" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h21)</span>
<span id="cb557-10"><a href="#cb557-10" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit_model, <span class="at">new_data =</span> data_fc_h57)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="days-36" class="level3">
<h3 class="anchored" data-anchor-id="days-36">7 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb558"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb558-2"><a href="#cb558-2" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb558-3"><a href="#cb558-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb558-4"><a href="#cb558-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb558-5"><a href="#cb558-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>))</span>
<span id="cb558-6"><a href="#cb558-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb558-7"><a href="#cb558-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-270-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb559"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a>fc_h7 <span class="sc">%&gt;%</span></span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">&amp;</span></span>
<span id="cb559-5"><a href="#cb559-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb559-6"><a href="#cb559-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb559-7"><a href="#cb559-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-271-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb560"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h7, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test    43.3  75.6  58.3   5.86  9.89 0.407 0.277 0.110
2 arima_at2 Sevilla   Test    37.2  72.4  52.1   6.09  9.43 0.364 0.265 0.196
3 Snaive    Sevilla   Test  -293.  356.  300.  -46.0  47.8  2.10  1.30  0.521</code></pre>
</div>
</div>
</section>
<section id="days-37" class="level3">
<h3 class="anchored" data-anchor-id="days-37">14 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb562"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb562-2"><a href="#cb562-2" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb562-3"><a href="#cb562-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb562-4"><a href="#cb562-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb562-5"><a href="#cb562-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>))</span>
<span id="cb562-6"><a href="#cb562-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb562-7"><a href="#cb562-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-273-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb563"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>fc_h14 <span class="sc">%&gt;%</span></span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb563-3"><a href="#cb563-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb563-4"><a href="#cb563-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb563-5"><a href="#cb563-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb563-6"><a href="#cb563-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb563-7"><a href="#cb563-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h14"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-274-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb564"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb564-2"><a href="#cb564-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h14, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   139.  224.  157.  15.1  21.6  1.10 0.819 0.417
2 arima_at2 Sevilla   Test   132.  211.  147.  15.7  20.2  1.02 0.773 0.379
3 Snaive    Sevilla   Test  -279.  321.  282. -47.5  48.4  1.97 1.17  0.409</code></pre>
</div>
</div>
</section>
<section id="days-38" class="level3">
<h3 class="anchored" data-anchor-id="days-38">21 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb566"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb566-2"><a href="#cb566-2" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb566-3"><a href="#cb566-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb566-4"><a href="#cb566-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb566-5"><a href="#cb566-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>))</span>
<span id="cb566-6"><a href="#cb566-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb566-7"><a href="#cb566-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-276-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb567"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a>fc_h21 <span class="sc">%&gt;%</span></span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb567-4"><a href="#cb567-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">21</span>) <span class="sc">&amp;</span></span>
<span id="cb567-5"><a href="#cb567-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb567-6"><a href="#cb567-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb567-7"><a href="#cb567-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h21"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-277-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb568"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h21, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   123.  211.  155.  10.3  26.5 1.09  0.772 0.476
2 arima_at2 Sevilla   Test   121.  196.  140.  13.4  22.3 0.980 0.716 0.421
3 Snaive    Sevilla   Test  -356.  404.  358. -71.9  72.5 2.50  1.48  0.498</code></pre>
</div>
</div>
</section>
<section id="days-39" class="level3">
<h3 class="anchored" data-anchor-id="days-39">57 days</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb570"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb570-2"><a href="#cb570-2" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb570-3"><a href="#cb570-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb570-4"><a href="#cb570-4" aria-hidden="true" tabindex="-1"></a>            data_Sevilla_test <span class="sc">%&gt;%</span> </span>
<span id="cb570-5"><a href="#cb570-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>))</span>
<span id="cb570-6"><a href="#cb570-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb570-7"><a href="#cb570-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-279-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb571"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a>fc_h57 <span class="sc">%&gt;%</span></span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">autoplot</span>(</span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a>            data_Sevilla <span class="sc">%&gt;%</span> </span>
<span id="cb571-4"><a href="#cb571-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(fecha <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-31"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)<span class="sc">+</span><span class="fu">days</span>(<span class="dv">57</span>) <span class="sc">&amp;</span></span>
<span id="cb571-5"><a href="#cb571-5" aria-hidden="true" tabindex="-1"></a>                               fecha <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb571-6"><a href="#cb571-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb571-7"><a href="#cb571-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nº cases"</span>, <span class="at">title =</span> <span class="st">"Sevilla - forecast h57"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="multivariate_google_files/figure-html/unnamed-chunk-280-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb572"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb572-2"><a href="#cb572-2" aria-hidden="true" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(fc_h57, data_Sevilla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
  .model    provincia .type     ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 arima_at1 Sevilla   Test   -43.3  207.  154.  -Inf   Inf 1.08  0.756 0.707
2 arima_at2 Sevilla   Test    15.5  155.  113.  -Inf   Inf 0.786 0.566 0.597
3 Snaive    Sevilla   Test  -681.   784.  682.  -Inf   Inf 4.77  2.87  0.637</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./multivariate.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Multivariate (INE mobility + temp) prediction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lstm.html" class="pagination-link">
        <span class="nav-page-text">Task 6: LSTM</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>